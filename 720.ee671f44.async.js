"use strict";(self.webpackChunkw_react_label=self.webpackChunkw_react_label||[]).push([[720],{52720:function(Ie,st,ar){ar.r(st),ar.d(st,{WColorBlock:function(){return jt},WDraw:function(){return qt},WShapeList:function(){return $t}});var Dt=ar(5574),J=ar.n(Dt),T=ar(67294),Cr=ar(85893),dt=function(X){var d=X.colorBlocks,N=(0,T.useState)(d[0]),g=J()(N,2),A=g[0],u=g[1];(0,T.useEffect)(function(){X.color&&u(X.color)},[]);var O=function(Y,L){u(Y),X.onChange&&X.onChange(Y,L)};return(0,Cr.jsx)("div",{className:"w-color-block-box",children:d.map(function(M,Y){return(0,Cr.jsx)("div",{onClick:function(B){return O(M,B)},className:"w-color-block ".concat(M===A?"on":""),style:{background:M}},Y)})})};dt.defaultProps={color:"",colorBlocks:["#f00","#FFA500","#ff0","#0f0","#0ff","#00f","#800080","#fff"],onChange:function(){}};var jt=dt,At=ar(9783),Wr=ar.n(At),Bt=ar(97857),br=ar.n(Bt),Mt=ar(13769),vt=ar.n(Mt),zt=ar(52677),Jt=ar.n(zt),Nt=ar(61227),Ft=ar.n(Nt),It=ar(19632),tr=ar.n(It),x=ar(46886),z={color:["#CB3D45","#DA833C","#2378DE"],svg:{width:800,height:600},shapeCommon:{fill:"rgba(0, 0, 0, 0)",stroke:"#CB3D45","stroke-width":2,"vector-effect":"non-scaling-stroke"},rect:{x:0,y:0,width:0,height:0},selectBox:{"stroke-width":1,fill:"rgb(34 34 204 / 12%)",stroke:"rgb(34 34 204 / 45%)","vector-effect":"non-scaling-stroke"},ellipse:{cx:0,cy:0,rx:0,ry:0},path:{d:""},line:{d:"",fill:"none",stroke:"#00f","stroke-width":1},point:{cx:0,cy:0,r:4,fill:"rgba(0,0,255,.45)",stroke:"rgba(0, 0, 0, 0)","stroke-width":10},grip:{width:8,height:8,fill:"rgba(0,0,255,.45)",stroke:"rgba(0, 0, 0, 0)","stroke-width":10},font:{x:0,y:0,fill:"#CB3D45",stroke:"none","font-size":16,"text-anchor":"start","dominant-baseline":"text-after-edge"},pathAddPoint:{fill:"none",stroke:"rgba(0,0,0,0)","stroke-width":25},rotateLine:{x1:0,y1:0,x2:0,y2:0,stroke:"rgba(0,0,255,.45)","stroke-width":1},rotateCircle:{cx:0,cy:0,r:5,fill:"rgba(0,0,255,.45)",stroke:"rgba(0, 0, 0, 0)","stroke-width":6}},Tt=["128, 0, 0","0, 128, 0","128, 128, 0","0, 0, 128","128, 0, 128","0, 128, 128","128, 128, 128","64, 0, 0","192, 0, 0","64, 128, 0","192, 128, 0","64, 0, 128","192, 0, 128","64, 128, 128","192, 128, 128","0, 64, 0","128, 64, 0","0, 192, 0","128, 192, 0","0, 64, 128","128, 64, 128","0, 192, 128","128, 192, 128","64, 64, 0","192, 64, 0","64, 192, 0","192, 192, 0","64, 64, 128","192, 64, 128","64, 192, 128","192, 192, 128","0, 0, 64","128, 0, 64","0, 128, 64","128, 128, 64","0, 0, 192","128, 0, 192","0, 128, 192","128, 128, 192","64, 0, 64","192, 0, 64","64, 128, 64","192, 128, 64","64, 0, 192","192, 0, 192","64, 128, 192","192, 128, 192","0, 64, 64","128, 64, 64","0, 192, 64","128, 192, 64","0, 64, 192","128, 64, 192","0, 192, 192","128, 192, 192","64, 64, 64","192, 64, 64","64, 192, 64","192, 192, 64","64, 64, 192","192, 64, 192","64, 192, 192","192, 192, 192","32, 0, 0","160, 0, 0","32, 128, 0","160, 128, 0","32, 0, 128","160, 0, 128","32, 128, 128","160, 128, 128","96, 0, 0","224, 0, 0","96, 128, 0","224, 128, 0","96, 0, 128","224, 0, 128","96, 128, 128","224, 128, 128","32, 64, 0","160, 64, 0","32, 192, 0","160, 192, 0","32, 64, 128","160, 64, 128","32, 192, 128","160, 192, 128","96, 64, 0","224, 64, 0","96, 192, 0","224, 192, 0","96, 64, 128","224, 64, 128","96, 192, 128","224, 192, 128","32, 0, 64","160, 0, 64","32, 128, 64","160, 128, 64","32, 0, 192","160, 0, 192","32, 128, 192","160, 128, 192","96, 0, 64","224, 0, 64","96, 128, 64","224, 128, 64","96, 0, 192","224, 0, 192","96, 128, 192","224, 128, 192","32, 64, 64","160, 64, 64","32, 192, 64","160, 192, 64","32, 64, 192","160, 64, 192","32, 192, 192","160, 192, 192","96, 64, 64","224, 64, 64","96, 192, 64","224, 192, 64","96, 64, 192","224, 64, 192","96, 192, 192","224, 192, 192","0, 32, 0","128, 32, 0","0, 160, 0","128, 160, 0","0, 32, 128","128, 32, 128","0, 160, 128","128, 160, 128","64, 32, 0","192, 32, 0","64, 160, 0","192, 160, 0","64, 32, 128","192, 32, 128","64, 160, 128","192, 160, 128","0, 96, 0","128, 96, 0","0, 224, 0","128, 224, 0","0, 96, 128","128, 96, 128","0, 224, 128","128, 224, 128","64, 96, 0","192, 96, 0","64, 224, 0","192, 224, 0","64, 96, 128","192, 96, 128","64, 224, 128","192, 224, 128","0, 32, 64","128, 32, 64","0, 160, 64","128, 160, 64","0, 32, 192","128, 32, 192","0, 160, 192","128, 160, 192","64, 32, 64","192, 32, 64","64, 160, 64","192, 160, 64","64, 32, 192","192, 32, 192","64, 160, 192","192, 160, 192","0, 96, 64","128, 96, 64","0, 224, 64","128, 224, 64","0, 96, 192","128, 96, 192","0, 224, 192","128, 224, 192","64, 96, 64","192, 96, 64","64, 224, 64","192, 224, 64","64, 96, 192","192, 96, 192","64, 224, 192","192, 224, 192","32, 32, 0","160, 32, 0","32, 160, 0","160, 160, 0","32, 32, 128","160, 32, 128","32, 160, 128","160, 160, 128","96, 32, 0","224, 32, 0","96, 160, 0","224, 160, 0","96, 32, 128","224, 32, 128","96, 160, 128","224, 160, 128","32, 96, 0","160, 96, 0","32, 224, 0","160, 224, 0","32, 96, 128","160, 96, 128","32, 224, 128","160, 224, 128","96, 96, 0","224, 96, 0","96, 224, 0","224, 224, 0","96, 96, 128","224, 96, 128","96, 224, 128","224, 224, 128","32, 32, 64","160, 32, 64","32, 160, 64","160, 160, 64","32, 32, 192","160, 32, 192","32, 160, 192","160, 160, 192","96, 32, 64","224, 32, 64","96, 160, 64","224, 160, 64","96, 32, 192","224, 32, 192","96, 160, 192","224, 160, 192","32, 96, 64","160, 96, 64","32, 224, 64","160, 224, 64","32, 96, 192","160, 96, 192","32, 224, 192","160, 224, 192","96, 96, 64","224, 96, 64","96, 224, 64","224, 224, 64","96, 96, 192","224, 96, 192","96, 224, 192","224, 224, 192","0,0,0"],ft=function(X){var d=Object.keys(X).length;return"rgb("+Tt[d]+")"},ht=["n","ne","e","se","s","sw","w","nw"],Wt=function(X){return!!(X.touches&&X.touches.length)},Kt=function(X,d){for(var N=arguments.length,g=new Array(N>2?N-2:0),A=2;A<N;A++)g[A-2]=arguments[A];var u={},O=g[0],M=g[1],Y=g[2],L=g[3];if(X==="rect"){if(u=Xt.apply(void 0,g),d){var B=L.width,S=L.height,P=u.width-u.height,Z=O.indexOf("n")>=0&&Y<=S||O.indexOf("s")>=0&&Y<=-S,Q=O.indexOf("e")>=0&&M<=-B||O.indexOf("w")>=0&&M<=B;P>0?(Z&&(u.y=u.y-P),u.height=u.width):(Q&&(u.x=u.x+P),u.width=u.height)}}else if(X==="ellipse"){if(u=Gt.apply(void 0,g),d){var U=L.rx,H=L.ry,ir=u.rx-u.ry,hr=O.indexOf("n")>=0&&Y<=H*2||O.indexOf("s")>=0&&Y<=-H*2,E=O.indexOf("e")>=0&&M<=-U*2||O.indexOf("w")>=0&&M<=U*2;ir>0?(hr&&(ir=-ir),u.ry=u.rx,u.cy=u.cy+ir):(E&&(ir=-ir),u.cx=u.cx-ir,u.rx=u.ry)}}else u=Zt.apply(void 0,[d].concat(g));return u},Xt=function(){for(var X=arguments.length,d=new Array(X),N=0;N<X;N++)d[N]=arguments[N];var g=d[0],A=d[1],u=d[2],O=d[3],M=O.x,Y=O.y,L=O.width,B=O.height,S=L,P=B;return g.indexOf("n")>=0?(P=B-u,P>0?Y=Y+u:Y=Y+B,P=Math.abs(P)):g.indexOf("s")>=0&&(P=B+u,P<0&&(Y=Y+B+u),P=Math.abs(P)),g.indexOf("w")>=0?(S=L-A,S<0?M=M+L:M=M+A,S=Math.abs(S)):g.indexOf("e")>=0&&(S=L+A,S<0&&(M=M+L+A),S=Math.abs(S)),{x:M,y:Y,width:S,height:P}},Gt=function(){for(var X=arguments.length,d=new Array(X),N=0;N<X;N++)d[N]=arguments[N];var g=d[0],A=d[1],u=d[2],O=d[3],M=O.cx,Y=O.cy,L=O.rx,B=O.ry;return A=A/2,u=u/2,g.indexOf("n")>=0?(B=B-u,Y=Y+u,B=Math.abs(B)):g.indexOf("s")>=0&&(B=B+u,Y=Y+u,B=Math.abs(B)),g.indexOf("w")>=0?(L=L-A,M=M+A,L=Math.abs(L)):g.indexOf("e")>=0&&(L=L+A,M=M+A,L=Math.abs(L)),{cx:M,cy:Y,rx:L,ry:B}},Zt=function(X){for(var d=arguments.length,N=new Array(d>1?d-1:0),g=1;g<d;g++)N[g-1]=arguments[g];var A=N[0],u=N[1],O=N[2],M=N[3],Y=M.points,L=M.boundRect,B=(Y==null?void 0:Y.length)||0,S=[],P=L.x,Z=L.y,Q=L.width,U=L.height,H=Q/U,ir=A.indexOf("n")>=0,hr=A.indexOf("s")>=0,E=A.indexOf("w")>=0,wr=A.indexOf("e")>=0,Lr="";X&&(A.length===1?(ir||hr?(u=O*H,Lr="v"):(O=u/H,Lr="h"),ir?u=-u:E&&(O=-O)):(O=u/H,(E&&hr||wr&&ir)&&(O=-O)));for(var sr=0;sr<B;sr++){var W=tr()(Y[sr]),I=Math.abs(W[0]-P)/Q,m=Math.abs(W[1]-Z)/U;ir&&(W[1]+=O*(1-m)),(hr||Lr==="h")&&(W[1]+=O*m),E&&(W[0]+=u*(1-I)),(wr||Lr==="v")&&(W[0]+=u*I),S.push(W)}return{points:S}},Ht=function(X,d,N){var g=J()(X,2),A=g[0],u=g[1],O=J()(d,2),M=O[0],Y=O[1],L=J()(N,2),B=L[0],S=L[1],P=B-M,Z=S-Y,Q=((A-M)*P+(u-Y)*Z)/(P*P+Z*Z);return Q<0?(P=A-M,Z=u-Y):Q>1?(P=A-B,Z=u-S):(P=A-(M+Q*P),Z=u-(Y+Q*Z)),Math.sqrt(P*P+Z*Z)},Kr=function(X,d,N,g,A,u){var O=A*Math.PI/180;u&&(O=-O);var M=Math.cos(O),Y=Math.sin(O),L=X-N,B=d-g,S=L*M-B*Y+N,P=L*Y+B*M+g;return[S,P]},Ut=function(X,d,N,g,A,u,O,M){var Y=X+N/2,L=d+g/2,B=Kr(Y,L,A,u,O,M),S=J()(B,2),P=S[0],Z=S[1],Q=P-Y,U=Z-L;return{changeX:Q,changeY:U}},Qt=["attrs","shape_type"],Vt=["points","shape_type"],pt=(0,T.forwardRef)(function(F,X){var d=(0,T.useRef)(F),N=(0,T.useRef)(null),g=(0,T.useRef)(null),A=(0,T.useRef)(null),u=(0,T.useRef)(null),O=(0,T.useRef)(null),M=(0,T.useRef)(null),Y=(0,T.useRef)(""),L=(0,T.useRef)(null),B=(0,T.useRef)(null),S=(0,T.useRef)(null),P=(0,T.useRef)({x:0,y:0,w:0,h:0,mx:0,my:0}),Z=(0,T.useRef)(!1),Q=(0,T.useRef)(!1),U=(0,T.useRef)(!1),H=(0,T.useRef)([]),ir=(0,T.useRef)("1"),hr=(0,T.useRef)({x:0,y:0,scale:1,w:0,h:0}),E=(0,T.useRef)(null),wr=(0,T.useRef)(null),Lr=(0,T.useRef)(""),sr=(0,T.useRef)(!1),W=(0,T.useRef)(!1),I=(0,T.useRef)(!1),m=(0,T.useRef)({}),q=(0,T.useRef)(null),D=(0,T.useRef)({}),cr=(0,T.useRef)([]),or=(0,T.useRef)([]),rr=function(){var r;(r=x.td_("#shape-grip-group,#path-point-group *,#shape-path-group *,#path-add-point"))===null||r===void 0||r.attr("display","none"),M.current="",O.current&&(x.Ys("#"+O.current).attr("fill",z.shapeCommon.fill),O.current=""),Y.current&&(x.Ys("#"+Y.current).attr("fill",z.grip.fill),Y.current=""),L.current&&(x.Ys("#path-point-"+L.current).attr("fill",z.point.fill),L.current="")},jr=function(){if(document.getElementById("svgcanvas")!==document.activeElement){var r;(r=document.getElementById("svgcanvas"))===null||r===void 0||r.focus()}},dr=function(r){var t=(r==null?void 0:r.sourceEvent)||r,e=[];if(Wt(t)?e=x.cx$(t.touches[0]||t.changedTouches[0],g.current.node()):e=x.cx$(t,g.current.node()),S.current){var n=S.current,a=n.x,c=n.y,o=n.k;e[0]=(e[0]-a)/o,e[1]=(e[1]-c)/o}return e},Er=function(){for(var r=H.current.length||0,t=0,e=0;e<r;e++)if(+H.current[e]!==e+1){t=e+1;break}return t===0&&(t=r+1),t=""+t,H.current.splice(t-1,0,t),t},Nr=function(r){return r==="ellipse"?{x:"cx",y:"cy",w:"rx",h:"ry"}:{x:"x",y:"y",w:"width",h:"height"}},_t=function(){var r=d.current.drawTool,t=F.minSize,e=0,n=0;return r==="rect"?(e=u.current.attr("width"),n=u.current.attr("height")):r==="ellipse"&&(e=u.current.attr("rx")*2||0,n=u.current.attr("ry")*2||0),+e<=t[0]||+n<=t[1]?(u.current.remove(),u.current=null,x.Ys("#shape-grip-group").attr("display","none"),!0):!1},$r=function(r){var t,e,n=x.Ys("#shape-".concat(r));if(!n)return{};var a=n==null||(t=n.node())===null||t===void 0?void 0:t.getBBox(),c=(S==null||(e=S.current)===null||e===void 0?void 0:e.k)||1,o=a.x,i=a.y,l=a.width,s=a.height,f=o+l/2,h=i+s/2,p=f*c,v=h*c;return{centerX:f,centerY:h,gripCenterX:p,gripCenterY:v}},_r=function(){var r,t,e,n;if(u.current){var a=(r=u.current.attr("id"))===null||r===void 0?void 0:r.substring(6),c=(t=m.current[a])===null||t===void 0?void 0:t.rotate;if(c){var o=J()(c,3),i=o[0],l=o[1],s=o[2],f=(e=u.current)===null||e===void 0||(n=e.node())===null||n===void 0?void 0:n.getBBox(),h=f.x,p=f.y,v=f.width,b=f.height,w=Ut(h,p,v,b,l,s,i),R=w.changeX,C=w.changeY;return ct([R,C]),[R,C]}}},Ar=function(){var r,t,e,n,a;if(!u.current||Q.current||M.current)return!1;var c=(r=u.current.attr("id"))===null||r===void 0?void 0:r.substring(6),o=(t=m.current)===null||t===void 0?void 0:t[c],i=o.hide,l=o.rotate,s=x.Ys("#shape-grip-group");if(s.attr("display",i?"none":"inline"),!i){var f=(S==null||(e=S.current)===null||e===void 0?void 0:e.k)||1,h=(n=u.current)===null||n===void 0||(a=n.node())===null||a===void 0?void 0:a.getBBox(),p=h.x,v=h.y,b=h.width,w=h.height,R=z.grip.width/2,C=z.grip.height/2;if(p=p*f||0,v=v*f||0,b=b*f||0,w=w*f||0,d.current.rotateEnable){var j=p+b/2;s.select("#rotate-line").attr("x1",j).attr("y1",v-4).attr("x2",j).attr("y2",v-16),s.select("#rotate-circle").attr("cx",j).attr("cy",v-20)}if(l){var k=J()(l,3),G=k[0],K=k[1],V=k[2],_=K*f,$=V*f;s.attr("transform","rotate(".concat(G," ").concat(_,",").concat($,")")),u.current.attr("transform","rotate(".concat(G," ").concat(K,",").concat(V,")"))}else s.attr("transform",null);var er=[[p,v],[p+b,v],[p+b,v+w],[p,v+w]],nr=B.current(er);x.Ys("#resize-path").attr("d",nr+"Z"),s.select("#resize-grip-nw").attr("x",p-R).attr("y",v-C),s.select("#resize-grip-n").attr("x",p+b/2-R).attr("y",v-C),s.select("#resize-grip-ne").attr("x",p+b-R).attr("y",v-C),s.select("#resize-grip-w").attr("x",p-R).attr("y",v+w/2-C),s.select("#resize-grip-e").attr("x",p+b-R).attr("y",v+w/2-C),s.select("#resize-grip-sw").attr("x",p-R).attr("y",v+w-C),s.select("#resize-grip-s").attr("x",p+b/2-R).attr("y",v+w-C),s.select("#resize-grip-se").attr("x",p+b-R).attr("y",v+w-C)}},yt=function(r){var t,e;if(!q.current){for(var n=(t=m.current)===null||t===void 0?void 0:t[r],a=n.attrs.points,c=n.shape_type,o=a.length,i=(S==null||(e=S.current)===null||e===void 0?void 0:e.k)||1,l=[],s=0;s<o;s++){var f=J()(a[s],2),h=f[0],p=f[1];h=h*i,p=p*i,l[s]=[h,p]}var v=B.current(l);c==="polygon"&&(v+="Z"),g.current.select("#path-add-point").attr("d",v)}},rt=function(r){var t,e=q.current||[],n=e.length;if(!(!Q.current||!n)){var a=(S==null||(t=S.current)===null||t===void 0?void 0:t.k)||1,c=J()(e[n-1],2),o=c[0],i=c[1],l=dr(r),s=J()(l,2),f=s[0],h=s[1];o=o*a,i=i*a,f=f*a,h=h*a;var p=[[o,i],[f,h]],v=B.current(p);x.Ys("#path-stretch-line").attr("d",v)}},Dr=function(r){var t,e,n,a,c,o;if(!u.current||!u.current.attr("id"))return!1;var i=(t=u.current.attr("id"))===null||t===void 0?void 0:t.substring(6),l=((e=m.current)===null||e===void 0||(n=e[i])===null||n===void 0||(a=n.attrs)===null||a===void 0?void 0:a.points)||q.current||[],s=l.length,f=(S==null||(c=S.current)===null||c===void 0?void 0:c.k)||1;if(s){yt(i);for(var h=0;h<s;h++){var p=x.Ys("#path-point-group #path-point-".concat(h+1)),v=J()(l[h],2),b=v[0],w=v[1];b=b*f,w=w*f,p.attr("cx",b).attr("cy",w),(Q.current||M.current)&&p.attr("display","inline")}if(r&&rt(r),!Q.current){var R=(o=m.current)===null||o===void 0?void 0:o[i],C=R.rotate;if(C){var j=J()(C,3),k=j[0],G=j[1],K=j[2],V=G*f,_=K*f,$="rotate(".concat(k," ").concat(V,",").concat(_,")");x.Ys("#path-point-group").attr("transform",$),x.Ys("#path-add-point").attr("transform",$),u.current.attr("transform","rotate(".concat(k," ").concat(G,",").concat(K,")"))}else x.Ys("#path-point-group").attr("transform",null),x.Ys("#path-add-point").attr("transform",null)}}},Xr=function(r){var t=r?F.showGrid:d.current.showGrid;if(t)if(S.current=S.current||x.CRH,S.current.k<1)g.current.select("#grid").attr("display","none");else{var e=hr.current,n=e.x,a=e.y,c=e.w,o=e.h,i=S.current.k,l=10*i,s=n*i,f=a*i;g.current.select("#gridPattern").attr("width",l).attr("height",l).attr("x",s).attr("y",f),g.current.select("#grid").attr("display","inline").attr("x",s).attr("y",f).attr("width",c*i).attr("height",o*i)}},Gr=function(r){var t=d.current,e=t.curLabel,n=t.colorBindLabel,a=r||e;if(n){var c=D.current[a]||ft(D.current);z.shapeCommon.stroke=c,z.font.fill=c,r&&(D.current[a]=c)}},Zr=function(r){var t=r||z.shapeCommon.stroke;return x.$_Y(t).copy({opacity:.2})},Hr=function(r,t){var e=x.Ys("#shape-".concat(r));e.attr("stroke",t),d.current.showLabel&&g.current.select("#shape-label-".concat(r)).attr("fill",t),O.current==="shape-"+r&&e.attr("fill",Zr(t))},re=function(r){var t,e=d.current,n=e.colorBindLabel,a=e.curLabel;if(n){var c,o,i;if(E.current||!u.current)return;var l=(c=u.current.attr("id"))===null||c===void 0?void 0:c.substring(6),s=(o=m.current)===null||o===void 0?void 0:o[l],f=s.label,h=D.current[a];(i=Object.keys(m.current))===null||i===void 0||i.forEach(function(b){var w=m.current[b].label;w===f&&Hr(b,r)}),h&&(z.shapeCommon.stroke=h,z.font.fill=h),D.current[f]=r,d.current.changeBindColor(D.current);return}if(z.shapeCommon.stroke=r,z.font.fill=r,E.current){var p;(p=E.current)===null||p===void 0||p.forEach(function(b){Hr(b,r)});return}if(u.current){var v=(t=u.current.attr("id"))===null||t===void 0?void 0:t.substring(6);Hr(v,r)}},Br=function(r,t,e){var n;if(t){var a=(S==null||(n=S.current)===null||n===void 0?void 0:n.k)||1,c=m.current[r],o=c.shape_type,i=c.attrs,l=c.rotate,s=g.current.select("#shape-label-".concat(r)),f=0,h=0;if(o==="ellipse"){var p=i.cx,v=i.cy,b=i.ry;f=p,h=v-b}else if(o==="rect")f=i.x,h=i.y;else{var w=i.points,R=J()(w[0],2);f=R[0],h=R[1];for(var C=1;C<w.length;C++){var j=J()(w[C],2),k=j[0],G=j[1];h>G?(h=G,f=k):h===G&&f>k&&(f=k)}}if(f=f*a||0,h=h*a||0,s.attr("x",f).attr("y",h),e&&s.attr("fill",z.font.fill),l){var K=J()(l,3),V=K[0],_=K[1],$=K[2],er=_*a,nr=$*a;s.attr("transform","rotate(".concat(V," ").concat(er,",").concat(nr,")"))}}},tt=function(r){var t=r?F.showLabel:d.current.showLabel;if(t){var e=Object.keys(m.current);e==null||e.forEach(function(n){Br(n,t)})}},pr=function(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++)t[e]=arguments[e];cr.current.push(t),or.current=[]},Ur=function(){var r=[],t={};if(E.current){var e,n={};(e=E.current)===null||e===void 0||e.forEach(function(i){var l=x.Ys("#shape-".concat(i));t[i]=JSON.parse(JSON.stringify(m.current[i])),n[i]=l}),r=[E.current,t,n]}else if(u.current){var a,c,o=(a=u.current)===null||a===void 0||(c=a.attr("id"))===null||c===void 0?void 0:c.substring(6);t[o]=JSON.parse(JSON.stringify(m.current[o])),r=[u.current,t]}return r},et=function(r){var t,e,n,a=(t=u.current)===null||t===void 0||(e=t.attr("id"))===null||e===void 0?void 0:e.substring(6),c=(n=m.current)===null||n===void 0?void 0:n[a],o=c.attrs,i=c.shape_type,l=c.rotate;if(P.current=o,i==="polygon"||i==="line"){var s,f;P.current.boundRect=(s=u.current)===null||s===void 0||(f=s.node())===null||f===void 0?void 0:f.getBBox(),P.current.close=i==="polygon"}var h=dr(r);if(l){var p=J()(l,3),v=p[0],b=p[1],w=p[2];h=Kr.apply(void 0,tr()(h).concat([b,w,v,!0]))}var R=h,C=J()(R,2);P.current.mx=C[0],P.current.my=C[1]},fr=function(){var r=Object.keys(m.current),t=[],e=hr.current,n=e.x,a=e.y,c=e.scale;return r==null||r.forEach(function(o){var i=m.current[o],l=i.attrs,s=i.label,f=i.shape_type,h=i.hide,p=i.rotate,v={};if(v.label=s||o,v.shape_type=f,v.attrs={},v.hide=h||!1,v.id=o,p&&(v.rotate=p[0]),f==="rect")v.attrs.x=(l.x-n)*c,v.attrs.y=(l.y-a)*c,v.attrs.width=l.width*c,v.attrs.height=l.height*c;else if(f==="ellipse")v.attrs.cx=(l.cx-n)*c,v.attrs.cy=(l.cy-a)*c,v.attrs.rx=l.rx*c,v.attrs.ry=l.ry*c;else{var b;v.attrs.points=[],(b=l.points)===null||b===void 0||b.forEach(function(w,R){v.attrs.points[R]=[(w[0]-n)*c,(w[1]-a)*c]})}t.push(v)}),t},te=function(r){var t=(r==null?void 0:r.target)||(r==null?void 0:r.srcElement),e=x.Ys(t).attr("id"),n=null,a=d.current.drawTool;Y.current||L.current?n="crosshair":sr.current&&!W.current&&!I.current||a==="drag"?n="grab":e==="path-add-point"?n="pointer":u.current&&!Q.current&&O.current===e||E.current&&E.current.includes(e==null?void 0:e.substring(6))?n="move":(!a||a==="move")&&(n="default"),x.Ys(N.current).style("cursor",n)},ee=function(r){d.current.showCrosshair&&(g.current.select("#crosshair-v-line").attr("x",r.layerX),g.current.select("#crosshair-h-line").attr("y",r.layerY))},nt=function(r){var t=x.Ys("#shape-path-group #shape-path-".concat(r));if(t.node())t.attr("display","inline").attr("transform",null);else{t=x.Ys("#shape-path-group").append("path").attr("id","shape-path-".concat(r)).style("pointer-events","none");var e=z.line;Object.keys(e).forEach(function(n){t.attr(n,e[n])})}return t},Fr=function(){var r,t,e=(S==null||(r=S.current)===null||r===void 0?void 0:r.k)||1;(t=E.current)===null||t===void 0||t.forEach(function(n,a){var c,o=x.Ys("#shape-".concat(n)),i=o.node().getBBox(),l=i.x,s=i.y,f=i.width,h=i.height,p=nt(a);l=l*e||0,s=s*e||0,f=f*e||0,h=h*e||0;var v=[[l-2,s-2],[l+f+2,s-2],[l+f+2,s+h+2],[l-2,s+h+2]],b=B.current(v);p.attr("d",b+"Z");var w=(c=m.current)===null||c===void 0?void 0:c[n],R=w.rotate;if(R){var C=J()(R,3),j=C[0],k=C[1],G=C[2],K=k*e,V=G*e;o.attr("transform","rotate(".concat(j," ").concat(k,",").concat(G,")")),p.attr("transform","rotate(".concat(j," ").concat(K,",").concat(V,")"))}})},gr=function(){var r,t,e;return(r=E.current)!==null&&r!==void 0&&r.length?E.current:u.current?[(t=u.current)===null||t===void 0||(e=t.attr("id"))===null||e===void 0?void 0:e.substring(6)]:[]},at=function(r,t){var e,n,a,c=t,o=r,i="",l="";if(o instanceof Array)E.current=o,c=!0;else if(typeof o=="string")i="shape-"+o,o=g.current.select("#".concat(i));else{var s,f;i=(s=o)===null||s===void 0?void 0:s.attr("id"),l=(f=u.current)===null||f===void 0?void 0:f.attr("id")}if(c&&(l&&i!==l||E.current)){var h,p;if(u.current=null,i=(h=i)===null||h===void 0?void 0:h.substring(6),E.current)if(i){var b=E.current.indexOf(i);if(b>=0){var w;E.current.splice(b,1),(w=E.current)!==null&&w!==void 0&&w.length||(E.current=null)}else E.current.push(i);d.current.changeSelect(gr())}else d.current.changeSelect(gr());else{var v;l=(v=l)===null||v===void 0?void 0:v.substring(6),E.current=[i,l],d.current.changeSelect(gr())}(p=E.current)===null||p===void 0||p.forEach(function(V,_){nt(_)}),rr(),Fr();return}u.current=o,(e=x.td_("#shape-path-group *"))===null||e===void 0||e.attr("display","none"),E.current=null;var R=(n=m.current)===null||n===void 0?void 0:n[(a=i)===null||a===void 0?void 0:a.substring(6)],C=R.shape_type,j=R.hide;if(O.current&&x.Ys("#"+O.current).attr("fill",z.shapeCommon.fill),O.current===i)O.current="",(C==="line"||C==="polygon")&&(M.current="",g.current.selectAll("#path-point-group circle,#path-add-point").attr("display","none"),Ar());else if(O.current!==i)if(O.current=i,o.attr("fill",Zr(o.attr("stroke"))),C==="line"||C==="polygon"){var k;if(M.current=i,(k=g.current.selectAll("#path-point-group circle,#shape-grip-group"))===null||k===void 0||k.attr("display","none"),j){var G;(G=g.current.select("#path-add-point"))===null||G===void 0||G.attr("display","none")}else{var K;(K=g.current.select("#path-add-point"))===null||K===void 0||K.attr("display","inline"),Dr()}}else M.current="",g.current.selectAll("#path-point-group circle,#path-add-point").attr("display","none"),Ar();d.current.changeSelect(gr())},zr=function(r){var t,e,n,a=r||u.current;if(a){rr();var c=(t=a.attr("id"))===null||t===void 0?void 0:t.substring(6),o=H.current.indexOf(c);H.current.splice(o,1),a==null||a.remove(),(e=g.current.select("#shape-label-".concat(c)))===null||e===void 0||e.attr("display","none"),u.current=null,q.current=null,(n=m.current)===null||n===void 0||delete n[c]}},it=function(){var r,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,e={};if(E.current){var n,a={};return(n=E.current)===null||n===void 0||n.forEach(function(o){var i=x.Ys("#shape-".concat(o));e[o]=JSON.parse(JSON.stringify(m.current[o])),a[o]=i,zr(i)}),t&&pr("del",E.current,e,a),E.current=null,d.current.changeSize(fr()),d.current.changeSelect(gr()),[e,a]}if(u.current){var c=(r=u.current.attr("id"))===null||r===void 0?void 0:r.substring(6);return e[c]=JSON.parse(JSON.stringify(m.current[c])),t&&pr("del",u.current,e),zr(),d.current.changeSize(fr()),d.current.changeSelect(gr()),[e]}},ne=function(){var r,t;if(!(!L.current||!u.current)){var e=(r=u.current.attr("id"))===null||r===void 0?void 0:r.substring(6),n=((t=m.current)===null||t===void 0?void 0:t[e])||{},a=n.attrs.points,c=n.shape_type,o=a.length,i={};if(i[e]=JSON.parse(JSON.stringify(m.current[e])),o<=2){pr("del",u.current,i),zr(),rr();return}pr("edit",u.current,i),x.Ys("#path-point-group #path-point-".concat(o)).attr("display","none"),x.Ys("#path-point-group #path-point-".concat(L.current)).attr("fill",z.point.fill),a.splice(L.current-1,1),L.current=null;var l=B.current(a);c==="polygon"&&(l+="Z"),u.current.attr("d",l),Br(e,d.current.showLabel),Dr()}},St=function(r,t){var e=t.shape_type,n=t.attrs,a=t.rotate;if(e==="rect"||e==="ellipse"){var c=Object.keys(n);c==null||c.forEach(function(l){r.attr(l,n[l])})}else{var o=n.points,i=B.current(o);e==="polygon"&&(i+="Z"),r.attr("d",i)}a?r.attr("transform","rotate(".concat(a[0]," ").concat(a[1],",").concat(a[2],")")):r.attr("transform",null)},mt=function(r){var t=r||[],e=Ft()(t),n=e[0],a=e.slice(1),c=J()(a,3),o=c[0],i=c[1],l=c[2],s=[];if(n==="add")o instanceof Array?E.current=o:(E.current=null,u.current=o),s=it(!1);else if(n==="del"){if(o instanceof Array)o==null||o.forEach(function(C){var j;H.current.splice(C-1,0,+C),(j=g.current.select("#shape-label-".concat(C)))===null||j===void 0||j.attr("display","inline"),g.current.select("#shape").insert(function(){return l[C].node()})});else{var f,h,p=(f=Object.keys(i))===null||f===void 0?void 0:f[0];H.current.splice(p-1,0,p),(h=g.current.select("#shape-label-".concat(p)))===null||h===void 0||h.attr("display","inline"),g.current.select("#shape").insert(function(){return o.node()})}m.current=Object.assign({},m.current,i)}else if(n==="edit"){var v={};if(o instanceof Array)o==null||o.forEach(function(C){v[C]=JSON.parse(JSON.stringify(m.current[C])),St(l[C],i[C])}),s=[v,l];else{var b,w,R=(b=o.attr("id"))===null||b===void 0?void 0:b.substring(6);v[R]=JSON.parse(JSON.stringify(m.current[R])),St(o,(w=Object.values(i))===null||w===void 0?void 0:w[0]),s=[v]}m.current=Object.assign({},m.current,i)}return E.current=null,u.current=null,d.current.changeSize(fr()),d.current.changeSelect([]),rr(),tt(),n==="del"?[o]:[o].concat(tr()(s))},ae=function(){if(cr.current.length){var r=cr.current.pop(),t=r||[],e=J()(t,1),n=e[0],a=mt(r);if(n==="add"){or.current.push(["del"].concat(tr()(a)));return}else n==="del"?or.current.push(["add"].concat(tr()(a))):n==="edit"&&or.current.push([n].concat(tr()(a)))}},ie=function(){if(or.current.length){var r=or.current.pop(),t=r||[],e=J()(t,1),n=e[0],a=mt(r);if(n==="add")cr.current.push(["del"].concat(tr()(a)));else if(n==="del"){cr.current.push(["add"].concat(tr()(a)));return}else n==="edit"&&cr.current.push([n].concat(tr()(a)))}},bt=function(r,t){var e,n=t||u.current;if(n){var a=d.current.showLabel,c=J()(r,2),o=c[0],i=c[1],l=n==null||(e=n.attr("id"))===null||e===void 0?void 0:e.substring(6),s=m.current[l],f=s.attrs,h=s.shape_type,p=s.rotate,v={};if(h==="rect"){var b=f.x,w=f.y,R=f.width,C=f.height;b+=o,w+=i,n.attr("x",b).attr("y",w),v={x:b,y:w,width:R,height:C}}else if(h==="ellipse"){var j=f.cx,k=f.cy,G=f.rx,K=f.ry;j+=o,k+=i,n.attr("cx",j).attr("cy",k),v={cx:j,cy:k,rx:G,ry:K}}else{for(var V=f.points,_=h==="polygon",$=(V==null?void 0:V.length)||0,er=[],nr=0;nr<$;nr++){var vr=J()(V[nr],2),xr=vr[0],yr=vr[1];xr+=o,yr+=i,er[nr]=[xr,yr]}var kr=B.current(er);n.attr("d",kr+(_?"Z":"")),v={points:er},er=null}if(p){var lr,ur=n==null||(lr=n.node())===null||lr===void 0?void 0:lr.getBBox(),Or=ur.x,Yr=ur.y,Sr=ur.width,Mr=ur.height,Pr=Or+Sr/2,Jr=Yr+Mr/2;m.current[l].rotate[1]=Pr,m.current[l].rotate[2]=Jr}m.current[l].attrs=v,E.current?Fr():h==="rect"||h==="ellipse"?Ar():Dr(),Br(l,a)}},ct=function(r){if(E.current){var t;(t=E.current)===null||t===void 0||t.forEach(function(e){var n=x.Ys("#shape-".concat(e));bt(r,n)});return}bt(r)},Qr=function(r,t,e){var n=g.current.select("#shape-label-".concat(r)),a=d.current.showLabel;if(n.node()){n.text(t).attr("display","inline"),Br(r,a,!0);return}var c=g.current.select("#shape-label-group").append("text").attr("id","shape-label-".concat(r)).style("user-select","none").text(t),o=Object.assign({},z.font);e&&(o["text-anchor"]="middle"),Object.keys(o).forEach(function(i){c.attr(i,o[i])}),Br(r,a)},ce=function(r){var t,e;if(u.current){var n=(t=u.current)===null||t===void 0||(e=t.attr("id"))===null||e===void 0?void 0:e.substring(6),a=$r(n),c=a.centerX,o=a.centerY,i=a.gripCenterX,l=a.gripCenterY,s=r[0]-c,f=o-r[1],h=Math.atan2(f,s)*180/Math.PI;h<-90?h=-270-h:h=90-h,u.current.attr("transform","rotate(".concat(h," ").concat(c,",").concat(o,")")),g.current.select("#shape-grip-group").attr("transform","rotate(".concat(h," ").concat(i,",").concat(l,")")),d.current.showLabel&&g.current.select("#shape-label-".concat(n)).attr("transform","rotate(".concat(h," ").concat(i,",").concat(l,")")),m.current[n].rotate=[h,c,o]}},mr=function(r){for(var t=arguments.length,e=new Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];var a=e[0],c=e[1],o=dr(a),i=o[0]-P.current.mx,l=o[1]-P.current.my;if(r==="moveGrip"){var s,f,h,p="",v=(s=u.current)===null||s===void 0||(f=s.attr("id"))===null||f===void 0?void 0:f.substring(6),b=(h=m.current)===null||h===void 0?void 0:h[v],w=b.shape_type,R=b.rotate;if(R){var C=J()(R,3),j=C[0],k=C[1],G=C[2];o=Kr.apply(void 0,tr()(o).concat([k,G,j,!0])),i=o[0]-P.current.mx,l=o[1]-P.current.my}Y.current?p=Y.current.substring(12):p=c.attr("id").substring(12);var K=Kt(w,W.current,p,i,l,P.current);if(w==="polygon"||w==="line"){var V=B.current(K.points);u.current.attr("d",V+(P.current.close?"Z":""))}else Object.keys(K).forEach(function(Pr){u.current.attr(Pr,K[Pr])});m.current[v].attrs=K,Ar(),Br(v,d.current.showLabel),Y.current&&R&&(_r(),x.Ys("#"+Y.current).attr("fill",z.grip.fill),Y.current=null);return}if(r==="moveShape"){ct([a.dx,a.dy]);return}if(r==="moveWhole"){var _,$;S.current=S.current.translate(i,l),x.sPX().transform(g.current,S.current),g.current.selectAll("g.layer").attr("transform",S.current),g.current.selectAll("g#shape-related-group").attr("transform","translate(".concat((_=S.current)===null||_===void 0?void 0:_.x,",").concat(($=S.current)===null||$===void 0?void 0:$.y,")")),Xr();return}if(r==="movePoint"){var er,nr,vr,xr="",yr=(er=u.current)===null||er===void 0||(nr=er.attr("id"))===null||nr===void 0?void 0:nr.substring(6),kr=m.current[yr],lr=kr.attrs.points,ur=kr.shape_type,Or=(S==null||(vr=S.current)===null||vr===void 0?void 0:vr.k)||1,Yr=ur==="polygon";L.current?xr=L.current:xr=c.attr("id").substring(11);var Sr=lr[xr-1];Sr[0]=Sr[0]+a.dx/Or,Sr[1]=Sr[1]+a.dy/Or,lr[xr-1]=Sr,m.current[yr].attrs={points:lr};var Mr=B.current(lr);u.current.attr("d",Mr+(Yr?"Z":"")),Dr(),Br(yr,d.current.showLabel);return}if(r==="moveRotate"){ce(o);return}},oe=function(r){var t=(r==null?void 0:r.target)||(r==null?void 0:r.srcElement),e=x.Ys(t).attr("id"),n=q.current||[],a=n.length;if(x.td_("#path-point-group circle").attr("r",z.point.r),r.type==="touchstart"||r.type==="mouseenter"){if(Q.current&&(e!=="path-point-1"||a<3))return;x.Ys("#".concat(e)).attr("r",6),x.Ys(t).style("cursor","pointer")}else x.Ys(t).style("cursor",null)},ot=function(r,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=x.Ys("#path-point-group"),a=n.selectAll("circle"),c=a.size(),o=z.point;if(!c||c<=t){var i=n.append("circle").attr("id",r).call(Rr("point",mr));return i.on("touchstart touchend mouseenter mouseleave",oe),Object.keys(o).forEach(function(l){i.attr(l,o[l])}),i.attr("display",e?"inline":"none"),i}return x.Ys("#"+r).attr("display",e?"inline":"none")},le=function(r){var t,e=dr(r),n=O.current.substring(6),a=(t=m.current)===null||t===void 0?void 0:t[n],c=a.attrs.points,o=a.shape_type,i=a.rotate,l=c.length,s=-1,f=1/0,h={};if(h[n]=JSON.parse(JSON.stringify(m.current[n])),pr("edit",u.current,h),i){var p=J()(i,3),v=p[0],b=p[1],w=p[2];e=Kr.apply(void 0,tr()(e).concat([b,w,v,!0]))}for(var R=0;R<l;R++){var C=(R+1)%l,j=c[R],k=c[C],G=Ht(e,j,k);G<f&&(s=C,f=G)}c.splice(s,0,e);var K=B.current(c);o==="polygon"&&(K+="Z"),u.current.attr("d",K),_r();var V="path-point-".concat(l+1);ot(V,l),Dr()},wt=function(r){var t,e;(t=x.Ys("#path-stretch-line"))===null||t===void 0||t.attr("display","none");var n=u.current.attr("d");r&&u.current.attr("d",n+"Z");var a=(e=u.current.attr("id"))===null||e===void 0?void 0:e.substring("6"),c=d.current,o=c.curLabel,i=c.colorBindLabel;i&&o&&!D.current[o]&&(D.current[o]=z.shapeCommon.stroke,d.current.changeBindColor(D.current)),o=o||a,m.current[a]={shape_type:r?"polygon":"line",label:o,attrs:{points:q.current}},q.current=null,M.current="shape-".concat(a),O.current=M.current,x.Ys("#"+O.current).attr("fill",Zr(u.current.attr("stroke"))),d.current.changeSize(fr()),d.current.changeSelect(gr()),Qr(a,o,!0),g.current.select("#path-add-point").attr("display","inline"),yt(a),pr("add",u.current),d.current.endDraw({id:a,label:o})},ue=function(r,t,e,n){var a,c=(r==null?void 0:r.sourceEvent)||r,o=q.current||[],i=o==null?void 0:o.length;if(c.button===2){if(!i)return;i<2?zr():wt();return}if(e==="point"&&n.attr("id")==="path-point-1"&&i>=3){wt(!0);return}var l=x.Ys("#path-point-group").attr("transform",null),s=l.selectAll("circle"),f=s.size(),h=dr(r),p=J()(h,2),v=p[0],b=p[1],w=z.line;if(i){q.current.push([v,b]);var k=B.current(q.current);u.current.attr("d",k)}else{var R;Q.current=!0,rr(),(R=x.Ys("#path-stretch-line"))===null||R===void 0||R.attr("display","inline"),Gr();var C=Object.assign({},z.shapeCommon,z[t]);u.current=A.current.select("#shape").append(t).call(Rr("shape",mr));var j=Er();u.current.attr("id","shape-".concat(j)),Object.keys(C).forEach(function($){u.current.attr($,C[$])}),q.current=[[v,b]]}(!f||!l.select("#path-stretch-line").size())&&(l.append("path").attr("id","path-stretch-line").style("pointer-events","none"),Object.keys(w).forEach(function($){x.Ys("#path-stretch-line").attr($,w[$])}));var G="path-point-".concat(i+1);ot(G,i);var K=(S==null||(a=S.current)===null||a===void 0?void 0:a.k)||1,V=v*K,_=b*K;x.Ys("#"+G).attr("cx",V).attr("cy",_),rt(r)},xt=function(r){te(r),ee(r),rt(r)},se=function(r,t,e){var n=d.current.drawTool;if(!(!n||t.defaultPrevented)){if(r==="grip"){var a=e.attr("id");Y.current&&x.Ys("#"+Y.current).attr("fill",z.grip.fill),Y.current===a?Y.current=null:(Y.current=a,e.attr("fill","#ff0"),et(t));return}if(Y.current){var c=Ur();pr.apply(void 0,["edit"].concat(tr()(c))),c=null,mr("moveGrip",t,e),d.current.changeSize(fr());return}if(r==="point"){var o=e.attr("id").substring(11);L.current&&x.Ys("#path-point-"+L.current).attr("fill",z.point.fill),L.current===o?L.current=null:(L.current=o,e.attr("fill","#ff0"),et(t));return}if(L.current){var i=Ur();pr.apply(void 0,["edit"].concat(tr()(i))),i=null,mr("movePoint",t,e),d.current.changeSize(fr());return}if(r==="insertPoint"){le(t);return}if(r==="shape"){var l;at(e,W.current||(t==null||(l=t.sourceEvent)===null||l===void 0?void 0:l.shiftKey));return}if(r==="whole"){rr(),u.current=null,E.current=null,d.current.changeSelect([]);return}}},Ct=function(){if(!u.current||!Z.current)return!1;Z.current=!1,rr();var r=_t();if(r)return!1;var t=d.current,e=t.drawTool,n=t.curLabel,a=t.colorBindLabel,c=Er();a&&n&&!D.current[n]&&(D.current[n]=z.shapeCommon.stroke,d.current.changeBindColor(D.current)),n=n||c,u.current.attr("id","shape-".concat(c)),m.current[c]={shape_type:e,label:n,attrs:q.current},q.current=null,Ar(),d.current.changeSize(fr()),Qr(c,n,e==="ellipse"),pr("add",u.current),d.current.endDraw({id:c,label:n})},de=function(r){var t=dr(r);Z.current=!0,u.current=null,rr();var e=J()(t,2);return P.current.x=e[0],P.current.y=e[1],x.Ys("#shape-selector").attr("display","inline").attr("x",t[0]).attr("y",t[1]).attr("width",0).attr("height",0),!1},ve=function(){var r,t=x.Ys("#shape-selector").node().getBoundingClientRect(),e=Object.keys(m.current),n=[],a=(S==null||(r=S.current)===null||r===void 0?void 0:r.k)||1;e==null||e.forEach(function(c){var o=x.Ys("#shape-".concat(c)),i=n.length,l=x.Ys("#shape-path-group #shape-path-".concat(i)),s=o.node().getBoundingClientRect(),f=s.bottom>t.top&&s.top<t.bottom&&s.left<t.right&&s.right>t.left;if(f){var h;n.push(c);var p=o.node().getBBox(),v=p.x,b=p.y,w=p.width,R=p.height;l.node()?l.attr("display","inline").attr("transform",null):l=nt(i),v=v*a||0,b=b*a||0,w=w*a||0,R=R*a||0;var C=[[v-2,b-2],[v+w+2,b-2],[v+w+2,b+R+2],[v-2,b+R+2]],j=B.current(C);l.attr("d",j+"Z");var k=(h=m.current)===null||h===void 0?void 0:h[c],G=k.rotate;if(G){var K=J()(G,3),V=K[0],_=K[1],$=K[2],er=_*a,nr=$*a;l.attr("transform","rotate(".concat(V," ").concat(er,",").concat(nr,")"))}}else{var vr;(vr=l)===null||vr===void 0||vr.attr("display","none")}}),E.current=(n==null?void 0:n.length)&&n},fe=function(r){var t;if(!Z.current)return!1;var e=dr(r),n=P.current,a=n.x,c=n.y,o=e[0]-a,i=e[1]-c,l=(S==null||(t=S.current)===null||t===void 0?void 0:t.k)||1,s=Math.abs(o),f=Math.abs(i);return o<0&&(a=e[0]),i<0&&(c=e[1]),a=a*l||0,c=c*l||0,s=s*l||0,f=f*l||0,x.Ys("#shape-related-group #shape-selector").attr("x",a).attr("y",c).attr("width",s).attr("height",f),ve(),!1},he=function(){if(!Z.current)return!1;Z.current=!1,x.td_("#shape-related-group #shape-selector").attr("display","none")},pe=function(r,t,e){var n;return r==="grip"?"moveGrip":r==="rotate"?"moveRotate":r==="point"&&!Q.current?"movePoint":r==="insertPoint"?r:t==="drag"||sr.current&&!W.current&&!I.current?"moveWhole":r==="shape"&&!sr.current&&(t==="move"||O.current===e.attr("id")||E.current&&E.current.includes((n=e.attr("id"))===null||n===void 0?void 0:n.substring(6)))?"moveShape":r==="whole"&&t==="move"&&!sr.current&&!I.current?"selectShape":t==="rect"||t==="ellipse"?"shape":t},Rr=function(r,t){var e="",n="",a=null,c=!1,o=null;return x.ohM().filter(function(i){return jr(),e=d.current.drawTool,a=x.Ys(this),n=pe(r,e,a),e?!i.button||i.button===2&&Q.current&&n==="path":!1}).on("start",function(i){var l,s;if(i==null||(l=i.sourceEvent)===null||l===void 0||l.stopPropagation(),i==null||(s=i.sourceEvent)===null||s===void 0||s.preventDefault(),U.current=!1,c=!1,!(Y.current||L.current)){if(n==="path"){E.current=null,ue(i,e,r,a);return}if(n==="moveShape"){var f,h,p=(f=a.attr("id"))===null||f===void 0?void 0:f.substring(6);if(!E.current&&O.current!==a.attr("id")||E.current&&!E.current.includes(p)){var v;c=!0,at(a,W.current||(i==null||(v=i.sourceEvent)===null||v===void 0?void 0:v.shiftKey))}(I.current||i!=null&&(h=i.sourceEvent)!==null&&h!==void 0&&h.altKey)&&Ot()}else if(n.indexOf("move")>=0&&n.length>4)if(n==="moveWhole"){S.current=S.current||x.CRH;var b=dr(i),w=J()(b,2);P.current.mx=w[0],P.current.my=w[1]}else if(n==="moveGrip")et(i);else{var R=dr(i),C=J()(R,2);P.current.mx=C[0],P.current.my=C[1]}n.indexOf("move")>=0&&n.length>4&&n!=="moveWhole"&&(o=Ur())}}).on("drag",function(i){var l,s;if(i==null||(l=i.sourceEvent)===null||l===void 0||l.stopPropagation(),i==null||(s=i.sourceEvent)===null||s===void 0||s.preventDefault(),i!=null&&i.sourceEvent&&xt(i.sourceEvent),!(Y.current||L.current||n==="path"||n==="insertPoint")&&!(i.dx===0&&i.dy===0)){if(U.current=!0,n.indexOf("move")>=0){t(n,i,a);return}if(n==="shape"){Z.current?ye(i,e):(E.current=null,ge(i,e));return}n==="selectShape"&&(Z.current?fe(i):de(i))}}).on("end",function(i){var l,s;if(i==null||(l=i.sourceEvent)===null||l===void 0||l.stopPropagation(),i==null||(s=i.sourceEvent)===null||s===void 0||s.preventDefault(),U.current)if(n==="shape"){Ct(),d.current.changeSelect(gr());return}else if(n==="selectShape"){he(),d.current.changeSelect(gr());return}else n!=="moveWhole"&&n.indexOf("move")>=0&&n.length>4&&((n==="moveGrip"||n==="movePoint")&&_r(),d.current.changeSize(fr()),o&&pr.apply(void 0,["edit"].concat(tr()(o))),o=null);else if(Q.current&&n==="path")q.current||(Q.current=!1);else if(!c){se(r,i,a);return}})},lt=function(r){var t,e="",n=e.drawTool;return x.sPX().scaleExtent((t=d.current)===null||t===void 0?void 0:t.scaleExtent).filter(function(a){return(!a.ctrlKey||a.type==="wheel")&&!a.button}).on("start",function(a){var c,o;n=d.current.drawTool,jr(),a==null||(c=a.sourceEvent)===null||c===void 0||c.stopPropagation(),a==null||(o=a.sourceEvent)===null||o===void 0||o.preventDefault()}).on("zoom",function(a){var c,o;a==null||(c=a.sourceEvent)===null||c===void 0||c.stopPropagation(),a==null||(o=a.sourceEvent)===null||o===void 0||o.preventDefault(),n&&r&&r(a)}).on("end",function(a){var c,o;a==null||(c=a.sourceEvent)===null||c===void 0||c.stopPropagation(),a==null||(o=a.sourceEvent)===null||o===void 0||o.preventDefault()})},Et=function(r){var t,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;e&&(S.current=r.transform),g.current.selectAll("g.layer").attr("transform",S.current),g.current.selectAll("g#shape-related-group").attr("transform","translate(".concat(S.current.x,", ").concat(S.current.y,")")),(t=E.current)!==null&&t!==void 0&&t.length?Fr():(Ar(),e?Dr(r):Dr()),tt(),Xr(),ir.current=S.current.k,d.current.changeScale(ir.current)},Rt=function(r){var t,e,n=!0,a=r;if(!a){var c;a=u.current,a.attr("fill",z.shapeCommon.fill),n=!1,(c=g.current.select("#path-add-point"))===null||c===void 0||c.attr("display","inline")}var o=(t=a.attr("id"))===null||t===void 0?void 0:t.substring(6),i=m.current[o],l=i.label,s=i.shape_type,f=a.clone(),h=Er();return f=A.current.select("#shape").append(function(){return f.node()}).attr("id","shape-".concat(h)).call(Rr("shape",mr)),m.current[h]=JSON.parse(JSON.stringify((e=m.current)===null||e===void 0?void 0:e[o])),Qr(h,l,s!=="rect"),n?""+h:(f.attr("fill",Zr(f.attr("stroke"))),O.current="shape-".concat(h),f)},Ot=function(){if(E.current){var r,t=[];(r=E.current)===null||r===void 0||r.forEach(function(e){var n=x.Ys("#shape-".concat(e));t.push(Rt(n))}),E.current=t,d.current.changeSelect(gr()),pr("add",E.current);return}u.current&&(u.current=Rt(),d.current.changeSelect(gr()),pr("add",u.current))},ge=function(r,t){var e=dr(r);Z.current=!0,u.current=A.current.select("#shape").append(t).call(Rr("shape",mr)),Gr();var n=Object.assign({},z.shapeCommon,z[t]),a="x",c="y";t==="ellipse"&&(a="cx",c="cy");var o=J()(e,2);P.current.x=o[0],P.current.y=o[1];var i=J()(e,2);return n[a]=i[0],n[c]=i[1],Object.keys(n).forEach(function(l){u.current.attr(l,n[l])}),!1},ye=function(r,t){if(!u.current||!Z.current)return!1;var e=dr(r),n=P.current,a=n.x,c=n.y,o=e[0]-a,i=e[1]-c;if(t==="rect"){var l=Math.abs(o),s=Math.abs(i);return o<0&&(W.current&&l<s?a=a-s:a=e[0]),i<0&&(W.current&&l>s?c=c-l:c=e[1]),W.current&&(l>s?s=l:l=s),q.current={x:a,y:c,width:l,height:s},u.current.attr("x",a).attr("y",c).attr("width",l).attr("height",s),!1}if(t==="ellipse"){var f=o/2||0,h=i/2||0,p=Math.abs(f),v=Math.abs(h);W.current&&(p>v?(h=h>0?p:-p,v=p):(f=f>0?v:-v,p=v)),a=a+f,c=c+h,q.current={cx:a,cy:c,rx:p,ry:v},u.current.attr("cx",a).attr("cy",c).attr("rx",p).attr("ry",v)}return!1},Se=function(r){if(r!=="path"&&Q.current){zr(),Q.current=!1;return}},me=function(){if(Z.current){Ct();return}},be=function(r){sr.current=r.ctrlKey,I.current=r.altKey,W.current=r.shiftKey;var t=r.keyCode||r.which||r.charCode;if(Q.current){t===27&&zr();return}if(t===8||t===46){L.current?(ne(),d.current.changeSize(fr())):it();return}if(sr.current&&t===67){var e;wr.current=E.current&&tr()(E.current)||((e=u.current)===null||e===void 0?void 0:e.attr("id"))||null}if(sr.current&&t===86){if(!wr.current)return;rr();var n=Jt()(wr.current)==="object";n?E.current=tr()(wr.current):u.current=x.Ys("#".concat(wr.current)),Ot(),n?Fr():["rect","ellipse"].includes(m.current[wr.current.substring(6)].shape_type)?Ar():Dr(),d.current.changeSize(fr())}if([37,38,39,40].includes(t)){var a=0,c=0;t===37?a=-1:t===38?c=-1:t===39?a=1:t===40&&(c=1);var o=Ur();pr.apply(void 0,["edit"].concat(tr()(o))),o=null,ct([a,c])}},we=function(r){sr.current=r.ctrlKey,I.current=r.altKey,W.current=r.shiftKey},Yt=function(r){r?x.Ys("body").on("keyup",we):(x.Ys("body").on("keyup",null),sr.current=!1,I.current=!1,W.current=!1,me())},xe=function(){var r;(r=x.Ys(N.current).select("div>svg"))===null||r===void 0||r.remove(),g.current=x.Ys(N.current).selectChild("div").append("svg").attr("id","svgroot");var t=g.current.append("defs"),e=t.append("pattern").attr("id","gridPattern").attr("patternUnits","userSpaceOnUse").attr("x",0).attr("y",0).attr("width","10").attr("height","10"),n=e.append("rect");n.attr("fill","none").attr("stroke","#787878").attr("stroke-width","0.5").attr("x",0).attr("y",0).attr("width","100%").attr("height","100%"),A.current=g.current.append("svg").attr("id","svgcont"),A.current.append("g").attr("class","layer").attr("id","img").style("pointer-events","none"),A.current.append("g").attr("class","layer").attr("id","shape");var a=g.current.append("g").attr("id","shape-related-group"),c=a.append("rect").attr("id","shape-selector").attr("display","none").style("pointer-events","none"),o=Object.assign({},z.rect,z.selectBox);Object.keys(o).forEach(function(k){c.attr(k,o[k])});var i=a.append("path").attr("id","path-add-point").attr("display","none"),l=z.pathAddPoint;Object.keys(l).forEach(function(k){i.attr(k,l[k])});var s=a.append("g").attr("class","grip-layer").attr("id","shape-grip-group").attr("display","none"),f=s.append("path").attr("id","resize-path").style("pointer-events","none"),h=z.line;Object.keys(h).forEach(function(k){f.attr(k,h[k])});for(var p=0;p<8;p++)s.append("rect").attr("id","resize-grip-"+ht[p]).style("cursor",ht[p]+"-resize");var v=z.grip;if(Object.keys(v).forEach(function(k){x.td_("#shape-grip-group rect").attr(k,v[k])}),d.current.rotateEnable){var b=s.append("line").attr("id","rotate-line").style("pointer-events","none"),w=z.rotateLine;Object.keys(w).forEach(function(k){b.attr(k,w[k])});var R=s.append("circle").attr("id","rotate-circle").attr("class","w-svg-rotate"),C=z.rotateCircle;Object.keys(C).forEach(function(k){R.attr(k,C[k])})}a.append("g").attr("class","point_layer").attr("id","path-point-group"),a.append("g").attr("class","path_layer").attr("id","shape-path-group").style("pointer-events","none"),a.append("g").attr("class","label_layer").attr("id","shape-label-group").attr("display","none").style("pointer-events","none"),a.append("rect").attr("id","grid").attr("display","none").style("pointer-events","none").attr("x",0).attr("y",0).attr("width","0").attr("height","0").attr("fill","url(#gridPattern)").attr("stroke","none");var j=g.current.append("g").attr("class","crosshair_layer").style("pointer-events","none").attr("display","none");j.append("rect").attr("id","crosshair-v-line").attr("width",.5).attr("height","100%"),j.append("rect").attr("id","crosshair-h-line").attr("width","100%").attr("height",.5),j.selectAll("rect").attr("x",0).attr("y",0).attr("fill","#00f").attr("stroke","none")},Ir=function(){var r=N.current.getBoundingClientRect(),t=r.right-r.left||z.svg.width,e=r.bottom-r.top||z.svg.height,n=[t,e];z.svg.width=n[0],z.svg.height=n[1],x.Ys("#svgcanvas").style("width",t+"px").style("height",e+"px"),x.td_("#svgroot,#svgcont").attr("width",t).attr("height",e)},Ce=function(){g.current.on("mousemove touchmove",xt).call(Rr("whole",mr)).call(lt(function(r){Et(r)})).on("dblclick.zoom",null),x.td_("#shape-grip-group rect").call(Rr("grip",mr)),d.current.rotateEnable&&x.Ys("#shape-grip-group circle").call(Rr("rotate",mr)),g.current.select("#path-add-point").call(Rr("insertPoint",mr))},Ee=function(){B.current=x.jvg(),xe(),Ir(),Ce(),ut(d.current.showCrosshair)},Lt=function(){g.current.selectAll("g.layer,g#shape-related-group").attr("transform",null),S.current=null,g.current.call(lt().transform,x.CRH),d.current.changeScale("1")},kt=function(){var r,t,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;cr.current=[],or.current=[],rr(),u.current&&(u.current=null),E.current&&(E.current=null),m.current={},e&&d.current.changeSize(fr()),H.current=[],d.current.changeSelect([]),(r=g.current.selectAll("#shape *"))===null||r===void 0||r.remove(),(t=g.current.selectAll("#shape-label-group *"))===null||t===void 0||t.attr("display","none")},Re=function(){var r,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(r=A.current.select("g#img").select("image"))===null||r===void 0||r.remove(),kt(t),Lt()},Oe=function(r){var t,e,n=m.current[r].hide,a=(t=u.current)===null||t===void 0||(e=t.attr("id"))===null||e===void 0?void 0:e.substring(6);if(n=!n,m.current[r].hide=n,g.current.selectAll("g#shape #shape-".concat(r,",#shape-label-").concat(r)).attr("display",n?"none":"inline"),E.current&&E.current.includes(r)){var c,o=E.current.indexOf(r);if(E.current.splice(o,1),!((c=E.current)!==null&&c!==void 0&&c.length))E.current=null,x.td_("#shape-path-group *").attr("display","none"),d.current.changeSelect([]);else{var i;(i=x.Ys("#shape-path-".concat(E.current.length)))===null||i===void 0||i.attr("display","none"),Fr(),d.current.changeSelect(gr())}}else a&&a===r&&(rr(),u.current=null,d.current.changeSelect([]));d.current.changeSize(fr())},Pt=function(r){return r?(Ir(),new Promise(function(t){var e=new Image;e.onload=function(n){var a,c,o=n.target.width,i=n.target.height,l=o,s=i,f=0,h=0,p=1,v=z.svg,b=v.width,w=v.height,R=b/w,C=o/i;R>C?(s=w,l=s*C,p=i/s):(l=b,s=l/C,p=o/l),f=(b-l)/2,h=(w-s)/2,hr.current={x:f,y:h,scale:p,w:l,h:s},(a=A.current.select("g#img").select("image"))===null||a===void 0||a.remove(),(c=A.current.select("g#img").append("image").attr("width",l).attr("height",s).attr("x",f).attr("y",h).attr("xlink:href",r).attr("draggable","false"))===null||c===void 0||c.style("filter",Lr.current),Xr(),d.current.imgLoaded({width:o,height:i}),t(!0)},e.onerror=function(){d.current.imgLoaded(!1),t(!1)},e.src=r})):!1},Ye=function(r){if(r){var t=Object.keys(m.current);t==null||t.forEach(function(e){var n=g.current.select("#shape-".concat(e));g.current.select("#shape-label-".concat(e)).attr("fill",n.attr("stroke"))})}},Le=function(r){g.current.select("#grid").attr("display",r&&(!S.current||S.current.k>=1)?"inline":"none"),Xr(!0)},ut=function(r){g.current.select(".crosshair_layer").attr("display",r&&F.drawTool!=="move"&&F.drawTool!=="drag"?"inline":"none")},ke=function(r){var t;Lr.current=r,(t=A.current.select("#img image"))===null||t===void 0||t.style("filter",r)},Pe=function(r){g.current.select("#shape-label-group").attr("display",r?"inline":"none"),tt(!0),Ye(r)},De=function(r,t){if(m.current[r]){m.current[r].label=t,g.current.select("#shape-label-".concat(r)).text(t),d.current.changeSize(fr());var e=d.current,n=e.colorBindLabel,a=e.curLabel;if(n){var c="",o=D.current[t];a?c=D.current[t]||ft(D.current):c=z.shapeCommon.stroke,Hr(r,c),o||(D.current[t]=c,d.current.changeBindColor(D.current))}}},je=function(r){var t=+ir.current,e=0,n=d.current.scaleExtent;isNaN(r)?r==="enlarge"?(e=(n[1]-t)/20,e=e>.1?e:.2,t=t+e):r==="narrow"&&(e=(t-n[0])/5,t=t-e):t=+r,t=t<n[0]?n[0]:t,t=t>n[1]?n[1]:t,lt().scaleTo(g.current,t),S.current=x.P2S(g.current.node()),Et(S.current,!1)},Ae=function(r){if(!r||!(r!=null&&r.length))return[];var t=[];try{t=r.map(function(e){var n;if(!(e!=null&&e.attrs))return e;var a=e.attrs,c=e.shape_type,o=vt()(e,Qt);if(c.indexOf("rect")>=0){var i=a,l=i.x,s=i.y,f=i.width,h=i.height;return a=[[l,s],[l+f,s+h]],br()({points:a,shape_type:"rectangle"},o)}else if(c==="ellipse"){var p=a,v=p.cx,b=p.cy,w=p.rx,R=p.ry;return w===R?(a=[[v,b],[v,b+R]],br()({points:a,shape_type:"circle"},o)):(a=[[v,b],[v,b+R],[v+w,b]],br()({points:a,shape_type:"ellipse"},o))}return br()({points:(n=a)===null||n===void 0?void 0:n.points,shape_type:c},o)})}catch(e){console.error(e.toString())}return t},Be=function(r){if(!r||!(r!=null&&r.length))return[];var t=[];try{t=r.map(function(e,n){var a;if(e=br()(br()({},e),{},{id:"".concat(n+1)}),(a=e)!==null&&a!==void 0&&a.attrs)return e;var c=e,o=c.points,i=c.shape_type,l=vt()(c,Vt);if(i.indexOf("rect")>=0){var s=o,f=J()(s,2),h=J()(f[0],2),p=h[0],v=h[1],b=J()(f[1],2),w=b[0],R=b[1],C=Math.abs(w-p),j=Math.abs(R-v),k=p,G=v;return k>w&&(k=w),G>R&&(G=R),o={x:k,y:G,width:C,height:j},br()({attrs:o,shape_type:"rect"},l)}else if(i==="circle"){var K=o,V=J()(K,2),_=J()(V[0],2),$=_[0],er=_[1],nr=J()(V[1],2),vr=nr[0],xr=nr[1],yr=Math.sqrt(Math.pow(vr-$,2)+Math.pow(xr-er,2));return o={cx:$,cy:er,rx:yr,ry:yr},br()({attrs:o,shape_type:"ellipse"},l)}else if(i==="ellipse"){var kr=o,lr=J()(kr,3),ur=J()(lr[0],2),Or=ur[0],Yr=ur[1],Sr=J()(lr[1],2),Mr=Sr[1],Pr=J()(lr[2],1),Jr=Pr[0],Vr=Mr-Yr,qr=Jr-Or;return o={cx:Or,cy:Yr,rx:qr,ry:Vr},br()({attrs:o,shape_type:"ellipse"},l)}else if(i==="polygon")return br()({attrs:{points:o},shape_type:i},l);return br()({attrs:{points:o},shape_type:"line"},l)})}catch(e){console.error(e.toString())}return t},Me=function(r,t,e,n,a,c){H.current.push(r),m.current[r]={label:e,shape_type:t,hide:n,attrs:a,rotate:c},e&&Qr(r,e,t!=="rect"),g.current.selectAll("g#shape #shape-".concat(r,",#shape-label-").concat(r)).attr("display",n?"none":"inline")},ze=function(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!(!r||!(r!=null&&r.length)))try{var e=hr.current,n=e.x,a=e.y,c=e.scale,o=A.current.select("#shape");r.forEach(function(i){var l=i.attrs,s=i.id,f=i.hide,h=i.label,p=i.shape_type,v=i.rotate,b=null,w=null,R=null;if(p==="rect"||p==="ellipse"){var C,j=Nr(p),k=l[j.x],G=l[j.y],K=l[j.w],V=l[j.h];if(!+K||!+V)return;s||(s=Er()),b=o.append(p).attr("id","shape-".concat(s)).call(Rr("shape",mr)),Gr(h);var _=Object.assign({},z.shapeCommon,z[p]);if(Object.keys(_).forEach(function(Tr){b.attr(Tr,_[Tr])}),k=+k/c+n,G=+G/c+a,K=K/c,V=V/c,b.attr(j.x,k).attr(j.y,G).attr(j.w,K).attr(j.h,V),w=(C={},Wr()(C,j.x,k),Wr()(C,j.y,G),Wr()(C,j.w,K),Wr()(C,j.h,V),C),v){var $=$r(s),er=$.centerX,nr=$.centerY;R=[v,er,nr],b.attr("transform","rotate(".concat(v," ").concat(er,",").concat(nr,")"))}}else{s||(s=Er()),Gr(h);var vr=l.points,xr=vr.length,yr=o.append("path").attr("id","shape-".concat(s)).call(Rr("shape",mr)),kr=Object.assign({},z.shapeCommon,z.path),lr=[];Object.keys(kr).forEach(function(Tr){yr.attr(Tr,kr[Tr])});for(var ur=0;ur<xr;ur++){var Or=J()(vr[ur],2),Yr=Or[0],Sr=Or[1];Yr=+Yr/c+n,Sr=+Sr/c+a,lr[ur]=[Yr,Sr];var Mr="path-point-".concat(ur+1);ot(Mr,ur,!1)}var Pr=B.current(lr);if(p==="polygon"&&(Pr+="Z"),yr.attr("d",Pr),w={points:lr},v){var Jr=$r(s),Vr=Jr.centerX,qr=Jr.centerY;R=[v,Vr,qr],yr.attr("transform","rotate(".concat(v," ").concat(Vr,",").concat(qr,")"))}}i.id=s,Me(s,p,h,f,w,R)}),d.current.changeBindColor(D.current),t&&d.current.changeSize(r)}catch(i){console.error(i.toString())}},Je=function(){return cr.current.length>0},Ne=function(){return or.current.length>0},Fe=function(r){r&&!N.current&&(N.current=r)};return(0,T.useEffect)(function(){return N.current&&(Ee(),window.addEventListener("resize",Ir)),function(){x.Ys("body").on("keyup",null),window.removeEventListener("resize",Ir)}},[]),(0,T.useEffect)(function(){F.src!==d.current.src&&Pt(F.src),F.drawTool!==d.current.drawTool&&(Se(F.drawTool),ut(F.showCrosshair)),F.showLabel!==d.current.showLabel&&Pe(F.showLabel),F.showGrid!==d.current.showGrid&&Le(F.showGrid),F.showCrosshair!==d.current.showCrosshair&&ut(F.showCrosshair),d.current=F},[F]),(0,T.useImperativeHandle)(X,function(){return{reload:Re,zoomReload:Lt,loadImg:Pt,clearShape:kt,toggleShape:Oe,getMarkData:fr,selectShape:at,delSelectShape:it,getSelectIds:gr,editLabel:De,adjustImg:ke,undoSvg:ae,canUndo:Je,redoSvg:ie,canRedo:Ne,changeScale:je,changeColor:re,drawShapeFromSize:ze,setCanvasSize:Ir,convertToPoints:Ae,convertToAttrs:Be}}),(0,Cr.jsxs)("div",{ref:Fe,className:"w-draw-container ".concat(d.current.className||""),onKeyDown:be,children:[(0,Cr.jsx)("div",{id:"svgcanvas",className:"w-svg-box",tabIndex:-1,onFocus:function(){return Yt(!0)},onBlur:function(){return Yt(!1)}}),F==null?void 0:F.children]})});pt.defaultProps={src:"",curLabel:"",showLabel:!1,showGrid:!1,showCrosshair:!1,minSize:[4,4],drawTool:"",scaleExtent:[.02,30],colorBindLabel:!0,rotateEnable:!1,changeSize:function(){},changeBindColor:function(){},changeSelect:function(){},changeScale:function(){},imgLoaded:function(){},endDraw:function(){}};var qt=pt,gt=function(X){var d=X.shapeList,N=X.selectShapeIds,g=X.delFunc,A=X.selectFunc,u=X.leftRender,O=X.rightRender,M=X.topRender,Y=X.title,L=X.className,B=(0,T.useRef)(null),S=(0,T.useState)([]),P=J()(S,2),Z=P[0],Q=P[1],U=(0,T.useRef)(-1),H=(0,T.useRef)(-1);(0,T.useEffect)(function(){Q(N)},[N]);var ir=function(){H.current=-1,U.current=-1;var I=d.length,m=N==null?void 0:N.length;if(!(!I||!m)){var q=tr()(N);q.sort(function(or,rr){return or-rr});for(var D=0;D<I;D++){var cr=d[D].id;cr===q[0]&&(U.current=D),cr===q[m-1]&&(H.current=D)}}},hr=function(I){I?(B.current.classList.add("box-active"),ir()):B.current.classList.remove("box-active")},E=function(I){A&&(I.length===1?A(I[0]):A(I))},wr=function(I){var m=I.keyCode||I.which||I.charCode;if(m===8||m===46){I==null||I.stopPropagation(),g&&g();return}if(I.ctrlKey&&m===65){I==null||I.stopPropagation();var q=d==null?void 0:d.map(function(rr){return rr==null?void 0:rr.id});Q(tr()(q)),E(q),H.current=d.length-1,U.current=0;return}var D=-1,cr=d.length-1;if(m===38&&(U.current>0||Z.length>1)?(D=U.current-1,D=D<0?0:D):m===40&&(H.current<cr||Z.length>1)&&(D=H.current+1,D=D>cr?cr:D),D!==-1){var or;I==null||I.stopPropagation(),Z=[(or=d[D])===null||or===void 0?void 0:or.id],Q(Z),E(Z),H.current=D,U.current=D}},Lr=function(I,m,q){q.stopPropagation();var D=tr()(Z),cr=D.indexOf(I);if(q.shiftKey){m<=U.current?U.current=m:H.current=m,U.current=U.current<0?0:U.current,D=[];for(var or=U.current;or<=H.current;or++){var rr;D.push((rr=d[or])===null||rr===void 0?void 0:rr.id)}}else if(q.ctrlKey)if(cr>=0){if(D.length===1)U.current=-1,H.current=-1;else if(m===U.current)for(var jr=U.current+1;jr<=H.current;jr++){var dr;if(D.includes((dr=d[jr])===null||dr===void 0?void 0:dr.id)){U.current=jr;break}}else if(m===H.current)for(var Er=H.current-1;Er>=U.current;Er--){var Nr;if(D.includes((Nr=d[Er])===null||Nr===void 0?void 0:Nr.id)){H.current=Er;break}}D.splice(cr,1)}else D.push(I),m<U.current&&(U.current=m),m>H.current&&(H.current=m);else D=[I],H.current=m,U.current=m;Q(D),E(D)},sr=function(){Z.length&&(Q([]),E([]),H.current=-1,U.current=-1)};return(0,Cr.jsxs)("div",{className:"win-box ".concat(L),children:[(0,Cr.jsxs)("div",{className:"w-head",children:[Y||"\u56FE\u5F62\u5217\u8868",(0,Cr.jsx)("div",{className:"flex-center",children:M&&M()})]}),(0,Cr.jsx)("div",{className:"w-box w-box-overflow",ref:B,tabIndex:-1,onFocus:function(){return hr(!0)},onBlur:function(){return hr(!1)},onClick:sr,onKeyDown:wr,children:d&&d.map(function(W,I){var m=W==null?void 0:W.id;return(0,Cr.jsxs)("div",{className:"list-item ".concat(Z.includes(m)?"on":""),onClick:function(D){return Lr(m,I,D)},children:[u&&u(W,I),(0,Cr.jsx)("p",{className:"list-txt",title:W==null?void 0:W.label,children:W==null?void 0:W.label}),O&&O(W,I)]},I)})})]})};gt.defaultProps={className:"",title:"",shapeList:[],selectShapeIds:[],leftRender:null,rightRender:null,topRender:null,delFunc:function(){},selectFunc:function(){}};var $t=gt}}]);
