"use strict";(self.webpackChunkw_react_label=self.webpackChunkw_react_label||[]).push([[720],{52720:function(Ie,st,er){er.r(st),er.d(st,{WColorBlock:function(){return jt},WDraw:function(){return qt},WShapeList:function(){return $t}});var Dt=er(5574),z=er.n(Dt),T=er(67294),Cr=er(85893),dt=function(K){var v=K.colorBlocks,N=(0,T.useState)(v[0]),y=z()(N,2),A=y[0],u=y[1];(0,T.useEffect)(function(){K.color&&u(K.color)},[]);var Y=function(O,L){u(O),K.onChange&&K.onChange(O,L)};return(0,Cr.jsx)("div",{className:"w-color-block-box",children:v.map(function(J,O){return(0,Cr.jsx)("div",{onClick:function(B){return Y(J,B)},className:"w-color-block ".concat(J===A?"on":""),style:{background:J}},O)})})};dt.defaultProps={color:"",colorBlocks:["#f00","#FFA500","#ff0","#0f0","#0ff","#00f","#800080","#fff"],onChange:function(){}};var jt=dt,At=er(9783),Wr=er.n(At),Bt=er(97857),br=er.n(Bt),Mt=er(13769),vt=er.n(Mt),Jt=er(52677),zt=er.n(Jt),Nt=er(61227),Ft=er.n(Nt),It=er(19632),tr=er.n(It),w=er(46886),M={color:["#CB3D45","#DA833C","#2378DE"],svg:{width:800,height:600},shapeCommon:{fill:"rgba(0, 0, 0, 0)",stroke:"#CB3D45","stroke-width":2,"vector-effect":"non-scaling-stroke"},rect:{x:0,y:0,width:0,height:0},selectBox:{"stroke-width":1,fill:"rgb(34 34 204 / 12%)",stroke:"rgb(34 34 204 / 45%)","vector-effect":"non-scaling-stroke"},ellipse:{cx:0,cy:0,rx:0,ry:0},path:{d:""},line:{d:"",fill:"none",stroke:"#00f","stroke-width":1},point:{cx:0,cy:0,r:4,fill:"rgba(0,0,255,.45)",stroke:"rgba(0, 0, 0, 0)","stroke-width":10},grip:{width:8,height:8,fill:"rgba(0,0,255,.45)",stroke:"rgba(0, 0, 0, 0)","stroke-width":10},font:{x:0,y:0,fill:"#CB3D45",stroke:"none","font-size":16,"text-anchor":"start","dominant-baseline":"text-after-edge"},pathAddPoint:{fill:"none",stroke:"rgba(0,0,0,0)","stroke-width":25},rotateLine:{x1:0,y1:0,x2:0,y2:0,stroke:"rgba(0,0,255,.45)","stroke-width":1},rotateCircle:{cx:0,cy:0,r:5,fill:"rgba(0,0,255,.45)",stroke:"rgba(0, 0, 0, 0)","stroke-width":6}},Tt=["128, 0, 0","0, 128, 0","128, 128, 0","0, 0, 128","128, 0, 128","0, 128, 128","128, 128, 128","64, 0, 0","192, 0, 0","64, 128, 0","192, 128, 0","64, 0, 128","192, 0, 128","64, 128, 128","192, 128, 128","0, 64, 0","128, 64, 0","0, 192, 0","128, 192, 0","0, 64, 128","128, 64, 128","0, 192, 128","128, 192, 128","64, 64, 0","192, 64, 0","64, 192, 0","192, 192, 0","64, 64, 128","192, 64, 128","64, 192, 128","192, 192, 128","0, 0, 64","128, 0, 64","0, 128, 64","128, 128, 64","0, 0, 192","128, 0, 192","0, 128, 192","128, 128, 192","64, 0, 64","192, 0, 64","64, 128, 64","192, 128, 64","64, 0, 192","192, 0, 192","64, 128, 192","192, 128, 192","0, 64, 64","128, 64, 64","0, 192, 64","128, 192, 64","0, 64, 192","128, 64, 192","0, 192, 192","128, 192, 192","64, 64, 64","192, 64, 64","64, 192, 64","192, 192, 64","64, 64, 192","192, 64, 192","64, 192, 192","192, 192, 192","32, 0, 0","160, 0, 0","32, 128, 0","160, 128, 0","32, 0, 128","160, 0, 128","32, 128, 128","160, 128, 128","96, 0, 0","224, 0, 0","96, 128, 0","224, 128, 0","96, 0, 128","224, 0, 128","96, 128, 128","224, 128, 128","32, 64, 0","160, 64, 0","32, 192, 0","160, 192, 0","32, 64, 128","160, 64, 128","32, 192, 128","160, 192, 128","96, 64, 0","224, 64, 0","96, 192, 0","224, 192, 0","96, 64, 128","224, 64, 128","96, 192, 128","224, 192, 128","32, 0, 64","160, 0, 64","32, 128, 64","160, 128, 64","32, 0, 192","160, 0, 192","32, 128, 192","160, 128, 192","96, 0, 64","224, 0, 64","96, 128, 64","224, 128, 64","96, 0, 192","224, 0, 192","96, 128, 192","224, 128, 192","32, 64, 64","160, 64, 64","32, 192, 64","160, 192, 64","32, 64, 192","160, 64, 192","32, 192, 192","160, 192, 192","96, 64, 64","224, 64, 64","96, 192, 64","224, 192, 64","96, 64, 192","224, 64, 192","96, 192, 192","224, 192, 192","0, 32, 0","128, 32, 0","0, 160, 0","128, 160, 0","0, 32, 128","128, 32, 128","0, 160, 128","128, 160, 128","64, 32, 0","192, 32, 0","64, 160, 0","192, 160, 0","64, 32, 128","192, 32, 128","64, 160, 128","192, 160, 128","0, 96, 0","128, 96, 0","0, 224, 0","128, 224, 0","0, 96, 128","128, 96, 128","0, 224, 128","128, 224, 128","64, 96, 0","192, 96, 0","64, 224, 0","192, 224, 0","64, 96, 128","192, 96, 128","64, 224, 128","192, 224, 128","0, 32, 64","128, 32, 64","0, 160, 64","128, 160, 64","0, 32, 192","128, 32, 192","0, 160, 192","128, 160, 192","64, 32, 64","192, 32, 64","64, 160, 64","192, 160, 64","64, 32, 192","192, 32, 192","64, 160, 192","192, 160, 192","0, 96, 64","128, 96, 64","0, 224, 64","128, 224, 64","0, 96, 192","128, 96, 192","0, 224, 192","128, 224, 192","64, 96, 64","192, 96, 64","64, 224, 64","192, 224, 64","64, 96, 192","192, 96, 192","64, 224, 192","192, 224, 192","32, 32, 0","160, 32, 0","32, 160, 0","160, 160, 0","32, 32, 128","160, 32, 128","32, 160, 128","160, 160, 128","96, 32, 0","224, 32, 0","96, 160, 0","224, 160, 0","96, 32, 128","224, 32, 128","96, 160, 128","224, 160, 128","32, 96, 0","160, 96, 0","32, 224, 0","160, 224, 0","32, 96, 128","160, 96, 128","32, 224, 128","160, 224, 128","96, 96, 0","224, 96, 0","96, 224, 0","224, 224, 0","96, 96, 128","224, 96, 128","96, 224, 128","224, 224, 128","32, 32, 64","160, 32, 64","32, 160, 64","160, 160, 64","32, 32, 192","160, 32, 192","32, 160, 192","160, 160, 192","96, 32, 64","224, 32, 64","96, 160, 64","224, 160, 64","96, 32, 192","224, 32, 192","96, 160, 192","224, 160, 192","32, 96, 64","160, 96, 64","32, 224, 64","160, 224, 64","32, 96, 192","160, 96, 192","32, 224, 192","160, 224, 192","96, 96, 64","224, 96, 64","96, 224, 64","224, 224, 64","96, 96, 192","224, 96, 192","96, 224, 192","224, 224, 192","0,0,0"],ft=function(K){var v=Object.keys(K).length;return"rgb("+Tt[v]+")"},ht=["n","ne","e","se","s","sw","w","nw"],Wt=function(K){return!!(K.touches&&K.touches.length)},Kt=function(K,v){for(var N=arguments.length,y=new Array(N>2?N-2:0),A=2;A<N;A++)y[A-2]=arguments[A];var u={},Y=y[0],J=y[1],O=y[2],L=y[3];if(K==="rect"){if(u=Xt.apply(void 0,y),v){var B=L.width,S=L.height,P=u.width-u.height,X=Y.indexOf("n")>=0&&O<=S||Y.indexOf("s")>=0&&O<=-S,Q=Y.indexOf("e")>=0&&J<=-B||Y.indexOf("w")>=0&&J<=B;P>0?(X&&(u.y=u.y-P),u.height=u.width):(Q&&(u.x=u.x+P),u.width=u.height)}}else if(K==="ellipse"){if(u=Gt.apply(void 0,y),v){var U=L.rx,Z=L.ry,nr=u.rx-u.ry,hr=Y.indexOf("n")>=0&&O<=Z*2||Y.indexOf("s")>=0&&O<=-Z*2,E=Y.indexOf("e")>=0&&J<=-U*2||Y.indexOf("w")>=0&&J<=U*2;nr>0?(hr&&(nr=-nr),u.ry=u.rx,u.cy=u.cy+nr):(E&&(nr=-nr),u.cx=u.cx-nr,u.rx=u.ry)}}else u=Zt.apply(void 0,[v].concat(y));return u},Xt=function(){for(var K=arguments.length,v=new Array(K),N=0;N<K;N++)v[N]=arguments[N];var y=v[0],A=v[1],u=v[2],Y=v[3],J=Y.x,O=Y.y,L=Y.width,B=Y.height,S=L,P=B;return y.indexOf("n")>=0?(P=B-u,P>0?O=O+u:O=O+B,P=Math.abs(P)):y.indexOf("s")>=0&&(P=B+u,P<0&&(O=O+B+u),P=Math.abs(P)),y.indexOf("w")>=0?(S=L-A,S<0?J=J+L:J=J+A,S=Math.abs(S)):y.indexOf("e")>=0&&(S=L+A,S<0&&(J=J+L+A),S=Math.abs(S)),{x:J,y:O,width:S,height:P}},Gt=function(){for(var K=arguments.length,v=new Array(K),N=0;N<K;N++)v[N]=arguments[N];var y=v[0],A=v[1],u=v[2],Y=v[3],J=Y.cx,O=Y.cy,L=Y.rx,B=Y.ry;return A=A/2,u=u/2,y.indexOf("n")>=0?(B=B-u,O=O+u,B=Math.abs(B)):y.indexOf("s")>=0&&(B=B+u,O=O+u,B=Math.abs(B)),y.indexOf("w")>=0?(L=L-A,J=J+A,L=Math.abs(L)):y.indexOf("e")>=0&&(L=L+A,J=J+A,L=Math.abs(L)),{cx:J,cy:O,rx:L,ry:B}},Zt=function(K){for(var v=arguments.length,N=new Array(v>1?v-1:0),y=1;y<v;y++)N[y-1]=arguments[y];var A=N[0],u=N[1],Y=N[2],J=N[3],O=J.points,L=J.boundRect,B=(O==null?void 0:O.length)||0,S=[],P=L.x,X=L.y,Q=L.width,U=L.height,Z=Q/U,nr=A.indexOf("n")>=0,hr=A.indexOf("s")>=0,E=A.indexOf("w")>=0,wr=A.indexOf("e")>=0,Lr="";K&&(A.length===1?(nr||hr?(u=Y*Z,Lr="v"):(Y=u/Z,Lr="h"),nr?u=-u:E&&(Y=-Y)):(Y=u/Z,(E&&hr||wr&&nr)&&(Y=-Y)));for(var sr=0;sr<B;sr++){var W=tr()(O[sr]),I=Math.abs(W[0]-P)/Q,b=Math.abs(W[1]-X)/U;nr&&(W[1]+=Y*(1-b)),(hr||Lr==="h")&&(W[1]+=Y*b),E&&(W[0]+=u*(1-I)),(wr||Lr==="v")&&(W[0]+=u*I),S.push(W)}return{points:S}},Ht=function(K,v,N){var y=z()(K,2),A=y[0],u=y[1],Y=z()(v,2),J=Y[0],O=Y[1],L=z()(N,2),B=L[0],S=L[1],P=B-J,X=S-O,Q=((A-J)*P+(u-O)*X)/(P*P+X*X);return Q<0?(P=A-J,X=u-O):Q>1?(P=A-B,X=u-S):(P=A-(J+Q*P),X=u-(O+Q*X)),Math.sqrt(P*P+X*X)},Kr=function(K,v,N,y,A,u){var Y=A*Math.PI/180;u&&(Y=-Y);var J=Math.cos(Y),O=Math.sin(Y),L=K-N,B=v-y,S=L*J-B*O+N,P=L*O+B*J+y;return[S,P]},Ut=function(K,v,N,y,A,u,Y,J){var O=K+N/2,L=v+y/2,B=Kr(O,L,A,u,Y,J),S=z()(B,2),P=S[0],X=S[1],Q=P-O,U=X-L;return{changeX:Q,changeY:U}},Qt=["attrs","shape_type"],Vt=["points","shape_type"],pt=(0,T.forwardRef)(function(F,K){var v=(0,T.useRef)(F),N=(0,T.useRef)(null),y=(0,T.useRef)(null),A=(0,T.useRef)(null),u=(0,T.useRef)(null),Y=(0,T.useRef)(null),J=(0,T.useRef)(null),O=(0,T.useRef)(""),L=(0,T.useRef)(null),B=(0,T.useRef)(null),S=(0,T.useRef)(null),P=(0,T.useRef)({x:0,y:0,w:0,h:0,mx:0,my:0}),X=(0,T.useRef)(!1),Q=(0,T.useRef)(!1),U=(0,T.useRef)(!1),Z=(0,T.useRef)([]),nr=(0,T.useRef)("1"),hr=(0,T.useRef)({x:0,y:0,scale:1,w:0,h:0}),E=(0,T.useRef)(null),wr=(0,T.useRef)(null),Lr=(0,T.useRef)(""),sr=(0,T.useRef)(!1),W=(0,T.useRef)(!1),I=(0,T.useRef)(!1),b=(0,T.useRef)({}),q=(0,T.useRef)(null),D=(0,T.useRef)({}),ar=(0,T.useRef)([]),ir=(0,T.useRef)([]),_=function(){var r;(r=w.td_("#shape-grip-group,#path-point-group *,#shape-path-group *,#path-add-point"))===null||r===void 0||r.attr("display","none"),J.current="",Y.current&&(w.Ys("#"+Y.current).attr("fill",M.shapeCommon.fill),Y.current=""),O.current&&(w.Ys("#"+O.current).attr("fill",M.grip.fill),O.current=""),L.current&&(w.Ys("#path-point-"+L.current).attr("fill",M.point.fill),L.current="")},jr=function(){if(document.getElementById("svgcanvas")!==document.activeElement){var r;(r=document.getElementById("svgcanvas"))===null||r===void 0||r.focus()}},dr=function(r){var t=(r==null?void 0:r.sourceEvent)||r,e=[];if(Wt(t)?e=w.cx$(t.touches[0]||t.changedTouches[0],y.current.node()):e=w.cx$(t,y.current.node()),S.current){var n=S.current,a=n.x,o=n.y,c=n.k;e[0]=(e[0]-a)/c,e[1]=(e[1]-o)/c}return e},Er=function(){for(var r=Z.current.length||0,t=0,e=0;e<r;e++)if(+Z.current[e]!==e+1){t=e+1;break}return t===0&&(t=r+1),t=""+t,Z.current.splice(t-1,0,t),t},Nr=function(r){return r==="ellipse"?{x:"cx",y:"cy",w:"rx",h:"ry"}:{x:"x",y:"y",w:"width",h:"height"}},_t=function(){var r=v.current.drawTool,t=F.minSize,e=0,n=0;return r==="rect"?(e=u.current.attr("width"),n=u.current.attr("height")):r==="ellipse"&&(e=u.current.attr("rx")*2||0,n=u.current.attr("ry")*2||0),+e<=t[0]||+n<=t[1]?(u.current.remove(),u.current=null,w.Ys("#shape-grip-group").attr("display","none"),!0):!1},$r=function(r){var t,e,n=w.Ys("#shape-".concat(r));if(!n)return{};var a=n==null||(t=n.node())===null||t===void 0?void 0:t.getBBox(),o=(S==null||(e=S.current)===null||e===void 0?void 0:e.k)||1,c=a.x,i=a.y,l=a.width,s=a.height,f=c+l/2,h=i+s/2,p=f*o,d=h*o;return{centerX:f,centerY:h,gripCenterX:p,gripCenterY:d}},_r=function(){var r,t,e,n;if(u.current){var a=(r=u.current.attr("id"))===null||r===void 0?void 0:r.substring(6),o=(t=b.current[a])===null||t===void 0?void 0:t.rotate;if(o){var c=z()(o,3),i=c[0],l=c[1],s=c[2],f=(e=u.current)===null||e===void 0||(n=e.node())===null||n===void 0?void 0:n.getBBox(),h=f.x,p=f.y,d=f.width,m=f.height,x=Ut(h,p,d,m,l,s,i),R=x.changeX,C=x.changeY;return ct([R,C]),[R,C]}}},Ar=function(){var r,t,e,n,a;if(!u.current||Q.current||J.current)return!1;var o=(r=u.current.attr("id"))===null||r===void 0?void 0:r.substring(6),c=(t=b.current)===null||t===void 0?void 0:t[o],i=c.hide,l=c.rotate,s=w.Ys("#shape-grip-group");if(s.attr("display",i?"none":"inline"),!i){var f=(S==null||(e=S.current)===null||e===void 0?void 0:e.k)||1,h=(n=u.current)===null||n===void 0||(a=n.node())===null||a===void 0?void 0:a.getBBox(),p=h.x,d=h.y,m=h.width,x=h.height,R=M.grip.width/2,C=M.grip.height/2;if(p=p*f||0,d=d*f||0,m=m*f||0,x=x*f||0,v.current.rotateEnable){var j=p+m/2;s.select("#rotate-line").attr("x1",j).attr("y1",d-4).attr("x2",j).attr("y2",d-16),s.select("#rotate-circle").attr("cx",j).attr("cy",d-20)}if(l){var k=z()(l,3),H=k[0],G=k[1],V=k[2],rr=G*f,$=V*f;s.attr("transform","rotate(".concat(H," ").concat(rr,",").concat($,")")),u.current.attr("transform","rotate(".concat(H," ").concat(G,",").concat(V,")"))}else s.attr("transform",null);var cr=[[p,d],[p+m,d],[p+m,d+x],[p,d+x]],or=B.current(cr);w.Ys("#resize-path").attr("d",or+"Z"),s.select("#resize-grip-nw").attr("x",p-R).attr("y",d-C),s.select("#resize-grip-n").attr("x",p+m/2-R).attr("y",d-C),s.select("#resize-grip-ne").attr("x",p+m-R).attr("y",d-C),s.select("#resize-grip-w").attr("x",p-R).attr("y",d+x/2-C),s.select("#resize-grip-e").attr("x",p+m-R).attr("y",d+x/2-C),s.select("#resize-grip-sw").attr("x",p-R).attr("y",d+x-C),s.select("#resize-grip-s").attr("x",p+m/2-R).attr("y",d+x-C),s.select("#resize-grip-se").attr("x",p+m-R).attr("y",d+x-C)}},yt=function(r){var t,e;if(!q.current){for(var n=(t=b.current)===null||t===void 0?void 0:t[r],a=n.attrs.points,o=n.shape_type,c=a.length,i=(S==null||(e=S.current)===null||e===void 0?void 0:e.k)||1,l=[],s=0;s<c;s++){var f=z()(a[s],2),h=f[0],p=f[1];h=h*i,p=p*i,l[s]=[h,p]}var d=B.current(l);o==="polygon"&&(d+="Z"),y.current.select("#path-add-point").attr("d",d)}},rt=function(r){var t,e=q.current||[],n=e.length;if(!(!Q.current||!n)){var a=(S==null||(t=S.current)===null||t===void 0?void 0:t.k)||1,o=z()(e[n-1],2),c=o[0],i=o[1],l=dr(r),s=z()(l,2),f=s[0],h=s[1];c=c*a,i=i*a,f=f*a,h=h*a;var p=[[c,i],[f,h]],d=B.current(p);w.Ys("#path-stretch-line").attr("d",d)}},Dr=function(r){var t,e,n,a,o,c;if(!u.current||!u.current.attr("id"))return!1;var i=(t=u.current.attr("id"))===null||t===void 0?void 0:t.substring(6),l=((e=b.current)===null||e===void 0||(n=e[i])===null||n===void 0||(a=n.attrs)===null||a===void 0?void 0:a.points)||q.current||[],s=l.length,f=(S==null||(o=S.current)===null||o===void 0?void 0:o.k)||1;if(s){yt(i);for(var h=0;h<s;h++){var p=w.Ys("#path-point-group #path-point-".concat(h+1)),d=z()(l[h],2),m=d[0],x=d[1];m=m*f,x=x*f,p.attr("cx",m).attr("cy",x).attr("display","inline")}if(r&&rt(r),!Q.current){var R=(c=b.current)===null||c===void 0?void 0:c[i],C=R.rotate;if(C){var j=z()(C,3),k=j[0],H=j[1],G=j[2],V=H*f,rr=G*f,$="rotate(".concat(k," ").concat(V,",").concat(rr,")");w.Ys("#path-point-group").attr("transform",$),w.Ys("#path-add-point").attr("transform",$),u.current.attr("transform","rotate(".concat(k," ").concat(H,",").concat(G,")"))}else w.Ys("#path-point-group").attr("transform",null),w.Ys("#path-add-point").attr("transform",null)}}},Xr=function(r){var t=r?F.showGrid:v.current.showGrid;if(t)if(S.current=S.current||w.CRH,S.current.k<1)y.current.select("#grid").attr("display","none");else{var e=hr.current,n=e.x,a=e.y,o=e.w,c=e.h,i=S.current.k,l=10*i,s=n*i,f=a*i;y.current.select("#gridPattern").attr("width",l).attr("height",l).attr("x",s).attr("y",f),y.current.select("#grid").attr("display","inline").attr("x",s).attr("y",f).attr("width",o*i).attr("height",c*i)}},Gr=function(r){var t=v.current,e=t.curLabel,n=t.colorBindLabel,a=r||e;if(n){var o=D.current[a]||ft(D.current);M.shapeCommon.stroke=o,M.font.fill=o,r&&(D.current[a]=o)}},Zr=function(r){var t=r||M.shapeCommon.stroke;return w.$_Y(t).copy({opacity:.2})},Hr=function(r,t){var e=w.Ys("#shape-".concat(r));e.attr("stroke",t),v.current.showLabel&&y.current.select("#shape-label-".concat(r)).attr("fill",t),Y.current==="shape-"+r&&e.attr("fill",Zr(t))},re=function(r){var t,e=v.current,n=e.colorBindLabel,a=e.curLabel;if(n){var o,c,i;if(E.current||!u.current)return;var l=(o=u.current.attr("id"))===null||o===void 0?void 0:o.substring(6),s=(c=b.current)===null||c===void 0?void 0:c[l],f=s.label,h=D.current[a];(i=Object.keys(b.current))===null||i===void 0||i.forEach(function(m){var x=b.current[m].label;x===f&&Hr(m,r)}),h&&(M.shapeCommon.stroke=h,M.font.fill=h),D.current[f]=r,v.current.changeBindColor(D.current);return}if(M.shapeCommon.stroke=r,M.font.fill=r,E.current){var p;(p=E.current)===null||p===void 0||p.forEach(function(m){Hr(m,r)});return}if(u.current){var d=(t=u.current.attr("id"))===null||t===void 0?void 0:t.substring(6);Hr(d,r)}},Br=function(r,t,e){var n;if(t){var a=(S==null||(n=S.current)===null||n===void 0?void 0:n.k)||1,o=b.current[r],c=o.shape_type,i=o.attrs,l=y.current.select("#shape-label-".concat(r)),s=0,f=0;if(c==="ellipse"){var h=i.cx,p=i.cy,d=i.ry;s=h,f=p-d}else if(c==="rect")s=i.x,f=i.y;else{var m=i.points,x=z()(m[0],2);s=x[0],f=x[1];for(var R=1;R<m.length;R++){var C=z()(m[R],2),j=C[0],k=C[1];f>k?(f=k,s=j):f===k&&s>j&&(s=j)}}s=s*a||0,f=f*a||0,l.attr("x",s).attr("y",f),e&&l.attr("fill",M.font.fill)}},tt=function(r){var t=r?F.showLabel:v.current.showLabel;if(t){var e=Object.keys(b.current);e==null||e.forEach(function(n){Br(n,t)})}},pr=function(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++)t[e]=arguments[e];ar.current.push(t),ir.current=[]},Ur=function(){var r=[],t={};if(E.current){var e,n={};(e=E.current)===null||e===void 0||e.forEach(function(i){var l=w.Ys("#shape-".concat(i));t[i]=JSON.parse(JSON.stringify(b.current[i])),n[i]=l}),r=[E.current,t,n]}else if(u.current){var a,o,c=(a=u.current)===null||a===void 0||(o=a.attr("id"))===null||o===void 0?void 0:o.substring(6);t[c]=JSON.parse(JSON.stringify(b.current[c])),r=[u.current,t]}return r},et=function(r){var t,e,n,a=(t=u.current)===null||t===void 0||(e=t.attr("id"))===null||e===void 0?void 0:e.substring(6),o=(n=b.current)===null||n===void 0?void 0:n[a],c=o.attrs,i=o.shape_type,l=o.rotate;if(P.current=c,i==="polygon"||i==="line"){var s,f;P.current.boundRect=(s=u.current)===null||s===void 0||(f=s.node())===null||f===void 0?void 0:f.getBBox(),P.current.close=i==="polygon"}var h=dr(r);if(l){var p=z()(l,3),d=p[0],m=p[1],x=p[2];h=Kr.apply(void 0,tr()(h).concat([m,x,d,!0]))}var R=h,C=z()(R,2);P.current.mx=C[0],P.current.my=C[1]},fr=function(){var r=Object.keys(b.current),t=[],e=hr.current,n=e.x,a=e.y,o=e.scale;return r==null||r.forEach(function(c){var i=b.current[c],l=i.attrs,s=i.label,f=i.shape_type,h=i.hide,p=i.rotate,d={};if(d.label=s||c,d.shape_type=f,d.attrs={},d.hide=h||!1,d.id=c,p&&(d.rotate=p[0]),f==="rect")d.attrs.x=(l.x-n)*o,d.attrs.y=(l.y-a)*o,d.attrs.width=l.width*o,d.attrs.height=l.height*o;else if(f==="ellipse")d.attrs.cx=(l.cx-n)*o,d.attrs.cy=(l.cy-a)*o,d.attrs.rx=l.rx*o,d.attrs.ry=l.ry*o;else{var m;d.attrs.points=[],(m=l.points)===null||m===void 0||m.forEach(function(x,R){d.attrs.points[R]=[(x[0]-n)*o,(x[1]-a)*o]})}t.push(d)}),t},te=function(r){var t=(r==null?void 0:r.target)||(r==null?void 0:r.srcElement),e=w.Ys(t).attr("id"),n=null,a=v.current.drawTool;O.current||L.current?n="crosshair":sr.current&&!W.current&&!I.current||a==="drag"?n="grab":e==="path-add-point"?n="pointer":u.current&&!Q.current&&Y.current===e||E.current&&E.current.includes(e==null?void 0:e.substring(6))?n="move":(!a||a==="move")&&(n="default"),w.Ys(N.current).style("cursor",n)},ee=function(r){v.current.showCrosshair&&(y.current.select("#crosshair-v-line").attr("x",r.layerX),y.current.select("#crosshair-h-line").attr("y",r.layerY))},nt=function(r){var t=w.Ys("#shape-path-group #shape-path-".concat(r));if(t.node())t.attr("display","inline").attr("transform",null);else{t=w.Ys("#shape-path-group").append("path").attr("id","shape-path-".concat(r)).style("pointer-events","none");var e=M.line;Object.keys(e).forEach(function(n){t.attr(n,e[n])})}return t},Fr=function(){var r,t,e=(S==null||(r=S.current)===null||r===void 0?void 0:r.k)||1;(t=E.current)===null||t===void 0||t.forEach(function(n,a){var o,c=w.Ys("#shape-".concat(n)),i=c.node().getBBox(),l=i.x,s=i.y,f=i.width,h=i.height,p=nt(a);l=l*e||0,s=s*e||0,f=f*e||0,h=h*e||0;var d=[[l-2,s-2],[l+f+2,s-2],[l+f+2,s+h+2],[l-2,s+h+2]],m=B.current(d);p.attr("d",m+"Z");var x=(o=b.current)===null||o===void 0?void 0:o[n],R=x.rotate;if(R){var C=z()(R,3),j=C[0],k=C[1],H=C[2],G=k*e,V=H*e;c.attr("transform","rotate(".concat(j," ").concat(k,",").concat(H,")")),p.attr("transform","rotate(".concat(j," ").concat(G,",").concat(V,")"))}})},gr=function(){var r,t,e;return(r=E.current)!==null&&r!==void 0&&r.length?E.current:u.current?[(t=u.current)===null||t===void 0||(e=t.attr("id"))===null||e===void 0?void 0:e.substring(6)]:[]},at=function(r,t){var e,n,a,o=t,c=r,i="",l="";if(c instanceof Array)E.current=c,o=!0;else if(typeof c=="string")i="shape-"+c,c=y.current.select("#".concat(i));else{var s,f;i=(s=c)===null||s===void 0?void 0:s.attr("id"),l=(f=u.current)===null||f===void 0?void 0:f.attr("id")}if(o&&(l&&i!==l||E.current)){var h,p;if(u.current=null,i=(h=i)===null||h===void 0?void 0:h.substring(6),E.current)if(i){var m=E.current.indexOf(i);if(m>=0){var x;E.current.splice(m,1),(x=E.current)!==null&&x!==void 0&&x.length||(E.current=null)}else E.current.push(i);v.current.changeSelect(gr())}else v.current.changeSelect(gr());else{var d;l=(d=l)===null||d===void 0?void 0:d.substring(6),E.current=[i,l],v.current.changeSelect(gr())}(p=E.current)===null||p===void 0||p.forEach(function(V,rr){nt(rr)}),_(),Fr();return}u.current=c,(e=w.td_("#shape-path-group *"))===null||e===void 0||e.attr("display","none"),E.current=null;var R=(n=b.current)===null||n===void 0?void 0:n[(a=i)===null||a===void 0?void 0:a.substring(6)],C=R.shape_type,j=R.hide;if(Y.current&&w.Ys("#"+Y.current).attr("fill",M.shapeCommon.fill),Y.current===i)Y.current="",(C==="line"||C==="polygon")&&(J.current="",y.current.selectAll("#path-point-group circle,#path-add-point").attr("display","none"),Ar());else if(Y.current!==i)if(Y.current=i,c.attr("fill",Zr(c.attr("stroke"))),C==="line"||C==="polygon"){var k;if(J.current=i,(k=y.current.selectAll("#path-point-group circle,#shape-grip-group"))===null||k===void 0||k.attr("display","none"),j){var H;(H=y.current.select("#path-add-point"))===null||H===void 0||H.attr("display","none")}else{var G;(G=y.current.select("#path-add-point"))===null||G===void 0||G.attr("display","inline"),Dr()}}else J.current="",y.current.selectAll("#path-point-group circle,#path-add-point").attr("display","none"),Ar();v.current.changeSelect(gr())},Jr=function(r){var t,e,n,a=r||u.current;if(a){_();var o=(t=a.attr("id"))===null||t===void 0?void 0:t.substring(6),c=Z.current.indexOf(o);Z.current.splice(c,1),a==null||a.remove(),(e=y.current.select("#shape-label-".concat(o)))===null||e===void 0||e.attr("display","none"),u.current=null,q.current=null,(n=b.current)===null||n===void 0||delete n[o]}},it=function(){var r,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,e={};if(E.current){var n,a={};return(n=E.current)===null||n===void 0||n.forEach(function(c){var i=w.Ys("#shape-".concat(c));e[c]=JSON.parse(JSON.stringify(b.current[c])),a[c]=i,Jr(i)}),t&&pr("del",E.current,e,a),E.current=null,v.current.changeSize(fr()),v.current.changeSelect(gr()),[e,a]}if(u.current){var o=(r=u.current.attr("id"))===null||r===void 0?void 0:r.substring(6);return e[o]=JSON.parse(JSON.stringify(b.current[o])),t&&pr("del",u.current,e),Jr(),v.current.changeSize(fr()),v.current.changeSelect(gr()),[e]}},ne=function(){var r,t;if(!(!L.current||!u.current)){var e=(r=u.current.attr("id"))===null||r===void 0?void 0:r.substring(6),n=((t=b.current)===null||t===void 0?void 0:t[e])||{},a=n.attrs.points,o=n.shape_type,c=a.length,i={};if(i[e]=JSON.parse(JSON.stringify(b.current[e])),c<=2){pr("del",u.current,i),Jr(),_();return}pr("edit",u.current,i),w.Ys("#path-point-group #path-point-".concat(c)).attr("display","none"),w.Ys("#path-point-group #path-point-".concat(L.current)).attr("fill",M.point.fill),a.splice(L.current-1,1),L.current=null;var l=B.current(a);o==="polygon"&&(l+="Z"),u.current.attr("d",l),Br(e,v.current.showLabel),Dr()}},St=function(r,t){var e=t.shape_type,n=t.attrs,a=t.rotate;if(e==="rect"||e==="ellipse"){var o=Object.keys(n);o==null||o.forEach(function(l){r.attr(l,n[l])})}else{var c=n.points,i=B.current(c);e==="polygon"&&(i+="Z"),r.attr("d",i)}a?r.attr("transform","rotate(".concat(a[0]," ").concat(a[1],",").concat(a[2],")")):r.attr("transform",null)},mt=function(r){var t=r||[],e=Ft()(t),n=e[0],a=e.slice(1),o=z()(a,3),c=o[0],i=o[1],l=o[2],s=[];if(n==="add")c instanceof Array?E.current=c:(E.current=null,u.current=c),s=it(!1);else if(n==="del"){if(c instanceof Array)c==null||c.forEach(function(C){var j;Z.current.splice(C-1,0,+C),(j=y.current.select("#shape-label-".concat(C)))===null||j===void 0||j.attr("display","inline"),y.current.select("#shape").insert(function(){return l[C].node()})});else{var f,h,p=(f=Object.keys(i))===null||f===void 0?void 0:f[0];Z.current.splice(p-1,0,p),(h=y.current.select("#shape-label-".concat(p)))===null||h===void 0||h.attr("display","inline"),y.current.select("#shape").insert(function(){return c.node()})}b.current=Object.assign({},b.current,i)}else if(n==="edit"){var d={};if(c instanceof Array)c==null||c.forEach(function(C){d[C]=JSON.parse(JSON.stringify(b.current[C])),St(l[C],i[C])}),s=[d,l];else{var m,x,R=(m=c.attr("id"))===null||m===void 0?void 0:m.substring(6);d[R]=JSON.parse(JSON.stringify(b.current[R])),St(c,(x=Object.values(i))===null||x===void 0?void 0:x[0]),s=[d]}b.current=Object.assign({},b.current,i)}return E.current=null,u.current=null,v.current.changeSize(fr()),v.current.changeSelect([]),_(),tt(),n==="del"?[c]:[c].concat(tr()(s))},ae=function(){if(ar.current.length){var r=ar.current.pop(),t=r||[],e=z()(t,1),n=e[0],a=mt(r);if(n==="add"){ir.current.push(["del"].concat(tr()(a)));return}else n==="del"?ir.current.push(["add"].concat(tr()(a))):n==="edit"&&ir.current.push([n].concat(tr()(a)))}},ie=function(){if(ir.current.length){var r=ir.current.pop(),t=r||[],e=z()(t,1),n=e[0],a=mt(r);if(n==="add")ar.current.push(["del"].concat(tr()(a)));else if(n==="del"){ar.current.push(["add"].concat(tr()(a)));return}else n==="edit"&&ar.current.push([n].concat(tr()(a)))}},bt=function(r,t){var e,n=t||u.current;if(n){var a=v.current.showLabel,o=z()(r,2),c=o[0],i=o[1],l=n==null||(e=n.attr("id"))===null||e===void 0?void 0:e.substring(6),s=b.current[l],f=s.attrs,h=s.shape_type,p=s.rotate,d={};if(h==="rect"){var m=f.x,x=f.y,R=f.width,C=f.height;m+=c,x+=i,n.attr("x",m).attr("y",x),d={x:m,y:x,width:R,height:C}}else if(h==="ellipse"){var j=f.cx,k=f.cy,H=f.rx,G=f.ry;j+=c,k+=i,n.attr("cx",j).attr("cy",k),d={cx:j,cy:k,rx:H,ry:G}}else{for(var V=f.points,rr=h==="polygon",$=(V==null?void 0:V.length)||0,cr=[],or=0;or<$;or++){var vr=z()(V[or],2),xr=vr[0],yr=vr[1];xr+=c,yr+=i,cr[or]=[xr,yr]}var kr=B.current(cr);n.attr("d",kr+(rr?"Z":"")),d={points:cr},cr=null}if(p){var lr,ur=n==null||(lr=n.node())===null||lr===void 0?void 0:lr.getBBox(),Yr=ur.x,Or=ur.y,Sr=ur.width,Mr=ur.height,Pr=Yr+Sr/2,zr=Or+Mr/2;b.current[l].rotate[1]=Pr,b.current[l].rotate[2]=zr}b.current[l].attrs=d,E.current?Fr():h==="rect"||h==="ellipse"?Ar():Dr(),Br(l,a)}},ct=function(r){if(E.current){var t;(t=E.current)===null||t===void 0||t.forEach(function(e){var n=w.Ys("#shape-".concat(e));bt(r,n)});return}bt(r)},Qr=function(r,t,e){var n=y.current.select("#shape-label-".concat(r)),a=v.current.showLabel;if(n.node()){n.text(t).attr("display","inline"),Br(r,a,!0);return}var o=y.current.select("#shape-label-group").append("text").attr("id","shape-label-".concat(r)).style("user-select","none").text(t),c=Object.assign({},M.font);e&&(c["text-anchor"]="middle"),Object.keys(c).forEach(function(i){o.attr(i,c[i])}),Br(r,a)},ce=function(r){var t,e;if(u.current){var n=(t=u.current)===null||t===void 0||(e=t.attr("id"))===null||e===void 0?void 0:e.substring(6),a=$r(n),o=a.centerX,c=a.centerY,i=a.gripCenterX,l=a.gripCenterY,s=r[0]-o,f=c-r[1],h=Math.atan2(f,s)*180/Math.PI;h<-90?h=-270-h:h=90-h,u.current.attr("transform","rotate(".concat(h," ").concat(o,",").concat(c,")")),w.Ys("#shape-grip-group").attr("transform","rotate(".concat(h," ").concat(i,",").concat(l,")")),b.current[n].rotate=[h,o,c]}},mr=function(r){for(var t=arguments.length,e=new Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];var a=e[0],o=e[1],c=dr(a),i=c[0]-P.current.mx,l=c[1]-P.current.my;if(r==="moveGrip"){var s,f,h,p="",d=(s=u.current)===null||s===void 0||(f=s.attr("id"))===null||f===void 0?void 0:f.substring(6),m=(h=b.current)===null||h===void 0?void 0:h[d],x=m.shape_type,R=m.rotate;if(R){var C=z()(R,3),j=C[0],k=C[1],H=C[2];c=Kr.apply(void 0,tr()(c).concat([k,H,j,!0])),i=c[0]-P.current.mx,l=c[1]-P.current.my}O.current?p=O.current.substring(12):p=o.attr("id").substring(12);var G=Kt(x,W.current,p,i,l,P.current);if(x==="polygon"||x==="line"){var V=B.current(G.points);u.current.attr("d",V+(P.current.close?"Z":""))}else Object.keys(G).forEach(function(Pr){u.current.attr(Pr,G[Pr])});b.current[d].attrs=G,Ar(),Br(d,v.current.showLabel),O.current&&R&&(_r(),w.Ys("#"+O.current).attr("fill",M.grip.fill),O.current=null);return}if(r==="moveShape"){ct([a.dx,a.dy]);return}if(r==="moveWhole"){var rr,$;S.current=S.current.translate(i,l),w.sPX().transform(y.current,S.current),y.current.selectAll("g.layer").attr("transform",S.current),y.current.selectAll("g#shape-related-group").attr("transform","translate(".concat((rr=S.current)===null||rr===void 0?void 0:rr.x,",").concat(($=S.current)===null||$===void 0?void 0:$.y,")")),Xr();return}if(r==="movePoint"){var cr,or,vr,xr="",yr=(cr=u.current)===null||cr===void 0||(or=cr.attr("id"))===null||or===void 0?void 0:or.substring(6),kr=b.current[yr],lr=kr.attrs.points,ur=kr.shape_type,Yr=(S==null||(vr=S.current)===null||vr===void 0?void 0:vr.k)||1,Or=ur==="polygon";L.current?xr=L.current:xr=o.attr("id").substring(11);var Sr=lr[xr-1];Sr[0]=Sr[0]+a.dx/Yr,Sr[1]=Sr[1]+a.dy/Yr,lr[xr-1]=Sr,b.current[yr].attrs={points:lr};var Mr=B.current(lr);u.current.attr("d",Mr+(Or?"Z":"")),Dr(),Br(yr,v.current.showLabel);return}if(r==="moveRotate"){ce(c);return}},oe=function(r){var t=(r==null?void 0:r.target)||(r==null?void 0:r.srcElement),e=w.Ys(t).attr("id"),n=q.current||[],a=n.length;if(w.td_("#path-point-group circle").attr("r",M.point.r),r.type==="touchstart"||r.type==="mouseenter"){if(Q.current&&(e!=="path-point-1"||a<3))return;w.Ys("#".concat(e)).attr("r",6),w.Ys(t).style("cursor","pointer")}else w.Ys(t).style("cursor",null)},ot=function(r,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=w.Ys("#path-point-group"),a=n.selectAll("circle"),o=a.size(),c=M.point;if(!o||o<=t){var i=n.append("circle").attr("id",r).call(Rr("point",mr));return i.on("touchstart touchend mouseenter mouseleave",oe),Object.keys(c).forEach(function(l){i.attr(l,c[l])}),i.attr("display",e?"inline":"none"),i}return w.Ys("#"+r).attr("display",e?"inline":"none")},le=function(r){var t,e=dr(r),n=Y.current.substring(6),a=(t=b.current)===null||t===void 0?void 0:t[n],o=a.attrs.points,c=a.shape_type,i=a.rotate,l=o.length,s=-1,f=1/0,h={};if(h[n]=JSON.parse(JSON.stringify(b.current[n])),pr("edit",u.current,h),i){var p=z()(i,3),d=p[0],m=p[1],x=p[2];e=Kr.apply(void 0,tr()(e).concat([m,x,d,!0]))}for(var R=0;R<l;R++){var C=(R+1)%l,j=o[R],k=o[C],H=Ht(e,j,k);H<f&&(s=C,f=H)}o.splice(s,0,e);var G=B.current(o);c==="polygon"&&(G+="Z"),u.current.attr("d",G),_r();var V="path-point-".concat(l+1);ot(V,l),Dr()},wt=function(r){var t,e;(t=w.Ys("#path-stretch-line"))===null||t===void 0||t.attr("display","none");var n=u.current.attr("d");r&&u.current.attr("d",n+"Z");var a=(e=u.current.attr("id"))===null||e===void 0?void 0:e.substring("6"),o=v.current,c=o.curLabel,i=o.colorBindLabel;i&&c&&!D.current[c]&&(D.current[c]=M.shapeCommon.stroke,v.current.changeBindColor(D.current)),c=c||a,b.current[a]={shape_type:r?"polygon":"line",label:c,attrs:{points:q.current}},q.current=null,J.current="shape-".concat(a),Y.current=J.current,w.Ys("#"+Y.current).attr("fill",Zr(u.current.attr("stroke"))),v.current.changeSize(fr()),v.current.changeSelect(gr()),Qr(a,c,!0),y.current.select("#path-add-point").attr("display","inline"),yt(a),pr("add",u.current),v.current.endDraw({id:a,label:c})},ue=function(r,t,e,n){var a,o=(r==null?void 0:r.sourceEvent)||r,c=q.current||[],i=c==null?void 0:c.length;if(o.button===2){if(!i)return;i<2?Jr():wt();return}if(e==="point"&&n.attr("id")==="path-point-1"&&i>=3){wt(!0);return}var l=w.Ys("#path-point-group").attr("transform",null),s=l.selectAll("circle"),f=s.size(),h=dr(r),p=z()(h,2),d=p[0],m=p[1],x=M.line;if(i){q.current.push([d,m]);var k=B.current(q.current);u.current.attr("d",k)}else{var R;Q.current=!0,_(),(R=w.Ys("#path-stretch-line"))===null||R===void 0||R.attr("display","inline"),Gr();var C=Object.assign({},M.shapeCommon,M[t]);u.current=A.current.select("#shape").append(t).call(Rr("shape",mr));var j=Er();u.current.attr("id","shape-".concat(j)),Object.keys(C).forEach(function($){u.current.attr($,C[$])}),q.current=[[d,m]]}f||(l.append("path").attr("id","path-stretch-line").style("pointer-events","none"),Object.keys(x).forEach(function($){w.Ys("#path-stretch-line").attr($,x[$])}));var H="path-point-".concat(i+1);ot(H,i);var G=(S==null||(a=S.current)===null||a===void 0?void 0:a.k)||1,V=d*G,rr=m*G;w.Ys("#"+H).attr("cx",V).attr("cy",rr),rt(r)},xt=function(r){te(r),ee(r),rt(r)},se=function(r,t,e){var n=v.current.drawTool;if(!(!n||t.defaultPrevented)){if(r==="grip"){var a=e.attr("id");O.current&&w.Ys("#"+O.current).attr("fill",M.grip.fill),O.current===a?O.current=null:(O.current=a,e.attr("fill","#ff0"),et(t));return}if(O.current){var o=Ur();pr.apply(void 0,["edit"].concat(tr()(o))),o=null,mr("moveGrip",t,e),v.current.changeSize(fr());return}if(r==="point"){var c=e.attr("id").substring(11);L.current&&w.Ys("#path-point-"+L.current).attr("fill",M.point.fill),L.current===c?L.current=null:(L.current=c,e.attr("fill","#ff0"),et(t));return}if(L.current){var i=Ur();pr.apply(void 0,["edit"].concat(tr()(i))),i=null,mr("movePoint",t,e),v.current.changeSize(fr());return}if(r==="insertPoint"){le(t);return}if(r==="shape"){var l;at(e,W.current||(t==null||(l=t.sourceEvent)===null||l===void 0?void 0:l.shiftKey));return}if(r==="whole"){_(),u.current=null,E.current=null,v.current.changeSelect([]);return}}},Ct=function(){if(!u.current||!X.current)return!1;X.current=!1,_();var r=_t();if(r)return!1;var t=v.current,e=t.drawTool,n=t.curLabel,a=t.colorBindLabel,o=Er();a&&n&&!D.current[n]&&(D.current[n]=M.shapeCommon.stroke,v.current.changeBindColor(D.current)),n=n||o,u.current.attr("id","shape-".concat(o)),b.current[o]={shape_type:e,label:n,attrs:q.current},q.current=null,Ar(),v.current.changeSize(fr()),Qr(o,n,e==="ellipse"),pr("add",u.current),v.current.endDraw({id:o,label:n})},de=function(r){var t=dr(r);X.current=!0,u.current=null,_();var e=z()(t,2);return P.current.x=e[0],P.current.y=e[1],w.Ys("#shape-selector").attr("display","inline").attr("x",t[0]).attr("y",t[1]).attr("width",0).attr("height",0),!1},ve=function(){var r,t=w.Ys("#shape-selector").node().getBoundingClientRect(),e=Object.keys(b.current),n=[],a=(S==null||(r=S.current)===null||r===void 0?void 0:r.k)||1;e==null||e.forEach(function(o){var c=w.Ys("#shape-".concat(o)),i=n.length,l=w.Ys("#shape-path-group #shape-path-".concat(i)),s=c.node().getBoundingClientRect(),f=s.bottom>t.top&&s.top<t.bottom&&s.left<t.right&&s.right>t.left;if(f){var h;n.push(o);var p=c.node().getBBox(),d=p.x,m=p.y,x=p.width,R=p.height;l.node()?l.attr("display","inline").attr("transform",null):l=nt(i),d=d*a||0,m=m*a||0,x=x*a||0,R=R*a||0;var C=[[d-2,m-2],[d+x+2,m-2],[d+x+2,m+R+2],[d-2,m+R+2]],j=B.current(C);l.attr("d",j+"Z");var k=(h=b.current)===null||h===void 0?void 0:h[o],H=k.rotate;if(H){var G=z()(H,3),V=G[0],rr=G[1],$=G[2],cr=rr*a,or=$*a;l.attr("transform","rotate(".concat(V," ").concat(cr,",").concat(or,")"))}}else{var vr;(vr=l)===null||vr===void 0||vr.attr("display","none")}}),E.current=(n==null?void 0:n.length)&&n},fe=function(r){var t;if(!X.current)return!1;var e=dr(r),n=P.current,a=n.x,o=n.y,c=e[0]-a,i=e[1]-o,l=(S==null||(t=S.current)===null||t===void 0?void 0:t.k)||1,s=Math.abs(c),f=Math.abs(i);return c<0&&(a=e[0]),i<0&&(o=e[1]),a=a*l||0,o=o*l||0,s=s*l||0,f=f*l||0,w.Ys("#shape-related-group #shape-selector").attr("x",a).attr("y",o).attr("width",s).attr("height",f),ve(),!1},he=function(){if(!X.current)return!1;X.current=!1,w.td_("#shape-related-group #shape-selector").attr("display","none")},pe=function(r,t,e){var n;return r==="grip"?"moveGrip":r==="rotate"?"moveRotate":r==="point"&&!Q.current?"movePoint":r==="insertPoint"?r:t==="drag"||sr.current&&!W.current&&!I.current?"moveWhole":r==="shape"&&!sr.current&&(t==="move"||Y.current===e.attr("id")||E.current&&E.current.includes((n=e.attr("id"))===null||n===void 0?void 0:n.substring(6)))?"moveShape":r==="whole"&&t==="move"&&!sr.current&&!I.current?"selectShape":t==="rect"||t==="ellipse"?"shape":t},Rr=function(r,t){var e="",n="",a=null,o=!1,c=null;return w.ohM().filter(function(i){return jr(),e=v.current.drawTool,a=w.Ys(this),n=pe(r,e,a),e?!i.button||i.button===2&&Q.current&&n==="path":!1}).on("start",function(i){var l,s;if(i==null||(l=i.sourceEvent)===null||l===void 0||l.stopPropagation(),i==null||(s=i.sourceEvent)===null||s===void 0||s.preventDefault(),U.current=!1,o=!1,!(O.current||L.current)){if(n==="path"){E.current=null,ue(i,e,r,a);return}if(n==="moveShape"){var f,h,p=(f=a.attr("id"))===null||f===void 0?void 0:f.substring(6);if(!E.current&&Y.current!==a.attr("id")||E.current&&!E.current.includes(p)){var d;o=!0,at(a,W.current||(i==null||(d=i.sourceEvent)===null||d===void 0?void 0:d.shiftKey))}(I.current||i!=null&&(h=i.sourceEvent)!==null&&h!==void 0&&h.altKey)&&Yt()}else if(n.indexOf("move")>=0&&n.length>4)if(n==="moveWhole"){S.current=S.current||w.CRH;var m=dr(i),x=z()(m,2);P.current.mx=x[0],P.current.my=x[1]}else if(n==="moveGrip")et(i);else{var R=dr(i),C=z()(R,2);P.current.mx=C[0],P.current.my=C[1]}n.indexOf("move")>=0&&n.length>4&&n!=="moveWhole"&&(c=Ur())}}).on("drag",function(i){var l,s;if(i==null||(l=i.sourceEvent)===null||l===void 0||l.stopPropagation(),i==null||(s=i.sourceEvent)===null||s===void 0||s.preventDefault(),i!=null&&i.sourceEvent&&xt(i.sourceEvent),!(O.current||L.current||n==="path"||n==="insertPoint")&&!(i.dx===0&&i.dy===0)){if(U.current=!0,n.indexOf("move")>=0){t(n,i,a);return}if(n==="shape"){X.current?ye(i,e):(E.current=null,ge(i,e));return}n==="selectShape"&&(X.current?fe(i):de(i))}}).on("end",function(i){var l,s;if(i==null||(l=i.sourceEvent)===null||l===void 0||l.stopPropagation(),i==null||(s=i.sourceEvent)===null||s===void 0||s.preventDefault(),U.current)if(n==="shape"){Ct(),v.current.changeSelect(gr());return}else if(n==="selectShape"){he(),v.current.changeSelect(gr());return}else n!=="moveWhole"&&n.indexOf("move")>=0&&n.length>4&&((n==="moveGrip"||n==="movePoint")&&_r(),v.current.changeSize(fr()),c&&pr.apply(void 0,["edit"].concat(tr()(c))),c=null);else if(Q.current&&n==="path")q.current||(Q.current=!1);else if(!o){se(r,i,a);return}})},lt=function(r){var t,e="",n=e.drawTool;return w.sPX().scaleExtent((t=v.current)===null||t===void 0?void 0:t.scaleExtent).filter(function(a){return(!a.ctrlKey||a.type==="wheel")&&!a.button}).on("start",function(a){var o,c;n=v.current.drawTool,jr(),a==null||(o=a.sourceEvent)===null||o===void 0||o.stopPropagation(),a==null||(c=a.sourceEvent)===null||c===void 0||c.preventDefault()}).on("zoom",function(a){var o,c;a==null||(o=a.sourceEvent)===null||o===void 0||o.stopPropagation(),a==null||(c=a.sourceEvent)===null||c===void 0||c.preventDefault(),n&&r&&r(a)}).on("end",function(a){var o,c;a==null||(o=a.sourceEvent)===null||o===void 0||o.stopPropagation(),a==null||(c=a.sourceEvent)===null||c===void 0||c.preventDefault()})},Et=function(r){var t,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;e&&(S.current=r.transform),y.current.selectAll("g.layer").attr("transform",S.current),y.current.selectAll("g#shape-related-group").attr("transform","translate(".concat(S.current.x,", ").concat(S.current.y,")")),(t=E.current)!==null&&t!==void 0&&t.length?Fr():(Ar(),e?Dr(r):Dr()),tt(),Xr(),nr.current=S.current.k,v.current.changeScale(nr.current)},Rt=function(r){var t,e,n=!0,a=r;if(!a){var o;a=u.current,a.attr("fill",M.shapeCommon.fill),n=!1,(o=y.current.select("#path-add-point"))===null||o===void 0||o.attr("display","inline")}var c=(t=a.attr("id"))===null||t===void 0?void 0:t.substring(6),i=b.current[c],l=i.label,s=i.shape_type,f=a.clone(),h=Er();return f=A.current.select("#shape").append(function(){return f.node()}).attr("id","shape-".concat(h)).call(Rr("shape",mr)),b.current[h]=JSON.parse(JSON.stringify((e=b.current)===null||e===void 0?void 0:e[c])),Qr(h,l,s!=="rect"),n?""+h:(f.attr("fill",Zr(f.attr("stroke"))),Y.current="shape-".concat(h),f)},Yt=function(){if(E.current){var r,t=[];(r=E.current)===null||r===void 0||r.forEach(function(e){var n=w.Ys("#shape-".concat(e));t.push(Rt(n))}),E.current=t,v.current.changeSelect(gr()),pr("add",E.current);return}u.current&&(u.current=Rt(),v.current.changeSelect(gr()),pr("add",u.current))},ge=function(r,t){var e=dr(r);X.current=!0,u.current=A.current.select("#shape").append(t).call(Rr("shape",mr)),Gr();var n=Object.assign({},M.shapeCommon,M[t]),a="x",o="y";t==="ellipse"&&(a="cx",o="cy");var c=z()(e,2);P.current.x=c[0],P.current.y=c[1];var i=z()(e,2);return n[a]=i[0],n[o]=i[1],Object.keys(n).forEach(function(l){u.current.attr(l,n[l])}),!1},ye=function(r,t){if(!u.current||!X.current)return!1;var e=dr(r),n=P.current,a=n.x,o=n.y,c=e[0]-a,i=e[1]-o;if(t==="rect"){var l=Math.abs(c),s=Math.abs(i);return c<0&&(W.current&&l<s?a=a-s:a=e[0]),i<0&&(W.current&&l>s?o=o-l:o=e[1]),W.current&&(l>s?s=l:l=s),q.current={x:a,y:o,width:l,height:s},u.current.attr("x",a).attr("y",o).attr("width",l).attr("height",s),!1}if(t==="ellipse"){var f=c/2||0,h=i/2||0,p=Math.abs(f),d=Math.abs(h);W.current&&(p>d?(h=h>0?p:-p,d=p):(f=f>0?d:-d,p=d)),a=a+f,o=o+h,q.current={cx:a,cy:o,rx:p,ry:d},u.current.attr("cx",a).attr("cy",o).attr("rx",p).attr("ry",d)}return!1},Se=function(r){if(r!=="path"&&Q.current){Jr(),Q.current=!1;return}},me=function(){if(X.current){Ct();return}},be=function(r){sr.current=r.ctrlKey,I.current=r.altKey,W.current=r.shiftKey;var t=r.keyCode||r.which||r.charCode;if(Q.current){t===27&&Jr();return}if(t===8||t===46){L.current?(ne(),v.current.changeSize(fr())):it();return}if(sr.current&&t===67){var e;wr.current=E.current&&tr()(E.current)||((e=u.current)===null||e===void 0?void 0:e.attr("id"))||null}if(sr.current&&t===86){if(!wr.current)return;_();var n=zt()(wr.current)==="object";n?E.current=tr()(wr.current):u.current=w.Ys("#".concat(wr.current)),Yt(),n?Fr():["rect","ellipse"].includes(b.current[wr.current.substring(6)].shape_type)?Ar():Dr(),v.current.changeSize(fr())}if([37,38,39,40].includes(t)){var a=0,o=0;t===37?a=-1:t===38?o=-1:t===39?a=1:t===40&&(o=1);var c=Ur();pr.apply(void 0,["edit"].concat(tr()(c))),c=null,ct([a,o])}},we=function(r){sr.current=r.ctrlKey,I.current=r.altKey,W.current=r.shiftKey},Ot=function(r){r?w.Ys("body").on("keyup",we):(w.Ys("body").on("keyup",null),sr.current=!1,I.current=!1,W.current=!1,me())},xe=function(){var r;(r=w.Ys(N.current).select("div>svg"))===null||r===void 0||r.remove(),y.current=w.Ys(N.current).selectChild("div").append("svg").attr("id","svgroot");var t=y.current.append("defs"),e=t.append("pattern").attr("id","gridPattern").attr("patternUnits","userSpaceOnUse").attr("x",0).attr("y",0).attr("width","10").attr("height","10"),n=e.append("rect");n.attr("fill","none").attr("stroke","#787878").attr("stroke-width","0.5").attr("x",0).attr("y",0).attr("width","100%").attr("height","100%"),A.current=y.current.append("svg").attr("id","svgcont"),A.current.append("g").attr("class","layer").attr("id","img").style("pointer-events","none"),A.current.append("g").attr("class","layer").attr("id","shape");var a=y.current.append("g").attr("id","shape-related-group"),o=a.append("rect").attr("id","shape-selector").attr("display","none").style("pointer-events","none"),c=Object.assign({},M.rect,M.selectBox);Object.keys(c).forEach(function(k){o.attr(k,c[k])});var i=a.append("path").attr("id","path-add-point").attr("display","none"),l=M.pathAddPoint;Object.keys(l).forEach(function(k){i.attr(k,l[k])});var s=a.append("g").attr("class","grip-layer").attr("id","shape-grip-group").attr("display","none"),f=s.append("path").attr("id","resize-path").style("pointer-events","none"),h=M.line;Object.keys(h).forEach(function(k){f.attr(k,h[k])});for(var p=0;p<8;p++)s.append("rect").attr("id","resize-grip-"+ht[p]).style("cursor",ht[p]+"-resize");var d=M.grip;if(Object.keys(d).forEach(function(k){w.td_("#shape-grip-group rect").attr(k,d[k])}),v.current.rotateEnable){var m=s.append("line").attr("id","rotate-line").style("pointer-events","none"),x=M.rotateLine;Object.keys(x).forEach(function(k){m.attr(k,x[k])});var R=s.append("circle").attr("id","rotate-circle").attr("class","w-svg-rotate"),C=M.rotateCircle;Object.keys(C).forEach(function(k){R.attr(k,C[k])})}a.append("g").attr("class","point_layer").attr("id","path-point-group"),a.append("g").attr("class","path_layer").attr("id","shape-path-group").style("pointer-events","none"),a.append("g").attr("class","label_layer").attr("id","shape-label-group").attr("display","none").style("pointer-events","none"),a.append("rect").attr("id","grid").attr("display","none").style("pointer-events","none").attr("x",0).attr("y",0).attr("width","0").attr("height","0").attr("fill","url(#gridPattern)").attr("stroke","none");var j=y.current.append("g").attr("class","crosshair_layer").style("pointer-events","none").attr("display","none");j.append("rect").attr("id","crosshair-v-line").attr("width",.5).attr("height","100%"),j.append("rect").attr("id","crosshair-h-line").attr("width","100%").attr("height",.5),j.selectAll("rect").attr("x",0).attr("y",0).attr("fill","#00f").attr("stroke","none")},Ir=function(){var r=N.current.getBoundingClientRect(),t=r.right-r.left||M.svg.width,e=r.bottom-r.top||M.svg.height,n=[t,e];M.svg.width=n[0],M.svg.height=n[1],w.Ys("#svgcanvas").style("width",t+"px").style("height",e+"px"),w.td_("#svgroot,#svgcont").attr("width",t).attr("height",e)},Ce=function(){y.current.on("mousemove touchmove",xt).call(Rr("whole",mr)).call(lt(function(r){Et(r)})).on("dblclick.zoom",null),w.td_("#shape-grip-group rect").call(Rr("grip",mr)),v.current.rotateEnable&&w.Ys("#shape-grip-group circle").call(Rr("rotate",mr)),y.current.select("#path-add-point").call(Rr("insertPoint",mr))},Ee=function(){B.current=w.jvg(),xe(),Ir(),Ce(),ut(v.current.showCrosshair)},Lt=function(){y.current.selectAll("g.layer,g#shape-related-group").attr("transform",null),S.current=null,y.current.call(lt().transform,w.CRH),v.current.changeScale("1")},kt=function(){var r,t,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;ar.current=[],ir.current=[],_(),u.current&&(u.current=null),E.current&&(E.current=null),b.current={},e&&v.current.changeSize(fr()),Z.current=[],v.current.changeSelect([]),(r=y.current.selectAll("#shape *"))===null||r===void 0||r.remove(),(t=y.current.selectAll("#shape-label-group *"))===null||t===void 0||t.attr("display","none")},Re=function(){var r,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(r=A.current.select("g#img").select("image"))===null||r===void 0||r.remove(),kt(t),Lt()},Ye=function(r){var t,e,n=b.current[r].hide,a=(t=u.current)===null||t===void 0||(e=t.attr("id"))===null||e===void 0?void 0:e.substring(6);if(n=!n,b.current[r].hide=n,y.current.selectAll("g#shape #shape-".concat(r,",#shape-label-").concat(r)).attr("display",n?"none":"inline"),E.current&&E.current.includes(r)){var o,c=E.current.indexOf(r);if(E.current.splice(c,1),!((o=E.current)!==null&&o!==void 0&&o.length))E.current=null,w.td_("#shape-path-group *").attr("display","none"),v.current.changeSelect([]);else{var i;(i=w.Ys("#shape-path-".concat(E.current.length)))===null||i===void 0||i.attr("display","none"),Fr(),v.current.changeSelect(gr())}}else a&&a===r&&(_(),u.current=null,v.current.changeSelect([]));v.current.changeSize(fr())},Pt=function(r){return r?(Ir(),new Promise(function(t){var e=new Image;e.onload=function(n){var a,o,c=n.target.width,i=n.target.height,l=c,s=i,f=0,h=0,p=1,d=M.svg,m=d.width,x=d.height,R=m/x,C=c/i;R>C?(s=x,l=s*C,p=i/s):(l=m,s=l/C,p=c/l),f=(m-l)/2,h=(x-s)/2,hr.current={x:f,y:h,scale:p,w:l,h:s},(a=A.current.select("g#img").select("image"))===null||a===void 0||a.remove(),(o=A.current.select("g#img").append("image").attr("width",l).attr("height",s).attr("x",f).attr("y",h).attr("xlink:href",r).attr("draggable","false"))===null||o===void 0||o.style("filter",Lr.current),Xr(),v.current.imgLoaded({width:c,height:i}),t(!0)},e.onerror=function(){v.current.imgLoaded(!1),t(!1)},e.src=r})):!1},Oe=function(r){if(r){var t=Object.keys(b.current);t==null||t.forEach(function(e){var n=y.current.select("#shape-".concat(e));y.current.select("#shape-label-".concat(e)).attr("fill",n.attr("stroke"))})}},Le=function(r){y.current.select("#grid").attr("display",r&&(!S.current||S.current.k>=1)?"inline":"none"),Xr(!0)},ut=function(r){y.current.select(".crosshair_layer").attr("display",r&&F.drawTool!=="move"&&F.drawTool!=="drag"?"inline":"none")},ke=function(r){var t;Lr.current=r,(t=A.current.select("#img image"))===null||t===void 0||t.style("filter",r)},Pe=function(r){y.current.select("#shape-label-group").attr("display",r?"inline":"none"),tt(!0),Oe(r)},De=function(r,t){if(b.current[r]){b.current[r].label=t,y.current.select("#shape-label-".concat(r)).text(t),v.current.changeSize(fr());var e=v.current,n=e.colorBindLabel,a=e.curLabel;if(n){var o="",c=D.current[t];a?o=D.current[t]||ft(D.current):o=M.shapeCommon.stroke,Hr(r,o),c||(D.current[t]=o,v.current.changeBindColor(D.current))}}},je=function(r){var t=+nr.current,e=0,n=v.current.scaleExtent;isNaN(r)?r==="enlarge"?(e=(n[1]-t)/20,e=e>.1?e:.2,t=t+e):r==="narrow"&&(e=(t-n[0])/5,t=t-e):t=+r,t=t<n[0]?n[0]:t,t=t>n[1]?n[1]:t,lt().scaleTo(y.current,t),S.current=w.P2S(y.current.node()),Et(S.current,!1)},Ae=function(r){if(!r||!(r!=null&&r.length))return[];var t=[];try{t=r.map(function(e){var n;if(!(e!=null&&e.attrs))return e;var a=e.attrs,o=e.shape_type,c=vt()(e,Qt);if(o.indexOf("rect")>=0){var i=a,l=i.x,s=i.y,f=i.width,h=i.height;return a=[[l,s],[l+f,s+h]],br()({points:a,shape_type:"rectangle"},c)}else if(o==="ellipse"){var p=a,d=p.cx,m=p.cy,x=p.rx,R=p.ry;return x===R?(a=[[d,m],[d,m+R]],br()({points:a,shape_type:"circle"},c)):(a=[[d,m],[d,m+R],[d+x,m]],br()({points:a,shape_type:"ellipse"},c))}return br()({points:(n=a)===null||n===void 0?void 0:n.points,shape_type:o},c)})}catch(e){console.error(e.toString())}return t},Be=function(r){if(!r||!(r!=null&&r.length))return[];var t=[];try{t=r.map(function(e,n){var a;if(e=br()(br()({},e),{},{id:"".concat(n+1)}),(a=e)!==null&&a!==void 0&&a.attrs)return e;var o=e,c=o.points,i=o.shape_type,l=vt()(o,Vt);if(i.indexOf("rect")>=0){var s=c,f=z()(s,2),h=z()(f[0],2),p=h[0],d=h[1],m=z()(f[1],2),x=m[0],R=m[1],C=Math.abs(x-p),j=Math.abs(R-d),k=p,H=d;return k>x&&(k=x),H>R&&(H=R),c={x:k,y:H,width:C,height:j},br()({attrs:c,shape_type:"rect"},l)}else if(i==="circle"){var G=c,V=z()(G,2),rr=z()(V[0],2),$=rr[0],cr=rr[1],or=z()(V[1],2),vr=or[0],xr=or[1],yr=Math.sqrt(Math.pow(vr-$,2)+Math.pow(xr-cr,2));return c={cx:$,cy:cr,rx:yr,ry:yr},br()({attrs:c,shape_type:"ellipse"},l)}else if(i==="ellipse"){var kr=c,lr=z()(kr,3),ur=z()(lr[0],2),Yr=ur[0],Or=ur[1],Sr=z()(lr[1],2),Mr=Sr[1],Pr=z()(lr[2],1),zr=Pr[0],Vr=Mr-Or,qr=zr-Yr;return c={cx:Yr,cy:Or,rx:qr,ry:Vr},br()({attrs:c,shape_type:"ellipse"},l)}else if(i==="polygon")return br()({attrs:{points:c},shape_type:i},l);return br()({attrs:{points:c},shape_type:"line"},l)})}catch(e){console.error(e.toString())}return t},Me=function(r,t,e,n,a,o){Z.current.push(r),b.current[r]={label:e,shape_type:t,hide:n,attrs:a,rotate:o},e&&Qr(r,e,t!=="rect"),y.current.selectAll("g#shape #shape-".concat(r,",#shape-label-").concat(r)).attr("display",n?"none":"inline")},Je=function(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!(!r||!(r!=null&&r.length)))try{var e=hr.current,n=e.x,a=e.y,o=e.scale,c=A.current.select("#shape");r.forEach(function(i){var l=i.attrs,s=i.id,f=i.hide,h=i.label,p=i.shape_type,d=i.rotate,m=null,x=null,R=null;if(p==="rect"||p==="ellipse"){var C,j=Nr(p),k=l[j.x],H=l[j.y],G=l[j.w],V=l[j.h];if(!+G||!+V)return;s||(s=Er()),m=c.append(p).attr("id","shape-".concat(s)).call(Rr("shape",mr)),Gr(h);var rr=Object.assign({},M.shapeCommon,M[p]);if(Object.keys(rr).forEach(function(Tr){m.attr(Tr,rr[Tr])}),k=+k/o+n,H=+H/o+a,G=G/o,V=V/o,m.attr(j.x,k).attr(j.y,H).attr(j.w,G).attr(j.h,V),x=(C={},Wr()(C,j.x,k),Wr()(C,j.y,H),Wr()(C,j.w,G),Wr()(C,j.h,V),C),d){var $=$r(s),cr=$.centerX,or=$.centerY;R=[d,cr,or],m.attr("transform","rotate(".concat(d," ").concat(cr,",").concat(or,")"))}}else{s||(s=Er()),Gr(h);var vr=l.points,xr=vr.length,yr=c.append("path").attr("id","shape-".concat(s)).call(Rr("shape",mr)),kr=Object.assign({},M.shapeCommon,M.path),lr=[];Object.keys(kr).forEach(function(Tr){yr.attr(Tr,kr[Tr])});for(var ur=0;ur<xr;ur++){var Yr=z()(vr[ur],2),Or=Yr[0],Sr=Yr[1];Or=+Or/o+n,Sr=+Sr/o+a,lr[ur]=[Or,Sr];var Mr="path-point-".concat(ur+1);ot(Mr,ur,!1)}var Pr=B.current(lr);if(p==="polygon"&&(Pr+="Z"),yr.attr("d",Pr),x={points:lr},d){var zr=$r(s),Vr=zr.centerX,qr=zr.centerY;R=[d,Vr,qr],yr.attr("transform","rotate(".concat(d," ").concat(Vr,",").concat(qr,")"))}}i.id=s,Me(s,p,h,f,x,R)}),v.current.changeBindColor(D.current),t&&v.current.changeSize(r)}catch(i){console.error(i.toString())}},ze=function(){return ar.current.length>0},Ne=function(){return ir.current.length>0},Fe=function(r){r&&!N.current&&(N.current=r)};return(0,T.useEffect)(function(){return N.current&&(Ee(),window.addEventListener("resize",Ir)),function(){w.Ys("body").on("keyup",null),window.removeEventListener("resize",Ir)}},[]),(0,T.useEffect)(function(){F.src!==v.current.src&&Pt(F.src),F.drawTool!==v.current.drawTool&&(Se(F.drawTool),ut(F.showCrosshair)),F.showLabel!==v.current.showLabel&&Pe(F.showLabel),F.showGrid!==v.current.showGrid&&Le(F.showGrid),F.showCrosshair!==v.current.showCrosshair&&ut(F.showCrosshair),v.current=F},[F]),(0,T.useImperativeHandle)(K,function(){return{reload:Re,zoomReload:Lt,loadImg:Pt,clearShape:kt,toggleShape:Ye,getMarkData:fr,selectShape:at,delSelectShape:it,getSelectIds:gr,editLabel:De,adjustImg:ke,undoSvg:ae,canUndo:ze,redoSvg:ie,canRedo:Ne,changeScale:je,changeColor:re,drawShapeFromSize:Je,setCanvasSize:Ir,convertToPoints:Ae,convertToAttrs:Be}}),(0,Cr.jsxs)("div",{ref:Fe,className:"w-draw-container ".concat(v.current.className||""),onKeyDown:be,children:[(0,Cr.jsx)("div",{id:"svgcanvas",className:"w-svg-box",tabIndex:-1,onFocus:function(){return Ot(!0)},onBlur:function(){return Ot(!1)}}),F==null?void 0:F.children]})});pt.defaultProps={src:"",curLabel:"",showLabel:!1,showGrid:!1,showCrosshair:!1,minSize:[4,4],drawTool:"",scaleExtent:[.02,30],colorBindLabel:!0,rotateEnable:!1,changeSize:function(){},changeBindColor:function(){},changeSelect:function(){},changeScale:function(){},imgLoaded:function(){},endDraw:function(){}};var qt=pt,gt=function(K){var v=K.shapeList,N=K.selectShapeIds,y=K.delFunc,A=K.selectFunc,u=K.leftRender,Y=K.rightRender,J=K.topRender,O=K.title,L=K.className,B=(0,T.useRef)(null),S=(0,T.useState)([]),P=z()(S,2),X=P[0],Q=P[1],U=(0,T.useRef)(-1),Z=(0,T.useRef)(-1);(0,T.useEffect)(function(){Q(N)},[N]);var nr=function(){Z.current=-1,U.current=-1;var I=v.length,b=N==null?void 0:N.length;if(!(!I||!b)){var q=tr()(N);q.sort(function(ir,_){return ir-_});for(var D=0;D<I;D++){var ar=v[D].id;ar===q[0]&&(U.current=D),ar===q[b-1]&&(Z.current=D)}}},hr=function(I){I?(B.current.classList.add("box-active"),nr()):B.current.classList.remove("box-active")},E=function(I){A&&(I.length===1?A(I[0]):A(I))},wr=function(I){var b=I.keyCode||I.which||I.charCode;if(b===8||b===46){I==null||I.stopPropagation(),y&&y();return}if(I.ctrlKey&&b===65){I==null||I.stopPropagation();var q=v==null?void 0:v.map(function(_){return _==null?void 0:_.id});Q(tr()(q)),E(q),Z.current=v.length-1,U.current=0;return}var D=-1,ar=v.length-1;if(b===38&&(U.current>0||X.length>1)?(D=U.current-1,D=D<0?0:D):b===40&&(Z.current<ar||X.length>1)&&(D=Z.current+1,D=D>ar?ar:D),D!==-1){var ir;I==null||I.stopPropagation(),X=[(ir=v[D])===null||ir===void 0?void 0:ir.id],Q(X),E(X),Z.current=D,U.current=D}},Lr=function(I,b,q){q.stopPropagation();var D=tr()(X),ar=D.indexOf(I);if(q.shiftKey){b<=U.current?U.current=b:Z.current=b,U.current=U.current<0?0:U.current,D=[];for(var ir=U.current;ir<=Z.current;ir++){var _;D.push((_=v[ir])===null||_===void 0?void 0:_.id)}}else if(q.ctrlKey)if(ar>=0){if(D.length===1)U.current=-1,Z.current=-1;else if(b===U.current)for(var jr=U.current+1;jr<=Z.current;jr++){var dr;if(D.includes((dr=v[jr])===null||dr===void 0?void 0:dr.id)){U.current=jr;break}}else if(b===Z.current)for(var Er=Z.current-1;Er>=U.current;Er--){var Nr;if(D.includes((Nr=v[Er])===null||Nr===void 0?void 0:Nr.id)){Z.current=Er;break}}D.splice(ar,1)}else D.push(I),b<U.current&&(U.current=b),b>Z.current&&(Z.current=b);else D=[I],Z.current=b,U.current=b;Q(D),E(D)},sr=function(){X.length&&(Q([]),E([]),Z.current=-1,U.current=-1)};return(0,Cr.jsxs)("div",{className:"win-box ".concat(L),children:[(0,Cr.jsxs)("div",{className:"w-head",children:[O||"\u56FE\u5F62\u5217\u8868",(0,Cr.jsx)("div",{className:"flex-center",children:J&&J()})]}),(0,Cr.jsx)("div",{className:"w-box w-box-overflow",ref:B,tabIndex:-1,onFocus:function(){return hr(!0)},onBlur:function(){return hr(!1)},onClick:sr,onKeyDown:wr,children:v&&v.map(function(W,I){var b=W==null?void 0:W.id;return(0,Cr.jsxs)("div",{className:"list-item ".concat(X.includes(b)?"on":""),onClick:function(D){return Lr(b,I,D)},children:[u&&u(W,I),(0,Cr.jsx)("p",{className:"list-txt",title:W==null?void 0:W.label,children:W==null?void 0:W.label}),Y&&Y(W,I)]},I)})})]})};gt.defaultProps={className:"",title:"",shapeList:[],selectShapeIds:[],leftRender:null,rightRender:null,topRender:null,delFunc:function(){},selectFunc:function(){}};var $t=gt}}]);
