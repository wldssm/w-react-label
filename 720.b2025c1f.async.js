"use strict";(self.webpackChunkw_react_label=self.webpackChunkw_react_label||[]).push([[720],{52720:function(Ie,lt,tr){tr.r(lt),tr.d(lt,{WColorBlock:function(){return jt},WDraw:function(){return qt},WShapeList:function(){return $t}});var Dt=tr(5574),I=tr.n(Dt),T=tr(67294),xr=tr(85893),ut=function(K){var d=K.colorBlocks,z=(0,T.useState)(d[0]),y=I()(z,2),A=y[0],u=y[1];(0,T.useEffect)(function(){K.color&&u(K.color)},[]);var O=function(P,Y){u(P),K.onChange&&K.onChange(P,Y)};return(0,xr.jsx)("div",{className:"w-color-block-box",children:d.map(function(M,P){return(0,xr.jsx)("div",{onClick:function(B){return O(M,B)},className:"w-color-block ".concat(M===A?"on":""),style:{background:M}},P)})})};ut.defaultProps={color:"",colorBlocks:["#f00","#FFA500","#ff0","#0f0","#0ff","#00f","#800080","#fff"],onChange:function(){}};var jt=ut,At=tr(9783),Wr=tr.n(At),Bt=tr(97857),mr=tr.n(Bt),Mt=tr(13769),st=tr.n(Mt),Jt=tr(52677),zt=tr.n(Jt),Nt=tr(19632),nr=tr.n(Nt),Ft=tr(61227),It=tr.n(Ft),w=tr(46886),J={color:["#CB3D45","#DA833C","#2378DE"],svg:{width:800,height:600},shapeCommon:{fill:"rgba(0, 0, 0, 0)",stroke:"#CB3D45","stroke-width":2,"vector-effect":"non-scaling-stroke"},rect:{x:0,y:0,width:0,height:0},selectBox:{"stroke-width":1,fill:"rgb(34 34 204 / 12%)",stroke:"rgb(34 34 204 / 45%)","vector-effect":"non-scaling-stroke"},ellipse:{cx:0,cy:0,rx:0,ry:0},path:{d:""},line:{d:"",fill:"none",stroke:"#00f","stroke-width":1},point:{cx:0,cy:0,r:4,fill:"rgba(0,0,255,.45)",stroke:"rgba(0, 0, 0, 0)","stroke-width":10},grip:{width:8,height:8,fill:"rgba(0,0,255,.45)",stroke:"rgba(0, 0, 0, 0)","stroke-width":10},font:{x:0,y:0,fill:"#CB3D45",stroke:"none","font-size":16,"text-anchor":"start","dominant-baseline":"text-after-edge"},pathAddPoint:{fill:"none",stroke:"rgba(0,0,0,0)","stroke-width":25},rotateLine:{x1:0,y1:0,x2:0,y2:0,stroke:"rgba(0,0,255,.45)","stroke-width":1},rotateCircle:{cx:0,cy:0,r:5,fill:"rgba(0,0,255,.45)",stroke:"rgba(0, 0, 0, 0)","stroke-width":6}},Tt=["128, 0, 0","0, 128, 0","128, 128, 0","0, 0, 128","128, 0, 128","0, 128, 128","128, 128, 128","64, 0, 0","192, 0, 0","64, 128, 0","192, 128, 0","64, 0, 128","192, 0, 128","64, 128, 128","192, 128, 128","0, 64, 0","128, 64, 0","0, 192, 0","128, 192, 0","0, 64, 128","128, 64, 128","0, 192, 128","128, 192, 128","64, 64, 0","192, 64, 0","64, 192, 0","192, 192, 0","64, 64, 128","192, 64, 128","64, 192, 128","192, 192, 128","0, 0, 64","128, 0, 64","0, 128, 64","128, 128, 64","0, 0, 192","128, 0, 192","0, 128, 192","128, 128, 192","64, 0, 64","192, 0, 64","64, 128, 64","192, 128, 64","64, 0, 192","192, 0, 192","64, 128, 192","192, 128, 192","0, 64, 64","128, 64, 64","0, 192, 64","128, 192, 64","0, 64, 192","128, 64, 192","0, 192, 192","128, 192, 192","64, 64, 64","192, 64, 64","64, 192, 64","192, 192, 64","64, 64, 192","192, 64, 192","64, 192, 192","192, 192, 192","32, 0, 0","160, 0, 0","32, 128, 0","160, 128, 0","32, 0, 128","160, 0, 128","32, 128, 128","160, 128, 128","96, 0, 0","224, 0, 0","96, 128, 0","224, 128, 0","96, 0, 128","224, 0, 128","96, 128, 128","224, 128, 128","32, 64, 0","160, 64, 0","32, 192, 0","160, 192, 0","32, 64, 128","160, 64, 128","32, 192, 128","160, 192, 128","96, 64, 0","224, 64, 0","96, 192, 0","224, 192, 0","96, 64, 128","224, 64, 128","96, 192, 128","224, 192, 128","32, 0, 64","160, 0, 64","32, 128, 64","160, 128, 64","32, 0, 192","160, 0, 192","32, 128, 192","160, 128, 192","96, 0, 64","224, 0, 64","96, 128, 64","224, 128, 64","96, 0, 192","224, 0, 192","96, 128, 192","224, 128, 192","32, 64, 64","160, 64, 64","32, 192, 64","160, 192, 64","32, 64, 192","160, 64, 192","32, 192, 192","160, 192, 192","96, 64, 64","224, 64, 64","96, 192, 64","224, 192, 64","96, 64, 192","224, 64, 192","96, 192, 192","224, 192, 192","0, 32, 0","128, 32, 0","0, 160, 0","128, 160, 0","0, 32, 128","128, 32, 128","0, 160, 128","128, 160, 128","64, 32, 0","192, 32, 0","64, 160, 0","192, 160, 0","64, 32, 128","192, 32, 128","64, 160, 128","192, 160, 128","0, 96, 0","128, 96, 0","0, 224, 0","128, 224, 0","0, 96, 128","128, 96, 128","0, 224, 128","128, 224, 128","64, 96, 0","192, 96, 0","64, 224, 0","192, 224, 0","64, 96, 128","192, 96, 128","64, 224, 128","192, 224, 128","0, 32, 64","128, 32, 64","0, 160, 64","128, 160, 64","0, 32, 192","128, 32, 192","0, 160, 192","128, 160, 192","64, 32, 64","192, 32, 64","64, 160, 64","192, 160, 64","64, 32, 192","192, 32, 192","64, 160, 192","192, 160, 192","0, 96, 64","128, 96, 64","0, 224, 64","128, 224, 64","0, 96, 192","128, 96, 192","0, 224, 192","128, 224, 192","64, 96, 64","192, 96, 64","64, 224, 64","192, 224, 64","64, 96, 192","192, 96, 192","64, 224, 192","192, 224, 192","32, 32, 0","160, 32, 0","32, 160, 0","160, 160, 0","32, 32, 128","160, 32, 128","32, 160, 128","160, 160, 128","96, 32, 0","224, 32, 0","96, 160, 0","224, 160, 0","96, 32, 128","224, 32, 128","96, 160, 128","224, 160, 128","32, 96, 0","160, 96, 0","32, 224, 0","160, 224, 0","32, 96, 128","160, 96, 128","32, 224, 128","160, 224, 128","96, 96, 0","224, 96, 0","96, 224, 0","224, 224, 0","96, 96, 128","224, 96, 128","96, 224, 128","224, 224, 128","32, 32, 64","160, 32, 64","32, 160, 64","160, 160, 64","32, 32, 192","160, 32, 192","32, 160, 192","160, 160, 192","96, 32, 64","224, 32, 64","96, 160, 64","224, 160, 64","96, 32, 192","224, 32, 192","96, 160, 192","224, 160, 192","32, 96, 64","160, 96, 64","32, 224, 64","160, 224, 64","32, 96, 192","160, 96, 192","32, 224, 192","160, 224, 192","96, 96, 64","224, 96, 64","96, 224, 64","224, 224, 64","96, 96, 192","224, 96, 192","96, 224, 192","224, 224, 192","0,0,0"],dt=function(K){var d=Object.keys(K).length;return"rgb("+Tt[d]+")"},vt=["n","ne","e","se","s","sw","w","nw"],Wt=function(K){return!!(K.touches&&K.touches.length)},Kt=function(K,d){for(var z=arguments.length,y=new Array(z>2?z-2:0),A=2;A<z;A++)y[A-2]=arguments[A];var u={},O=y[0],M=y[1],P=y[2],Y=y[3];if(K==="rect"){if(u=Xt.apply(void 0,y),d){var B=Y.width,S=Y.height,j=u.width-u.height,X=O.indexOf("n")>=0&&P<=S||O.indexOf("s")>=0&&P<=-S,V=O.indexOf("e")>=0&&M<=-B||O.indexOf("w")>=0&&M<=B;j>0?(X&&(u.y=u.y-j),u.height=u.width):(V&&(u.x=u.x+j),u.width=u.height)}}else if(K==="ellipse"){if(u=Gt.apply(void 0,y),d){var U=Y.rx,H=Y.ry,ar=u.rx-u.ry,vr=O.indexOf("n")>=0&&P<=H*2||O.indexOf("s")>=0&&P<=-H*2,C=O.indexOf("e")>=0&&M<=-U*2||O.indexOf("w")>=0&&M<=U*2;ar>0?(vr&&(ar=-ar),u.ry=u.rx,u.cy=u.cy+ar):(C&&(ar=-ar),u.cx=u.cx-ar,u.rx=u.ry)}}else u=Zt.apply(void 0,[d].concat(y));return u},Xt=function(){for(var K=arguments.length,d=new Array(K),z=0;z<K;z++)d[z]=arguments[z];var y=d[0],A=d[1],u=d[2],O=d[3],M=O.x,P=O.y,Y=O.width,B=O.height,S=Y,j=B;return y.indexOf("n")>=0?(j=B-u,j>0?P=P+u:P=P+B,j=Math.abs(j)):y.indexOf("s")>=0&&(j=B+u,j<0&&(P=P+B+u),j=Math.abs(j)),y.indexOf("w")>=0?(S=Y-A,S<0?M=M+Y:M=M+A,S=Math.abs(S)):y.indexOf("e")>=0&&(S=Y+A,S<0&&(M=M+Y+A),S=Math.abs(S)),{x:M,y:P,width:S,height:j}},Gt=function(){for(var K=arguments.length,d=new Array(K),z=0;z<K;z++)d[z]=arguments[z];var y=d[0],A=d[1],u=d[2],O=d[3],M=O.cx,P=O.cy,Y=O.rx,B=O.ry;return A=A/2,u=u/2,y.indexOf("n")>=0?(B=B-u,P=P+u,B=Math.abs(B)):y.indexOf("s")>=0&&(B=B+u,P=P+u,B=Math.abs(B)),y.indexOf("w")>=0?(Y=Y-A,M=M+A,Y=Math.abs(Y)):y.indexOf("e")>=0&&(Y=Y+A,M=M+A,Y=Math.abs(Y)),{cx:M,cy:P,rx:Y,ry:B}},Zt=function(K){for(var d=arguments.length,z=new Array(d>1?d-1:0),y=1;y<d;y++)z[y-1]=arguments[y];var A=z[0],u=z[1],O=z[2],M=z[3],P=M.points,Y=M.boundRect,B=(P==null?void 0:P.length)||0,S=[],j=Y.x,X=Y.y,V=Y.width,U=Y.height,H=V/U,ar=A.indexOf("n")>=0,vr=A.indexOf("s")>=0,C=A.indexOf("w")>=0,br=A.indexOf("e")>=0,Rr="";K&&(A.length===1?(ar||vr?(u=O*H,Rr="v"):(O=u/H,Rr="h"),ar?u=-u:C&&(O=-O)):(O=u/H,(C&&vr||br&&ar)&&(O=-O)));for(var ur=0;ur<B;ur++){var W=nr()(P[ur]),F=Math.abs(W[0]-j)/V,m=Math.abs(W[1]-X)/U;ar&&(W[1]+=O*(1-m)),(vr||Rr==="h")&&(W[1]+=O*m),C&&(W[0]+=u*(1-F)),(br||Rr==="v")&&(W[0]+=u*F),S.push(W)}return{points:S}},Ht=function(K,d,z){var y=I()(K,2),A=y[0],u=y[1],O=I()(d,2),M=O[0],P=O[1],Y=I()(z,2),B=Y[0],S=Y[1],j=B-M,X=S-P,V=((A-M)*j+(u-P)*X)/(j*j+X*X);return V<0?(j=A-M,X=u-P):V>1?(j=A-B,X=u-S):(j=A-(M+V*j),X=u-(P+V*X)),Math.sqrt(j*j+X*X)},ft=function(K,d,z,y,A,u){var O=A*Math.PI/180;u&&(O=-O);var M=Math.cos(O),P=Math.sin(O),Y=K-z,B=d-y,S=Y*M-B*P+z,j=Y*P+B*M+y;return[S,j]},Ut=function(K,d,z,y,A,u,O,M){var P=K+z/2,Y=d+y/2,B=ft(P,Y,A,u,O,M),S=I()(B,2),j=S[0],X=S[1],V=j-P,U=X-Y;return{changeX:V,changeY:U}},Qt=["attrs","shape_type"],Vt=["points","shape_type"],ht=(0,T.forwardRef)(function(N,K){var d=(0,T.useRef)(N),z=(0,T.useRef)(null),y=(0,T.useRef)(null),A=(0,T.useRef)(null),u=(0,T.useRef)(null),O=(0,T.useRef)(null),M=(0,T.useRef)(null),P=(0,T.useRef)(""),Y=(0,T.useRef)(null),B=(0,T.useRef)(null),S=(0,T.useRef)(null),j=(0,T.useRef)({x:0,y:0,w:0,h:0,mx:0,my:0}),X=(0,T.useRef)(!1),V=(0,T.useRef)(!1),U=(0,T.useRef)(!1),H=(0,T.useRef)([]),ar=(0,T.useRef)("1"),vr=(0,T.useRef)({x:0,y:0,scale:1,w:0,h:0}),C=(0,T.useRef)(null),br=(0,T.useRef)(null),Rr=(0,T.useRef)(""),ur=(0,T.useRef)(!1),W=(0,T.useRef)(!1),F=(0,T.useRef)(!1),m=(0,T.useRef)({}),q=(0,T.useRef)(null),D=(0,T.useRef)({}),ir=(0,T.useRef)([]),cr=(0,T.useRef)([]),rr=function(){var r;(r=w.td_("#shape-grip-group,#path-point-group *,#shape-path-group *,#path-add-point"))===null||r===void 0||r.attr("display","none"),M.current="",O.current&&(w.Ys("#"+O.current).attr("fill",J.shapeCommon.fill),O.current=""),P.current&&(w.Ys("#"+P.current).attr("fill",J.grip.fill),P.current=""),Y.current&&(w.Ys("#path-point-"+Y.current).attr("fill",J.point.fill),Y.current="")},Pr=function(){if(document.getElementById("svgcanvas")!==document.activeElement){var r;(r=document.getElementById("svgcanvas"))===null||r===void 0||r.focus()}},sr=function(r){var t=(r==null?void 0:r.sourceEvent)||r,e=[];if(Wt(t)?e=w.cx$(t.touches[0]||t.changedTouches[0],y.current.node()):e=w.cx$(t,y.current.node()),S.current){var n=S.current,a=n.x,c=n.y,o=n.k;e[0]=(e[0]-a)/o,e[1]=(e[1]-c)/o}return e},Cr=function(){for(var r=H.current.length||0,t=0,e=0;e<r;e++)if(+H.current[e]!==e+1){t=e+1;break}return t===0&&(t=r+1),t=""+t,H.current.splice(t-1,0,t),t},zr=function(r){return r==="ellipse"?{x:"cx",y:"cy",w:"rx",h:"ry"}:{x:"x",y:"y",w:"width",h:"height"}},_t=function(){var r=d.current.drawTool,t=N.minSize,e=0,n=0;return r==="rect"?(e=u.current.attr("width"),n=u.current.attr("height")):r==="ellipse"&&(e=u.current.attr("rx")*2||0,n=u.current.attr("ry")*2||0),+e<=t[0]||+n<=t[1]?(u.current.remove(),u.current=null,w.Ys("#shape-grip-group").attr("display","none"),!0):!1},$r=function(r){var t,e,n=w.Ys("#shape-".concat(r));if(!n)return{};var a=n==null||(t=n.node())===null||t===void 0?void 0:t.getBBox(),c=(S==null||(e=S.current)===null||e===void 0?void 0:e.k)||1,o=a.x,i=a.y,l=a.width,s=a.height,v=o+l/2,h=i+s/2,p=v*c,f=h*c;return{centerX:v,centerY:h,gripCenterX:p,gripCenterY:f}},gt=function(){var r,t,e,n;if(u.current){var a=(r=u.current.attr("id"))===null||r===void 0?void 0:r.substring(6),c=(t=m.current[a])===null||t===void 0?void 0:t.rotate;if(c){var o=I()(c,3),i=o[0],l=o[1],s=o[2],v=(e=u.current)===null||e===void 0||(n=e.node())===null||n===void 0?void 0:n.getBBox(),h=v.x,p=v.y,f=v.width,b=v.height,x=Ut(h,p,f,b,l,s,i),E=x.changeX,R=x.changeY;return[E,R]}}},kr=function(){var r,t,e,n,a;if(!u.current||V.current||M.current)return!1;var c=(r=u.current.attr("id"))===null||r===void 0?void 0:r.substring(6),o=(t=m.current)===null||t===void 0?void 0:t[c],i=o.hide,l=o.rotate,s=w.Ys("#shape-grip-group");if(s.attr("display",i?"none":"inline"),!i){var v=(S==null||(e=S.current)===null||e===void 0?void 0:e.k)||1,h=(n=u.current)===null||n===void 0||(a=n.node())===null||a===void 0?void 0:a.getBBox(),p=h.x,f=h.y,b=h.width,x=h.height,E=J.grip.width/2,R=J.grip.height/2;if(p=p*v||0,f=f*v||0,b=b*v||0,x=x*v||0,d.current.rotateEnable){var k=p+b/2;s.select("#rotate-line").attr("x1",k).attr("y1",f-4).attr("x2",k).attr("y2",f-16),s.select("#rotate-circle").attr("cx",k).attr("cy",f-20)}if(l){var L=I()(l,3),G=L[0],Z=L[1],Q=L[2],$=Z*v,_=Q*v;s.attr("transform","rotate(".concat(G," ").concat($,",").concat(_,")")),u.current.attr("transform","rotate(".concat(G," ").concat(Z,",").concat(Q,")"))}else s.attr("transform",null);var or=[[p,f],[p+b,f],[p+b,f+x],[p,f+x]],er=B.current(or);w.Ys("#resize-path").attr("d",er+"Z"),s.select("#resize-grip-nw").attr("x",p-E).attr("y",f-R),s.select("#resize-grip-n").attr("x",p+b/2-E).attr("y",f-R),s.select("#resize-grip-ne").attr("x",p+b-E).attr("y",f-R),s.select("#resize-grip-w").attr("x",p-E).attr("y",f+x/2-R),s.select("#resize-grip-e").attr("x",p+b-E).attr("y",f+x/2-R),s.select("#resize-grip-sw").attr("x",p-E).attr("y",f+x-R),s.select("#resize-grip-s").attr("x",p+b/2-E).attr("y",f+x-R),s.select("#resize-grip-se").attr("x",p+b-E).attr("y",f+x-R)}},yt=function(r){var t,e;if(!q.current){for(var n=(t=m.current)===null||t===void 0?void 0:t[r],a=n.attrs.points,c=n.shape_type,o=a.length,i=(S==null||(e=S.current)===null||e===void 0?void 0:e.k)||1,l=[],s=0;s<o;s++){var v=I()(a[s],2),h=v[0],p=v[1];h=h*i,p=p*i,l[s]=[h,p]}var f=B.current(l);c==="polygon"&&(f+="Z"),y.current.select("#path-add-point").attr("d",f)}},_r=function(r){var t,e=q.current||[],n=e.length;if(!(!V.current||!n)){var a=(S==null||(t=S.current)===null||t===void 0?void 0:t.k)||1,c=I()(e[n-1],2),o=c[0],i=c[1],l=sr(r),s=I()(l,2),v=s[0],h=s[1];o=o*a,i=i*a,v=v*a,h=h*a;var p=[[o,i],[v,h]],f=B.current(p);w.Ys("#path-stretch-line").attr("d",f)}},Yr=function(r){var t,e,n,a,c,o;if(!u.current||!u.current.attr("id"))return!1;var i=(t=u.current.attr("id"))===null||t===void 0?void 0:t.substring(6),l=((e=m.current)===null||e===void 0||(n=e[i])===null||n===void 0||(a=n.attrs)===null||a===void 0?void 0:a.points)||q.current||[],s=l.length,v=(S==null||(c=S.current)===null||c===void 0?void 0:c.k)||1;if(s){yt(i);for(var h=0;h<s;h++){var p=w.Ys("#path-point-group #path-point-".concat(h+1)),f=I()(l[h],2),b=f[0],x=f[1];b=b*v,x=x*v,p.attr("cx",b).attr("cy",x).attr("display","inline")}r&&_r(r);var E=(o=m.current)===null||o===void 0?void 0:o[i],R=E.rotate;if(R){var k=I()(R,3),L=k[0],G=k[1],Z=k[2],Q=G*v,$=Z*v,_="rotate(".concat(L," ").concat(Q,",").concat($,")");w.Ys("#path-point-group").attr("transform",_),w.Ys("#path-add-point").attr("transform",_),u.current.attr("transform","rotate(".concat(L," ").concat(G,",").concat(Z,")"))}else w.Ys("#path-point-group").attr("transform",null),w.Ys("#path-add-point").attr("transform",null)}},Kr=function(r){var t=r?N.showGrid:d.current.showGrid;if(t)if(S.current=S.current||w.CRH,S.current.k<1)y.current.select("#grid").attr("display","none");else{var e=vr.current,n=e.x,a=e.y,c=e.w,o=e.h,i=S.current.k,l=10*i,s=n*i,v=a*i;y.current.select("#gridPattern").attr("width",l).attr("height",l).attr("x",s).attr("y",v),y.current.select("#grid").attr("display","inline").attr("x",s).attr("y",v).attr("width",c*i).attr("height",o*i)}},Xr=function(r){var t=d.current,e=t.curLabel,n=t.colorBindLabel,a=r||e;if(n){var c=D.current[a]||dt(D.current);J.shapeCommon.stroke=c,J.font.fill=c,r&&(D.current[a]=c)}},Gr=function(r){var t=r||J.shapeCommon.stroke;return w.$_Y(t).copy({opacity:.2})},Zr=function(r,t){var e=w.Ys("#shape-".concat(r));e.attr("stroke",t),d.current.showLabel&&y.current.select("#shape-label-".concat(r)).attr("fill",t),O.current==="shape-"+r&&e.attr("fill",Gr(t))},re=function(r){var t,e=d.current,n=e.colorBindLabel,a=e.curLabel;if(n){var c,o,i;if(C.current||!u.current)return;var l=(c=u.current.attr("id"))===null||c===void 0?void 0:c.substring(6),s=(o=m.current)===null||o===void 0?void 0:o[l],v=s.label,h=D.current[a];(i=Object.keys(m.current))===null||i===void 0||i.forEach(function(b){var x=m.current[b].label;x===v&&Zr(b,r)}),h&&(J.shapeCommon.stroke=h,J.font.fill=h),D.current[v]=r,d.current.changeBindColor(D.current);return}if(J.shapeCommon.stroke=r,J.font.fill=r,C.current){var p;(p=C.current)===null||p===void 0||p.forEach(function(b){Zr(b,r)});return}if(u.current){var f=(t=u.current.attr("id"))===null||t===void 0?void 0:t.substring(6);Zr(f,r)}},Dr=function(r,t,e){var n;if(t){var a=(S==null||(n=S.current)===null||n===void 0?void 0:n.k)||1,c=m.current[r],o=c.shape_type,i=c.attrs,l=y.current.select("#shape-label-".concat(r)),s=0,v=0;if(o==="ellipse"){var h=i.cx,p=i.cy,f=i.ry;s=h,v=p-f}else if(o==="rect")s=i.x,v=i.y;else{var b=i.points,x=I()(b[0],2);s=x[0],v=x[1];for(var E=1;E<b.length;E++){var R=I()(b[E],2),k=R[0],L=R[1];v>L?(v=L,s=k):v===L&&s>k&&(s=k)}}s=s*a||0,v=v*a||0,l.attr("x",s).attr("y",v),e&&l.attr("fill",J.font.fill)}},rt=function(r){var t=r?N.showLabel:d.current.showLabel;if(t){var e=Object.keys(m.current);e==null||e.forEach(function(n){Dr(n,t)})}},fr=function(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++)t[e]=arguments[e];ir.current.push(t),cr.current=[]},Hr=function(){var r=[],t={};if(C.current){var e,n={};(e=C.current)===null||e===void 0||e.forEach(function(i){var l=w.Ys("#shape-".concat(i));t[i]=JSON.parse(JSON.stringify(m.current[i])),n[i]=l}),r=[C.current,t,n]}else if(u.current){var a,c,o=(a=u.current)===null||a===void 0||(c=a.attr("id"))===null||c===void 0?void 0:c.substring(6);t[o]=JSON.parse(JSON.stringify(m.current[o])),r=[u.current,t]}return r},tt=function(r){var t,e,n,a=(t=u.current)===null||t===void 0||(e=t.attr("id"))===null||e===void 0?void 0:e.substring(6),c=(n=m.current)===null||n===void 0?void 0:n[a],o=c.attrs,i=c.shape_type;if(j.current=o,i==="polygon"||i==="line"){var l,s;j.current.boundRect=(l=u.current)===null||l===void 0||(s=l.node())===null||s===void 0?void 0:s.getBBox(),j.current.close=i==="polygon"}var v=sr(r),h=I()(v,2);j.current.mx=h[0],j.current.my=h[1]},dr=function(){var r=Object.keys(m.current),t=[],e=vr.current,n=e.x,a=e.y,c=e.scale;return r==null||r.forEach(function(o){var i=m.current[o],l=i.attrs,s=i.label,v=i.shape_type,h=i.hide,p=i.rotate,f={};if(f.label=s||o,f.shape_type=v,f.attrs={},f.hide=h||!1,f.id=o,p&&(f.rotate=p[0]),v==="rect")f.attrs.x=(l.x-n)*c,f.attrs.y=(l.y-a)*c,f.attrs.width=l.width*c,f.attrs.height=l.height*c;else if(v==="ellipse")f.attrs.cx=(l.cx-n)*c,f.attrs.cy=(l.cy-a)*c,f.attrs.rx=l.rx*c,f.attrs.ry=l.ry*c;else{var b;f.attrs.points=[],(b=l.points)===null||b===void 0||b.forEach(function(x,E){f.attrs.points[E]=[(x[0]-n)*c,(x[1]-a)*c]})}t.push(f)}),t},te=function(r){var t=(r==null?void 0:r.target)||(r==null?void 0:r.srcElement),e=w.Ys(t).attr("id"),n=null,a=d.current.drawTool;P.current||Y.current?n="crosshair":ur.current&&!W.current&&!F.current||a==="drag"?n="grab":e==="path-add-point"?n="pointer":u.current&&!V.current&&O.current===e||C.current&&C.current.includes(e==null?void 0:e.substring(6))?n="move":(!a||a==="move")&&(n="default"),w.Ys(z.current).style("cursor",n)},ee=function(r){d.current.showCrosshair&&(y.current.select("#crosshair-v-line").attr("x",r.layerX),y.current.select("#crosshair-h-line").attr("y",r.layerY))},et=function(r){var t=w.Ys("#shape-path-group #shape-path-".concat(r));if(t.node())t.attr("display","inline").attr("transform",null);else{t=w.Ys("#shape-path-group").append("path").attr("id","shape-path-".concat(r)).style("pointer-events","none");var e=J.line;Object.keys(e).forEach(function(n){t.attr(n,e[n])})}return t},Nr=function(){var r,t,e=(S==null||(r=S.current)===null||r===void 0?void 0:r.k)||1;(t=C.current)===null||t===void 0||t.forEach(function(n,a){var c,o=w.Ys("#shape-".concat(n)),i=o.node().getBBox(),l=i.x,s=i.y,v=i.width,h=i.height,p=et(a);l=l*e||0,s=s*e||0,v=v*e||0,h=h*e||0;var f=[[l-2,s-2],[l+v+2,s-2],[l+v+2,s+h+2],[l-2,s+h+2]],b=B.current(f);p.attr("d",b+"Z");var x=(c=m.current)===null||c===void 0?void 0:c[n],E=x.rotate;if(E){var R=I()(E,3),k=R[0],L=R[1],G=R[2],Z=L*e,Q=G*e;o.attr("transform","rotate(".concat(k," ").concat(L,",").concat(G,")")),p.attr("transform","rotate(".concat(k," ").concat(Z,",").concat(Q,")"))}})},hr=function(){var r,t,e;return(r=C.current)!==null&&r!==void 0&&r.length?C.current:u.current?[(t=u.current)===null||t===void 0||(e=t.attr("id"))===null||e===void 0?void 0:e.substring(6)]:[]},nt=function(r,t){var e,n,a,c=t,o=r,i="",l="";if(o instanceof Array)C.current=o,c=!0;else if(typeof o=="string")i="shape-"+o,o=y.current.select("#".concat(i));else{var s,v;i=(s=o)===null||s===void 0?void 0:s.attr("id"),l=(v=u.current)===null||v===void 0?void 0:v.attr("id")}if(c&&(l&&i!==l||C.current)){var h,p;if(u.current=null,i=(h=i)===null||h===void 0?void 0:h.substring(6),C.current)if(i){var b=C.current.indexOf(i);if(b>=0){var x;C.current.splice(b,1),(x=C.current)!==null&&x!==void 0&&x.length||(C.current=null)}else C.current.push(i);d.current.changeSelect(hr())}else d.current.changeSelect(hr());else{var f;l=(f=l)===null||f===void 0?void 0:f.substring(6),C.current=[i,l],d.current.changeSelect(hr())}(p=C.current)===null||p===void 0||p.forEach(function(Q,$){et($)}),rr(),Nr();return}u.current=o,(e=w.td_("#shape-path-group *"))===null||e===void 0||e.attr("display","none"),C.current=null;var E=(n=m.current)===null||n===void 0?void 0:n[(a=i)===null||a===void 0?void 0:a.substring(6)],R=E.shape_type,k=E.hide;if(O.current&&w.Ys("#"+O.current).attr("fill",J.shapeCommon.fill),O.current===i)O.current="",(R==="line"||R==="polygon")&&(M.current="",y.current.selectAll("#path-point-group circle,#path-add-point").attr("display","none"),kr());else if(O.current!==i)if(O.current=i,o.attr("fill",Gr(o.attr("stroke"))),R==="line"||R==="polygon"){var L;if(M.current=i,(L=y.current.selectAll("#path-point-group circle,#shape-grip-group"))===null||L===void 0||L.attr("display","none"),k){var G;(G=y.current.select("#path-add-point"))===null||G===void 0||G.attr("display","none")}else{var Z;(Z=y.current.select("#path-add-point"))===null||Z===void 0||Z.attr("display","inline"),Yr()}}else M.current="",y.current.selectAll("#path-point-group circle,#path-add-point").attr("display","none"),kr();d.current.changeSelect(hr())},Br=function(r){var t,e,n,a=r||u.current;if(a){rr();var c=(t=a.attr("id"))===null||t===void 0?void 0:t.substring(6),o=H.current.indexOf(c);H.current.splice(o,1),a==null||a.remove(),(e=y.current.select("#shape-label-".concat(c)))===null||e===void 0||e.attr("display","none"),u.current=null,q.current=null,(n=m.current)===null||n===void 0||delete n[c]}},at=function(){var r,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,e={};if(C.current){var n,a={};return(n=C.current)===null||n===void 0||n.forEach(function(o){var i=w.Ys("#shape-".concat(o));e[o]=JSON.parse(JSON.stringify(m.current[o])),a[o]=i,Br(i)}),t&&fr("del",C.current,e,a),C.current=null,d.current.changeSize(dr()),d.current.changeSelect(hr()),[e,a]}if(u.current){var c=(r=u.current.attr("id"))===null||r===void 0?void 0:r.substring(6);return e[c]=JSON.parse(JSON.stringify(m.current[c])),t&&fr("del",u.current,e),Br(),d.current.changeSize(dr()),d.current.changeSelect(hr()),[e]}},ne=function(){var r,t;if(!(!Y.current||!u.current)){var e=(r=u.current.attr("id"))===null||r===void 0?void 0:r.substring(6),n=((t=m.current)===null||t===void 0?void 0:t[e])||{},a=n.attrs.points,c=n.shape_type,o=a.length,i={};if(i[e]=JSON.parse(JSON.stringify(m.current[e])),o<=2){fr("del",u.current,i),Br(),rr();return}fr("edit",u.current,i),w.Ys("#path-point-group #path-point-".concat(o)).attr("display","none"),w.Ys("#path-point-group #path-point-".concat(Y.current)).attr("fill",J.point.fill),a.splice(Y.current-1,1),Y.current=null;var l=B.current(a);c==="polygon"&&(l+="Z"),u.current.attr("d",l),Dr(e,d.current.showLabel),Yr()}},St=function(r,t){var e=t.shape_type,n=t.attrs,a=t.rotate;if(e==="rect"||e==="ellipse"){var c=Object.keys(n);c==null||c.forEach(function(l){r.attr(l,n[l])})}else{var o=n.points,i=B.current(o);e==="polygon"&&(i+="Z"),r.attr("d",i)}a?r.attr("transform","rotate(".concat(a[0]," ").concat(a[1],",").concat(a[2],")")):r.attr("transform",null)},mt=function(r){var t=r||[],e=It()(t),n=e[0],a=e.slice(1),c=I()(a,3),o=c[0],i=c[1],l=c[2],s=[];if(n==="add")o instanceof Array?C.current=o:(C.current=null,u.current=o),s=at(!1);else if(n==="del"){if(o instanceof Array)o==null||o.forEach(function(R){var k;H.current.splice(R-1,0,+R),(k=y.current.select("#shape-label-".concat(R)))===null||k===void 0||k.attr("display","inline"),y.current.select("#shape").insert(function(){return l[R].node()})});else{var v,h,p=(v=Object.keys(i))===null||v===void 0?void 0:v[0];H.current.splice(p-1,0,p),(h=y.current.select("#shape-label-".concat(p)))===null||h===void 0||h.attr("display","inline"),y.current.select("#shape").insert(function(){return o.node()})}m.current=Object.assign({},m.current,i)}else if(n==="edit"){var f={};if(o instanceof Array)o==null||o.forEach(function(R){f[R]=JSON.parse(JSON.stringify(m.current[R])),St(l[R],i[R])}),s=[f,l];else{var b,x,E=(b=o.attr("id"))===null||b===void 0?void 0:b.substring(6);f[E]=JSON.parse(JSON.stringify(m.current[E])),St(o,(x=Object.values(i))===null||x===void 0?void 0:x[0]),s=[f]}m.current=Object.assign({},m.current,i)}return C.current=null,u.current=null,d.current.changeSize(dr()),d.current.changeSelect([]),rr(),rt(),n==="del"?[o]:[o].concat(nr()(s))},ae=function(){if(ir.current.length){var r=ir.current.pop(),t=r||[],e=I()(t,1),n=e[0],a=mt(r);if(n==="add"){cr.current.push(["del"].concat(nr()(a)));return}else n==="del"?cr.current.push(["add"].concat(nr()(a))):n==="edit"&&cr.current.push([n].concat(nr()(a)))}},ie=function(){if(cr.current.length){var r=cr.current.pop(),t=r||[],e=I()(t,1),n=e[0],a=mt(r);if(n==="add")ir.current.push(["del"].concat(nr()(a)));else if(n==="del"){ir.current.push(["add"].concat(nr()(a)));return}else n==="edit"&&ir.current.push([n].concat(nr()(a)))}},bt=function(r,t){var e,n=t||u.current;if(n){var a=d.current.showLabel,c=I()(r,2),o=c[0],i=c[1],l=n==null||(e=n.attr("id"))===null||e===void 0?void 0:e.substring(6),s=m.current[l],v=s.attrs,h=s.shape_type,p=s.rotate,f={};if(h==="rect"){var b=v.x,x=v.y,E=v.width,R=v.height;b+=o,x+=i,n.attr("x",b).attr("y",x),f={x:b,y:x,width:E,height:R}}else if(h==="ellipse"){var k=v.cx,L=v.cy,G=v.rx,Z=v.ry;k+=o,L+=i,n.attr("cx",k).attr("cy",L),f={cx:k,cy:L,rx:G,ry:Z}}else{for(var Q=v.points,$=h==="polygon",_=(Q==null?void 0:Q.length)||0,or=[],er=0;er<_;er++){var pr=I()(Q[er],2),Or=pr[0],wr=pr[1];Or+=o,wr+=i,or[er]=[Or,wr]}var Sr=B.current(or);n.attr("d",Sr+($?"Z":"")),f={points:or},or=null}if(p){var gr,lr=n==null||(gr=n.node())===null||gr===void 0?void 0:gr.getBBox(),jr=lr.x,Lr=lr.y,Ar=lr.width,Ir=lr.height,Mr=jr+Ar/2,Jr=Lr+Ir/2;m.current[l].rotate[1]=Mr,m.current[l].rotate[2]=Jr}m.current[l].attrs=f,C.current?Nr():h==="rect"||h==="ellipse"?kr():Yr(),Dr(l,a)}},Ur=function(r){if(C.current){var t;(t=C.current)===null||t===void 0||t.forEach(function(e){var n=w.Ys("#shape-".concat(e));bt(r,n)});return}bt(r)},Qr=function(r,t,e){var n=y.current.select("#shape-label-".concat(r)),a=d.current.showLabel;if(n.node()){n.text(t).attr("display","inline"),Dr(r,a,!0);return}var c=y.current.select("#shape-label-group").append("text").attr("id","shape-label-".concat(r)).style("user-select","none").text(t),o=Object.assign({},J.font);e&&(o["text-anchor"]="middle"),Object.keys(o).forEach(function(i){c.attr(i,o[i])}),Dr(r,a)},ce=function(r){var t,e;if(u.current){var n=(t=u.current)===null||t===void 0||(e=t.attr("id"))===null||e===void 0?void 0:e.substring(6),a=$r(n),c=a.centerX,o=a.centerY,i=a.gripCenterX,l=a.gripCenterY,s=r[0]-c,v=o-r[1],h=Math.atan2(v,s)*180/Math.PI;h<-90?h=-270-h:h=90-h,u.current.attr("transform","rotate(".concat(h," ").concat(c,",").concat(o,")")),w.Ys("#shape-grip-group").attr("transform","rotate(".concat(h," ").concat(i,",").concat(l,")")),m.current[n].rotate=[h,c,o]}},yr=function(r){for(var t=arguments.length,e=new Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];var a=e[0],c=e[1],o=sr(a),i=o[0]-j.current.mx,l=o[1]-j.current.my;if(r==="moveGrip"){var s,v,h,p="",f=(s=u.current)===null||s===void 0||(v=s.attr("id"))===null||v===void 0?void 0:v.substring(6),b=(h=m.current)===null||h===void 0?void 0:h[f],x=b.shape_type;P.current?p=P.current.substring(12):p=c.attr("id").substring(12);var E=Kt(x,W.current,p,i,l,j.current);if(x==="polygon"||x==="line"){var R=B.current(E.points);u.current.attr("d",R+(j.current.close?"Z":""))}else Object.keys(E).forEach(function(lr){u.current.attr(lr,E[lr])});m.current[f].attrs=E,kr(),Dr(f,d.current.showLabel);return}if(r==="moveShape"){Ur([a.dx,a.dy]);return}if(r==="moveWhole"){var k,L;S.current=S.current.translate(i,l),w.sPX().transform(y.current,S.current),y.current.selectAll("g.layer").attr("transform",S.current),y.current.selectAll("g#shape-related-group").attr("transform","translate(".concat((k=S.current)===null||k===void 0?void 0:k.x,",").concat((L=S.current)===null||L===void 0?void 0:L.y,")")),Kr();return}if(r==="movePoint"){var G,Z,Q,$="",_=(G=u.current)===null||G===void 0||(Z=G.attr("id"))===null||Z===void 0?void 0:Z.substring(6),or=m.current[_],er=or.attrs.points,pr=or.shape_type,Or=(S==null||(Q=S.current)===null||Q===void 0?void 0:Q.k)||1,wr=pr==="polygon";Y.current?$=Y.current:$=c.attr("id").substring(11);var Sr=er[$-1];Sr[0]=Sr[0]+a.dx/Or,Sr[1]=Sr[1]+a.dy/Or,er[$-1]=Sr,m.current[_].attrs={points:er};var gr=B.current(er);u.current.attr("d",gr+(wr?"Z":"")),Yr(),Dr(_,d.current.showLabel);return}if(r==="moveRotate"){ce(o);return}},oe=function(r){var t=(r==null?void 0:r.target)||(r==null?void 0:r.srcElement),e=w.Ys(t).attr("id"),n=q.current||[],a=n.length;if(w.td_("#path-point-group circle").attr("r",J.point.r),r.type==="touchstart"||r.type==="mouseenter"){if(V.current&&(e!=="path-point-1"||a<3))return;w.Ys("#".concat(e)).attr("r",6),w.Ys(t).style("cursor","pointer")}else w.Ys(t).style("cursor",null)},it=function(r,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=w.Ys("#path-point-group"),a=n.selectAll("circle"),c=a.size(),o=J.point;if(!c||c<=t){var i=n.append("circle").attr("id",r).call(Er("point",yr));return i.on("touchstart touchend mouseenter mouseleave",oe),Object.keys(o).forEach(function(l){i.attr(l,o[l])}),i.attr("display",e?"inline":"none"),i}return w.Ys("#"+r).attr("display",e?"inline":"none")},le=function(r){var t,e=sr(r),n=O.current.substring(6),a=(t=m.current)===null||t===void 0?void 0:t[n],c=a.attrs.points,o=a.shape_type,i=a.rotate,l=c.length,s=-1,v=1/0,h={};if(h[n]=JSON.parse(JSON.stringify(m.current[n])),fr("edit",u.current,h),i){var p=I()(i,3),f=p[0],b=p[1],x=p[2];e=ft.apply(void 0,nr()(e).concat([b,x,f,!0]))}for(var E=0;E<l;E++){var R=(E+1)%l,k=c[E],L=c[R],G=Ht(e,k,L);G<v&&(s=R,v=G)}c.splice(s,0,e);var Z=B.current(c);o==="polygon"&&(Z+="Z"),u.current.attr("d",Z);var Q=gt();Q&&Ur(Q);var $="path-point-".concat(l+1);it($,l),Yr()},wt=function(r){var t,e;(t=w.Ys("#path-stretch-line"))===null||t===void 0||t.attr("display","none");var n=u.current.attr("d");r&&u.current.attr("d",n+"Z");var a=(e=u.current.attr("id"))===null||e===void 0?void 0:e.substring("6"),c=d.current,o=c.curLabel,i=c.colorBindLabel;i&&o&&!D.current[o]&&(D.current[o]=J.shapeCommon.stroke,d.current.changeBindColor(D.current)),o=o||a,m.current[a]={shape_type:r?"polygon":"line",label:o,attrs:{points:q.current}},q.current=null,M.current="shape-".concat(a),O.current=M.current,w.Ys("#"+O.current).attr("fill",Gr(u.current.attr("stroke"))),d.current.changeSize(dr()),d.current.changeSelect(hr()),Qr(a,o,!0),y.current.select("#path-add-point").attr("display","inline"),yt(a),fr("add",u.current),d.current.endDraw({id:a,label:o})},ue=function(r,t,e,n){var a,c=(r==null?void 0:r.sourceEvent)||r,o=q.current||[],i=o==null?void 0:o.length;if(c.button===2){if(!i)return;i<2?Br():wt();return}if(e==="point"&&n.attr("id")==="path-point-1"&&i>=3){wt(!0);return}var l=w.Ys("#path-point-group").attr("transform",null),s=l.selectAll("circle"),v=s.size(),h=sr(r),p=I()(h,2),f=p[0],b=p[1],x=J.line;if(i){q.current.push([f,b]);var L=B.current(q.current);u.current.attr("d",L)}else{var E;V.current=!0,rr(),(E=w.Ys("#path-stretch-line"))===null||E===void 0||E.attr("display","inline"),Xr();var R=Object.assign({},J.shapeCommon,J[t]);u.current=A.current.select("#shape").append(t).call(Er("shape",yr));var k=Cr();u.current.attr("id","shape-".concat(k)),Object.keys(R).forEach(function(_){u.current.attr(_,R[_])}),q.current=[[f,b]]}v||(l.append("path").attr("id","path-stretch-line").style("pointer-events","none"),Object.keys(x).forEach(function(_){w.Ys("#path-stretch-line").attr(_,x[_])}));var G="path-point-".concat(i+1);it(G,i);var Z=(S==null||(a=S.current)===null||a===void 0?void 0:a.k)||1,Q=f*Z,$=b*Z;w.Ys("#"+G).attr("cx",Q).attr("cy",$),_r(r)},xt=function(r){te(r),ee(r),_r(r)},se=function(r,t,e){var n=d.current.drawTool;if(!(!n||t.defaultPrevented)){if(r==="grip"){var a=e.attr("id");P.current&&w.Ys("#"+P.current).attr("fill",J.grip.fill),P.current===a?P.current=null:(P.current=a,e.attr("fill","#ff0"),tt(t));return}if(P.current){var c=Hr();fr.apply(void 0,["edit"].concat(nr()(c))),c=null,yr("moveGrip",t,e),d.current.changeSize(dr());return}if(r==="point"){var o=e.attr("id").substring(11);Y.current&&w.Ys("#path-point-"+Y.current).attr("fill",J.point.fill),Y.current===o?Y.current=null:(Y.current=o,e.attr("fill","#ff0"),tt(t));return}if(Y.current){var i=Hr();fr.apply(void 0,["edit"].concat(nr()(i))),i=null,yr("movePoint",t,e),d.current.changeSize(dr());return}if(r==="insertPoint"){le(t);return}if(r==="shape"){var l;nt(e,W.current||(t==null||(l=t.sourceEvent)===null||l===void 0?void 0:l.shiftKey));return}if(r==="whole"){rr(),u.current=null,C.current=null,d.current.changeSelect([]);return}}},Ct=function(){if(!u.current||!X.current)return!1;X.current=!1,rr();var r=_t();if(r)return!1;var t=d.current,e=t.drawTool,n=t.curLabel,a=t.colorBindLabel,c=Cr();a&&n&&!D.current[n]&&(D.current[n]=J.shapeCommon.stroke,d.current.changeBindColor(D.current)),n=n||c,u.current.attr("id","shape-".concat(c)),m.current[c]={shape_type:e,label:n,attrs:q.current},q.current=null,kr(),d.current.changeSize(dr()),Qr(c,n,e==="ellipse"),fr("add",u.current),d.current.endDraw({id:c,label:n})},de=function(r){var t=sr(r);X.current=!0,u.current=null,rr();var e=I()(t,2);return j.current.x=e[0],j.current.y=e[1],w.Ys("#shape-selector").attr("display","inline").attr("x",t[0]).attr("y",t[1]).attr("width",0).attr("height",0),!1},ve=function(){var r,t=w.Ys("#shape-selector").node().getBoundingClientRect(),e=Object.keys(m.current),n=[],a=(S==null||(r=S.current)===null||r===void 0?void 0:r.k)||1;e==null||e.forEach(function(c){var o=w.Ys("#shape-".concat(c)),i=n.length,l=w.Ys("#shape-path-group #shape-path-".concat(i)),s=o.node().getBoundingClientRect(),v=s.bottom>t.top&&s.top<t.bottom&&s.left<t.right&&s.right>t.left;if(v){var h;n.push(c);var p=o.node().getBBox(),f=p.x,b=p.y,x=p.width,E=p.height;l.node()?l.attr("display","inline").attr("transform",null):l=et(i),f=f*a||0,b=b*a||0,x=x*a||0,E=E*a||0;var R=[[f-2,b-2],[f+x+2,b-2],[f+x+2,b+E+2],[f-2,b+E+2]],k=B.current(R);l.attr("d",k+"Z");var L=(h=m.current)===null||h===void 0?void 0:h[c],G=L.rotate;if(G){var Z=I()(G,3),Q=Z[0],$=Z[1],_=Z[2],or=$*a,er=_*a;l.attr("transform","rotate(".concat(Q," ").concat(or,",").concat(er,")"))}}else{var pr;(pr=l)===null||pr===void 0||pr.attr("display","none")}}),C.current=(n==null?void 0:n.length)&&n},fe=function(r){var t;if(!X.current)return!1;var e=sr(r),n=j.current,a=n.x,c=n.y,o=e[0]-a,i=e[1]-c,l=(S==null||(t=S.current)===null||t===void 0?void 0:t.k)||1,s=Math.abs(o),v=Math.abs(i);return o<0&&(a=e[0]),i<0&&(c=e[1]),a=a*l||0,c=c*l||0,s=s*l||0,v=v*l||0,w.Ys("#shape-related-group #shape-selector").attr("x",a).attr("y",c).attr("width",s).attr("height",v),ve(),!1},he=function(){if(!X.current)return!1;X.current=!1,w.td_("#shape-related-group #shape-selector").attr("display","none")},pe=function(r,t,e){var n;return r==="grip"?"moveGrip":r==="rotate"?"moveRotate":r==="point"&&!V.current?"movePoint":r==="insertPoint"?r:t==="drag"||ur.current&&!W.current&&!F.current?"moveWhole":r==="shape"&&!ur.current&&(t==="move"||O.current===e.attr("id")||C.current&&C.current.includes((n=e.attr("id"))===null||n===void 0?void 0:n.substring(6)))?"moveShape":r==="whole"&&t==="move"&&!ur.current&&!F.current?"selectShape":t==="rect"||t==="ellipse"?"shape":t},Er=function(r,t){var e="",n="",a=null,c=!1,o=null;return w.ohM().filter(function(i){return Pr(),e=d.current.drawTool,a=w.Ys(this),n=pe(r,e,a),e?!i.button||i.button===2&&V.current&&n==="path":!1}).on("start",function(i){var l,s;if(i==null||(l=i.sourceEvent)===null||l===void 0||l.stopPropagation(),i==null||(s=i.sourceEvent)===null||s===void 0||s.preventDefault(),U.current=!1,c=!1,!(P.current||Y.current)){if(n==="path"){C.current=null,ue(i,e,r,a);return}if(n==="moveShape"){var v,h,p=(v=a.attr("id"))===null||v===void 0?void 0:v.substring(6);if(!C.current&&O.current!==a.attr("id")||C.current&&!C.current.includes(p)){var f;c=!0,nt(a,W.current||(i==null||(f=i.sourceEvent)===null||f===void 0?void 0:f.shiftKey))}(F.current||i!=null&&(h=i.sourceEvent)!==null&&h!==void 0&&h.altKey)&&Ot()}else if(n.indexOf("move")>=0&&n.length>4){n==="moveWhole"?S.current=S.current||w.CRH:n==="moveGrip"&&tt(i);var b=sr(i),x=I()(b,2);j.current.mx=x[0],j.current.my=x[1]}n.indexOf("move")>=0&&n.length>4&&n!=="moveWhole"&&(o=Hr())}}).on("drag",function(i){var l,s;if(i==null||(l=i.sourceEvent)===null||l===void 0||l.stopPropagation(),i==null||(s=i.sourceEvent)===null||s===void 0||s.preventDefault(),i!=null&&i.sourceEvent&&xt(i.sourceEvent),!(P.current||Y.current||n==="path"||n==="insertPoint")&&!(i.dx===0&&i.dy===0)){if(U.current=!0,n.indexOf("move")>=0){t(n,i,a);return}if(n==="shape"){X.current?ye(i,e):(C.current=null,ge(i,e));return}n==="selectShape"&&(X.current?fe(i):de(i))}}).on("end",function(i){var l,s;if(i==null||(l=i.sourceEvent)===null||l===void 0||l.stopPropagation(),i==null||(s=i.sourceEvent)===null||s===void 0||s.preventDefault(),U.current){if(n==="shape"){Ct(),d.current.changeSelect(hr());return}else if(n==="selectShape"){he(),d.current.changeSelect(hr());return}else if(n!=="moveWhole"&&n.indexOf("move")>=0&&n.length>4){if(n==="moveGrip"||n==="movePoint"){var v=gt();v&&Ur(v)}d.current.changeSize(dr()),o&&fr.apply(void 0,["edit"].concat(nr()(o))),o=null}}else if(V.current&&n==="path")q.current||(V.current=!1);else if(!c){se(r,i,a);return}})},ct=function(r){var t,e="",n=e.drawTool;return w.sPX().scaleExtent((t=d.current)===null||t===void 0?void 0:t.scaleExtent).filter(function(a){return(!a.ctrlKey||a.type==="wheel")&&!a.button}).on("start",function(a){var c,o;n=d.current.drawTool,Pr(),a==null||(c=a.sourceEvent)===null||c===void 0||c.stopPropagation(),a==null||(o=a.sourceEvent)===null||o===void 0||o.preventDefault()}).on("zoom",function(a){var c,o;a==null||(c=a.sourceEvent)===null||c===void 0||c.stopPropagation(),a==null||(o=a.sourceEvent)===null||o===void 0||o.preventDefault(),n&&r&&r(a)}).on("end",function(a){var c,o;a==null||(c=a.sourceEvent)===null||c===void 0||c.stopPropagation(),a==null||(o=a.sourceEvent)===null||o===void 0||o.preventDefault()})},Et=function(r){var t,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;e&&(S.current=r.transform),y.current.selectAll("g.layer").attr("transform",S.current),y.current.selectAll("g#shape-related-group").attr("transform","translate(".concat(S.current.x,", ").concat(S.current.y,")")),(t=C.current)!==null&&t!==void 0&&t.length?Nr():(kr(),e?Yr(r):Yr()),rt(),Kr(),ar.current=S.current.k,d.current.changeScale(ar.current)},Rt=function(r){var t,e,n=!0,a=r;if(!a){var c;a=u.current,a.attr("fill",J.shapeCommon.fill),n=!1,(c=y.current.select("#path-add-point"))===null||c===void 0||c.attr("display","inline")}var o=(t=a.attr("id"))===null||t===void 0?void 0:t.substring(6),i=m.current[o],l=i.label,s=i.shape_type,v=a.clone(),h=Cr();return v=A.current.select("#shape").append(function(){return v.node()}).attr("id","shape-".concat(h)).call(Er("shape",yr)),m.current[h]=JSON.parse(JSON.stringify((e=m.current)===null||e===void 0?void 0:e[o])),Qr(h,l,s!=="rect"),n?""+h:(v.attr("fill",Gr(v.attr("stroke"))),O.current="shape-".concat(h),v)},Ot=function(){if(C.current){var r,t=[];(r=C.current)===null||r===void 0||r.forEach(function(e){var n=w.Ys("#shape-".concat(e));t.push(Rt(n))}),C.current=t,d.current.changeSelect(hr()),fr("add",C.current);return}u.current&&(u.current=Rt(),d.current.changeSelect(hr()),fr("add",u.current))},ge=function(r,t){var e=sr(r);X.current=!0,u.current=A.current.select("#shape").append(t).call(Er("shape",yr)),Xr();var n=Object.assign({},J.shapeCommon,J[t]),a="x",c="y";t==="ellipse"&&(a="cx",c="cy");var o=I()(e,2);j.current.x=o[0],j.current.y=o[1];var i=I()(e,2);return n[a]=i[0],n[c]=i[1],Object.keys(n).forEach(function(l){u.current.attr(l,n[l])}),!1},ye=function(r,t){if(!u.current||!X.current)return!1;var e=sr(r),n=j.current,a=n.x,c=n.y,o=e[0]-a,i=e[1]-c;if(t==="rect"){var l=Math.abs(o),s=Math.abs(i);return o<0&&(W.current&&l<s?a=a-s:a=e[0]),i<0&&(W.current&&l>s?c=c-l:c=e[1]),W.current&&(l>s?s=l:l=s),q.current={x:a,y:c,width:l,height:s},u.current.attr("x",a).attr("y",c).attr("width",l).attr("height",s),!1}if(t==="ellipse"){var v=o/2||0,h=i/2||0,p=Math.abs(v),f=Math.abs(h);W.current&&(p>f?(h=h>0?p:-p,f=p):(v=v>0?f:-f,p=f)),a=a+v,c=c+h,q.current={cx:a,cy:c,rx:p,ry:f},u.current.attr("cx",a).attr("cy",c).attr("rx",p).attr("ry",f)}return!1},Se=function(r){if(r!=="path"&&V.current){Br(),V.current=!1;return}},me=function(){if(X.current){Ct();return}},be=function(r){ur.current=r.ctrlKey,F.current=r.altKey,W.current=r.shiftKey;var t=r.keyCode||r.which||r.charCode;if(V.current){t===27&&Br();return}if(t===8||t===46){Y.current?(ne(),d.current.changeSize(dr())):at();return}if(ur.current&&t===67){var e;br.current=C.current&&nr()(C.current)||((e=u.current)===null||e===void 0?void 0:e.attr("id"))||null}if(ur.current&&t===86){if(!br.current)return;rr();var n=zt()(br.current)==="object";n?C.current=nr()(br.current):u.current=w.Ys("#".concat(br.current)),Ot(),n?Nr():["rect","ellipse"].includes(m.current[br.current.substring(6)].shape_type)?kr():Yr(),d.current.changeSize(dr())}if([37,38,39,40].includes(t)){var a=0,c=0;t===37?a=-1:t===38?c=-1:t===39?a=1:t===40&&(c=1);var o=Hr();fr.apply(void 0,["edit"].concat(nr()(o))),o=null,Ur([a,c])}},we=function(r){ur.current=r.ctrlKey,F.current=r.altKey,W.current=r.shiftKey},Yt=function(r){r?w.Ys("body").on("keyup",we):(w.Ys("body").on("keyup",null),ur.current=!1,F.current=!1,W.current=!1,me())},xe=function(){var r;(r=w.Ys(z.current).select("div>svg"))===null||r===void 0||r.remove(),y.current=w.Ys(z.current).selectChild("div").append("svg").attr("id","svgroot");var t=y.current.append("defs"),e=t.append("pattern").attr("id","gridPattern").attr("patternUnits","userSpaceOnUse").attr("x",0).attr("y",0).attr("width","10").attr("height","10"),n=e.append("rect");n.attr("fill","none").attr("stroke","#787878").attr("stroke-width","0.5").attr("x",0).attr("y",0).attr("width","100%").attr("height","100%"),A.current=y.current.append("svg").attr("id","svgcont"),A.current.append("g").attr("class","layer").attr("id","img").style("pointer-events","none"),A.current.append("g").attr("class","layer").attr("id","shape");var a=y.current.append("g").attr("id","shape-related-group"),c=a.append("rect").attr("id","shape-selector").attr("display","none").style("pointer-events","none"),o=Object.assign({},J.rect,J.selectBox);Object.keys(o).forEach(function(L){c.attr(L,o[L])});var i=a.append("path").attr("id","path-add-point").attr("display","none"),l=J.pathAddPoint;Object.keys(l).forEach(function(L){i.attr(L,l[L])});var s=a.append("g").attr("class","grip-layer").attr("id","shape-grip-group").attr("display","none"),v=s.append("path").attr("id","resize-path").style("pointer-events","none"),h=J.line;Object.keys(h).forEach(function(L){v.attr(L,h[L])});for(var p=0;p<8;p++)s.append("rect").attr("id","resize-grip-"+vt[p]).style("cursor",vt[p]+"-resize");var f=J.grip;if(Object.keys(f).forEach(function(L){w.td_("#shape-grip-group rect").attr(L,f[L])}),d.current.rotateEnable){var b=s.append("line").attr("id","rotate-line").style("pointer-events","none"),x=J.rotateLine;Object.keys(x).forEach(function(L){b.attr(L,x[L])});var E=s.append("circle").attr("id","rotate-circle").attr("class","w-svg-rotate"),R=J.rotateCircle;Object.keys(R).forEach(function(L){E.attr(L,R[L])})}a.append("g").attr("class","point_layer").attr("id","path-point-group"),a.append("g").attr("class","path_layer").attr("id","shape-path-group").style("pointer-events","none"),a.append("g").attr("class","label_layer").attr("id","shape-label-group").attr("display","none").style("pointer-events","none"),a.append("rect").attr("id","grid").attr("display","none").style("pointer-events","none").attr("x",0).attr("y",0).attr("width","0").attr("height","0").attr("fill","url(#gridPattern)").attr("stroke","none");var k=y.current.append("g").attr("class","crosshair_layer").style("pointer-events","none").attr("display","none");k.append("rect").attr("id","crosshair-v-line").attr("width",.5).attr("height","100%"),k.append("rect").attr("id","crosshair-h-line").attr("width","100%").attr("height",.5),k.selectAll("rect").attr("x",0).attr("y",0).attr("fill","#00f").attr("stroke","none")},Fr=function(){var r=z.current.getBoundingClientRect(),t=r.right-r.left||J.svg.width,e=r.bottom-r.top||J.svg.height,n=[t,e];J.svg.width=n[0],J.svg.height=n[1],w.Ys("#svgcanvas").style("width",t+"px").style("height",e+"px"),w.td_("#svgroot,#svgcont").attr("width",t).attr("height",e)},Ce=function(){y.current.on("mousemove touchmove",xt).call(Er("whole",yr)).call(ct(function(r){Et(r)})).on("dblclick.zoom",null),w.td_("#shape-grip-group rect").call(Er("grip",yr)),d.current.rotateEnable&&w.Ys("#shape-grip-group circle").call(Er("rotate",yr)),y.current.select("#path-add-point").call(Er("insertPoint",yr))},Ee=function(){B.current=w.jvg(),xe(),Fr(),Ce(),ot(d.current.showCrosshair)},Lt=function(){y.current.selectAll("g.layer,g#shape-related-group").attr("transform",null),S.current=null,y.current.call(ct().transform,w.CRH),d.current.changeScale("1")},Pt=function(){var r,t,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;ir.current=[],cr.current=[],rr(),u.current&&(u.current=null),C.current&&(C.current=null),m.current={},e&&d.current.changeSize(dr()),H.current=[],d.current.changeSelect([]),(r=y.current.selectAll("#shape *"))===null||r===void 0||r.remove(),(t=y.current.selectAll("#shape-label-group *"))===null||t===void 0||t.attr("display","none")},Re=function(){var r,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(r=A.current.select("g#img").select("image"))===null||r===void 0||r.remove(),Pt(t),Lt()},Oe=function(r){var t,e,n=m.current[r].hide,a=(t=u.current)===null||t===void 0||(e=t.attr("id"))===null||e===void 0?void 0:e.substring(6);if(n=!n,m.current[r].hide=n,y.current.selectAll("g#shape #shape-".concat(r,",#shape-label-").concat(r)).attr("display",n?"none":"inline"),C.current&&C.current.includes(r)){var c,o=C.current.indexOf(r);if(C.current.splice(o,1),!((c=C.current)!==null&&c!==void 0&&c.length))C.current=null,w.td_("#shape-path-group *").attr("display","none"),d.current.changeSelect([]);else{var i;(i=w.Ys("#shape-path-".concat(C.current.length)))===null||i===void 0||i.attr("display","none"),Nr(),d.current.changeSelect(hr())}}else a&&a===r&&(rr(),u.current=null,d.current.changeSelect([]));d.current.changeSize(dr())},kt=function(r){return r?(Fr(),new Promise(function(t){var e=new Image;e.onload=function(n){var a,c,o=n.target.width,i=n.target.height,l=o,s=i,v=0,h=0,p=1,f=J.svg,b=f.width,x=f.height,E=b/x,R=o/i;E>R?(s=x,l=s*R,p=i/s):(l=b,s=l/R,p=o/l),v=(b-l)/2,h=(x-s)/2,vr.current={x:v,y:h,scale:p,w:l,h:s},(a=A.current.select("g#img").select("image"))===null||a===void 0||a.remove(),(c=A.current.select("g#img").append("image").attr("width",l).attr("height",s).attr("x",v).attr("y",h).attr("xlink:href",r).attr("draggable","false"))===null||c===void 0||c.style("filter",Rr.current),Kr(),d.current.imgLoaded({width:o,height:i}),t(!0)},e.onerror=function(){d.current.imgLoaded(!1),t(!1)},e.src=r})):!1},Ye=function(r){if(r){var t=Object.keys(m.current);t==null||t.forEach(function(e){var n=y.current.select("#shape-".concat(e));y.current.select("#shape-label-".concat(e)).attr("fill",n.attr("stroke"))})}},Le=function(r){y.current.select("#grid").attr("display",r&&(!S.current||S.current.k>=1)?"inline":"none"),Kr(!0)},ot=function(r){y.current.select(".crosshair_layer").attr("display",r&&N.drawTool!=="move"&&N.drawTool!=="drag"?"inline":"none")},Pe=function(r){var t;Rr.current=r,(t=A.current.select("#img image"))===null||t===void 0||t.style("filter",r)},ke=function(r){y.current.select("#shape-label-group").attr("display",r?"inline":"none"),rt(!0),Ye(r)},De=function(r,t){if(m.current[r]){m.current[r].label=t,y.current.select("#shape-label-".concat(r)).text(t),d.current.changeSize(dr());var e=d.current,n=e.colorBindLabel,a=e.curLabel;if(n){var c="",o=D.current[t];a?c=D.current[t]||dt(D.current):c=J.shapeCommon.stroke,Zr(r,c),o||(D.current[t]=c,d.current.changeBindColor(D.current))}}},je=function(r){var t=+ar.current,e=0,n=d.current.scaleExtent;isNaN(r)?r==="enlarge"?(e=(n[1]-t)/20,e=e>.1?e:.2,t=t+e):r==="narrow"&&(e=(t-n[0])/5,t=t-e):t=+r,t=t<n[0]?n[0]:t,t=t>n[1]?n[1]:t,ct().scaleTo(y.current,t),S.current=w.P2S(y.current.node()),Et(S.current,!1)},Ae=function(r){if(!r||!(r!=null&&r.length))return[];var t=[];try{t=r.map(function(e){var n;if(!(e!=null&&e.attrs))return e;var a=e.attrs,c=e.shape_type,o=st()(e,Qt);if(c.indexOf("rect")>=0){var i=a,l=i.x,s=i.y,v=i.width,h=i.height;return a=[[l,s],[l+v,s+h]],mr()({points:a,shape_type:"rectangle"},o)}else if(c==="ellipse"){var p=a,f=p.cx,b=p.cy,x=p.rx,E=p.ry;return x===E?(a=[[f,b],[f,b+E]],mr()({points:a,shape_type:"circle"},o)):(a=[[f,b],[f,b+E],[f+x,b]],mr()({points:a,shape_type:"ellipse"},o))}return mr()({points:(n=a)===null||n===void 0?void 0:n.points,shape_type:c},o)})}catch(e){console.error(e.toString())}return t},Be=function(r){if(!r||!(r!=null&&r.length))return[];var t=[];try{t=r.map(function(e,n){var a;if(e=mr()(mr()({},e),{},{id:"".concat(n+1)}),(a=e)!==null&&a!==void 0&&a.attrs)return e;var c=e,o=c.points,i=c.shape_type,l=st()(c,Vt);if(i.indexOf("rect")>=0){var s=o,v=I()(s,2),h=I()(v[0],2),p=h[0],f=h[1],b=I()(v[1],2),x=b[0],E=b[1],R=Math.abs(x-p),k=Math.abs(E-f),L=p,G=f;return L>x&&(L=x),G>E&&(G=E),o={x:L,y:G,width:R,height:k},mr()({attrs:o,shape_type:"rect"},l)}else if(i==="circle"){var Z=o,Q=I()(Z,2),$=I()(Q[0],2),_=$[0],or=$[1],er=I()(Q[1],2),pr=er[0],Or=er[1],wr=Math.sqrt(Math.pow(pr-_,2)+Math.pow(Or-or,2));return o={cx:_,cy:or,rx:wr,ry:wr},mr()({attrs:o,shape_type:"ellipse"},l)}else if(i==="ellipse"){var Sr=o,gr=I()(Sr,3),lr=I()(gr[0],2),jr=lr[0],Lr=lr[1],Ar=I()(gr[1],2),Ir=Ar[1],Mr=I()(gr[2],1),Jr=Mr[0],Vr=Ir-Lr,qr=Jr-jr;return o={cx:jr,cy:Lr,rx:qr,ry:Vr},mr()({attrs:o,shape_type:"ellipse"},l)}else if(i==="polygon")return mr()({attrs:{points:o},shape_type:i},l);return mr()({attrs:{points:o},shape_type:"line"},l)})}catch(e){console.error(e.toString())}return t},Me=function(r,t,e,n,a,c){H.current.push(r),m.current[r]={label:e,shape_type:t,hide:n,attrs:a,rotate:c},e&&Qr(r,e,t!=="rect"),y.current.selectAll("g#shape #shape-".concat(r,",#shape-label-").concat(r)).attr("display",n?"none":"inline")},Je=function(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!(!r||!(r!=null&&r.length)))try{var e=vr.current,n=e.x,a=e.y,c=e.scale,o=A.current.select("#shape");r.forEach(function(i){var l=i.attrs,s=i.id,v=i.hide,h=i.label,p=i.shape_type,f=i.rotate,b=null,x=null,E=null;if(p==="rect"||p==="ellipse"){var R,k=zr(p),L=l[k.x],G=l[k.y],Z=l[k.w],Q=l[k.h];if(!+Z||!+Q)return;s||(s=Cr()),b=o.append(p).attr("id","shape-".concat(s)).call(Er("shape",yr)),Xr(h);var $=Object.assign({},J.shapeCommon,J[p]);if(Object.keys($).forEach(function(Tr){b.attr(Tr,$[Tr])}),L=+L/c+n,G=+G/c+a,Z=Z/c,Q=Q/c,b.attr(k.x,L).attr(k.y,G).attr(k.w,Z).attr(k.h,Q),x=(R={},Wr()(R,k.x,L),Wr()(R,k.y,G),Wr()(R,k.w,Z),Wr()(R,k.h,Q),R),f){var _=$r(s),or=_.centerX,er=_.centerY;E=[f,or,er],b.attr("transform","rotate(".concat(f," ").concat(or,",").concat(er,")"))}}else{s||(s=Cr()),Xr(h);var pr=l.points,Or=pr.length,wr=o.append("path").attr("id","shape-".concat(s)).call(Er("shape",yr)),Sr=Object.assign({},J.shapeCommon,J.path),gr=[];Object.keys(Sr).forEach(function(Tr){wr.attr(Tr,Sr[Tr])});for(var lr=0;lr<Or;lr++){var jr=I()(pr[lr],2),Lr=jr[0],Ar=jr[1];Lr=+Lr/c+n,Ar=+Ar/c+a,gr[lr]=[Lr,Ar];var Ir="path-point-".concat(lr+1);it(Ir,lr,!1)}var Mr=B.current(gr);if(p==="polygon"&&(Mr+="Z"),wr.attr("d",Mr),x={points:gr},f){var Jr=$r(s),Vr=Jr.centerX,qr=Jr.centerY;E=[f,Vr,qr],wr.attr("transform","rotate(".concat(f," ").concat(Vr,",").concat(qr,")"))}}i.id=s,Me(s,p,h,v,x,E)}),d.current.changeBindColor(D.current),t&&d.current.changeSize(r)}catch(i){console.error(i.toString())}},ze=function(){return ir.current.length>0},Ne=function(){return cr.current.length>0},Fe=function(r){r&&!z.current&&(z.current=r)};return(0,T.useEffect)(function(){return z.current&&(Ee(),window.addEventListener("resize",Fr)),function(){w.Ys("body").on("keyup",null),window.removeEventListener("resize",Fr)}},[]),(0,T.useEffect)(function(){N.src!==d.current.src&&kt(N.src),N.drawTool!==d.current.drawTool&&(Se(N.drawTool),ot(N.showCrosshair)),N.showLabel!==d.current.showLabel&&ke(N.showLabel),N.showGrid!==d.current.showGrid&&Le(N.showGrid),N.showCrosshair!==d.current.showCrosshair&&ot(N.showCrosshair),d.current=N},[N]),(0,T.useImperativeHandle)(K,function(){return{reload:Re,zoomReload:Lt,loadImg:kt,clearShape:Pt,toggleShape:Oe,getMarkData:dr,selectShape:nt,delSelectShape:at,getSelectIds:hr,editLabel:De,adjustImg:Pe,undoSvg:ae,canUndo:ze,redoSvg:ie,canRedo:Ne,changeScale:je,changeColor:re,drawShapeFromSize:Je,setCanvasSize:Fr,convertToPoints:Ae,convertToAttrs:Be}}),(0,xr.jsxs)("div",{ref:Fe,className:"w-draw-container ".concat(d.current.className||""),onKeyDown:be,children:[(0,xr.jsx)("div",{id:"svgcanvas",className:"w-svg-box",tabIndex:-1,onFocus:function(){return Yt(!0)},onBlur:function(){return Yt(!1)}}),N==null?void 0:N.children]})});ht.defaultProps={src:"",curLabel:"",showLabel:!1,showGrid:!1,showCrosshair:!1,minSize:[4,4],drawTool:"",scaleExtent:[.02,30],colorBindLabel:!0,rotateEnable:!1,changeSize:function(){},changeBindColor:function(){},changeSelect:function(){},changeScale:function(){},imgLoaded:function(){},endDraw:function(){}};var qt=ht,pt=function(K){var d=K.shapeList,z=K.selectShapeIds,y=K.delFunc,A=K.selectFunc,u=K.leftRender,O=K.rightRender,M=K.topRender,P=K.title,Y=K.className,B=(0,T.useRef)(null),S=(0,T.useState)([]),j=I()(S,2),X=j[0],V=j[1],U=(0,T.useRef)(-1),H=(0,T.useRef)(-1);(0,T.useEffect)(function(){V(z)},[z]);var ar=function(){H.current=-1,U.current=-1;var F=d.length,m=z==null?void 0:z.length;if(!(!F||!m)){var q=nr()(z);q.sort(function(cr,rr){return cr-rr});for(var D=0;D<F;D++){var ir=d[D].id;ir===q[0]&&(U.current=D),ir===q[m-1]&&(H.current=D)}}},vr=function(F){F?(B.current.classList.add("box-active"),ar()):B.current.classList.remove("box-active")},C=function(F){A&&(F.length===1?A(F[0]):A(F))},br=function(F){var m=F.keyCode||F.which||F.charCode;if(m===8||m===46){F==null||F.stopPropagation(),y&&y();return}if(F.ctrlKey&&m===65){F==null||F.stopPropagation();var q=d==null?void 0:d.map(function(rr){return rr==null?void 0:rr.id});V(nr()(q)),C(q),H.current=d.length-1,U.current=0;return}var D=-1,ir=d.length-1;if(m===38&&(U.current>0||X.length>1)?(D=U.current-1,D=D<0?0:D):m===40&&(H.current<ir||X.length>1)&&(D=H.current+1,D=D>ir?ir:D),D!==-1){var cr;F==null||F.stopPropagation(),X=[(cr=d[D])===null||cr===void 0?void 0:cr.id],V(X),C(X),H.current=D,U.current=D}},Rr=function(F,m,q){q.stopPropagation();var D=nr()(X),ir=D.indexOf(F);if(q.shiftKey){m<=U.current?U.current=m:H.current=m,U.current=U.current<0?0:U.current,D=[];for(var cr=U.current;cr<=H.current;cr++){var rr;D.push((rr=d[cr])===null||rr===void 0?void 0:rr.id)}}else if(q.ctrlKey)if(ir>=0){if(D.length===1)U.current=-1,H.current=-1;else if(m===U.current)for(var Pr=U.current+1;Pr<=H.current;Pr++){var sr;if(D.includes((sr=d[Pr])===null||sr===void 0?void 0:sr.id)){U.current=Pr;break}}else if(m===H.current)for(var Cr=H.current-1;Cr>=U.current;Cr--){var zr;if(D.includes((zr=d[Cr])===null||zr===void 0?void 0:zr.id)){H.current=Cr;break}}D.splice(ir,1)}else D.push(F),m<U.current&&(U.current=m),m>H.current&&(H.current=m);else D=[F],H.current=m,U.current=m;V(D),C(D)},ur=function(){X.length&&(V([]),C([]),H.current=-1,U.current=-1)};return(0,xr.jsxs)("div",{className:"win-box ".concat(Y),children:[(0,xr.jsxs)("div",{className:"w-head",children:[P||"\u56FE\u5F62\u5217\u8868",(0,xr.jsx)("div",{className:"flex-center",children:M&&M()})]}),(0,xr.jsx)("div",{className:"w-box w-box-overflow",ref:B,tabIndex:-1,onFocus:function(){return vr(!0)},onBlur:function(){return vr(!1)},onClick:ur,onKeyDown:br,children:d&&d.map(function(W,F){var m=W==null?void 0:W.id;return(0,xr.jsxs)("div",{className:"list-item ".concat(X.includes(m)?"on":""),onClick:function(D){return Rr(m,F,D)},children:[u&&u(W,F),(0,xr.jsx)("p",{className:"list-txt",title:W==null?void 0:W.label,children:W==null?void 0:W.label}),O&&O(W,F)]},F)})})]})};pt.defaultProps={className:"",title:"",shapeList:[],selectShapeIds:[],leftRender:null,rightRender:null,topRender:null,delFunc:function(){},selectFunc:function(){}};var $t=pt}}]);
