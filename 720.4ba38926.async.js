"use strict";(self.webpackChunkw_react_label=self.webpackChunkw_react_label||[]).push([[720],{52720:function(We,st,ar){ar.r(st),ar.d(st,{WColorBlock:function(){return Bt},WDraw:function(){return $t},WShapeList:function(){return _t}});var jt=ar(5574),J=ar.n(jt),I=ar(67294),Cr=ar(85893),dt=function(K){var f=K.colorBlocks,N=(0,I.useState)(f[0]),g=J()(N,2),j=g[0],u=g[1];(0,I.useEffect)(function(){K.color&&u(K.color)},[]);var O=function(Y,L){u(Y),K.onChange&&K.onChange(Y,L)};return(0,Cr.jsx)("div",{className:"w-color-block-box",children:f.map(function(A,Y){return(0,Cr.jsx)("div",{onClick:function(B){return O(A,B)},className:"w-color-block ".concat(A===j?"on":""),style:{background:A}},Y)})})};dt.defaultProps={color:"",colorBlocks:["#f00","#FFA500","#ff0","#0f0","#0ff","#00f","#800080","#fff"],onChange:function(){}};var Bt=dt,At=ar(9783),Tr=ar.n(At),zt=ar(97857),br=ar.n(zt),Mt=ar(13769),vt=ar.n(Mt),Jt=ar(52677),Nt=ar.n(Jt),Ft=ar(61227),It=ar.n(Ft),Wt=ar(19632),tr=ar.n(Wt),x=ar(46886),z={color:["#CB3D45","#DA833C","#2378DE"],svg:{width:800,height:600},shapeCommon:{fill:"rgba(0, 0, 0, 0)",stroke:"#CB3D45","stroke-width":2,"vector-effect":"non-scaling-stroke"},rect:{x:0,y:0,width:0,height:0},selectBox:{"stroke-width":1,fill:"rgb(34 34 204 / 12%)",stroke:"rgb(34 34 204 / 45%)","vector-effect":"non-scaling-stroke"},ellipse:{cx:0,cy:0,rx:0,ry:0},path:{d:""},line:{d:"",fill:"none",stroke:"#00f","stroke-width":1},point:{cx:0,cy:0,r:4,fill:"rgba(0,0,255,.45)",stroke:"rgba(0, 0, 0, 0)","stroke-width":10},grip:{width:8,height:8,fill:"rgba(0,0,255,.45)",stroke:"rgba(0, 0, 0, 0)","stroke-width":10},font:{x:0,y:0,fill:"#CB3D45",stroke:"none","font-size":16,"text-anchor":"start","dominant-baseline":"text-after-edge"},pathAddPoint:{fill:"none",stroke:"rgba(0,0,0,0)","stroke-width":25},rotateLine:{x1:0,y1:0,x2:0,y2:0,stroke:"rgba(0,0,255,.45)","stroke-width":1},rotateCircle:{cx:0,cy:0,r:5,fill:"rgba(0,0,255,.45)",stroke:"rgba(0, 0, 0, 0)","stroke-width":6}},Tt=["128, 0, 0","0, 128, 0","128, 128, 0","0, 0, 128","128, 0, 128","0, 128, 128","128, 128, 128","64, 0, 0","192, 0, 0","64, 128, 0","192, 128, 0","64, 0, 128","192, 0, 128","64, 128, 128","192, 128, 128","0, 64, 0","128, 64, 0","0, 192, 0","128, 192, 0","0, 64, 128","128, 64, 128","0, 192, 128","128, 192, 128","64, 64, 0","192, 64, 0","64, 192, 0","192, 192, 0","64, 64, 128","192, 64, 128","64, 192, 128","192, 192, 128","0, 0, 64","128, 0, 64","0, 128, 64","128, 128, 64","0, 0, 192","128, 0, 192","0, 128, 192","128, 128, 192","64, 0, 64","192, 0, 64","64, 128, 64","192, 128, 64","64, 0, 192","192, 0, 192","64, 128, 192","192, 128, 192","0, 64, 64","128, 64, 64","0, 192, 64","128, 192, 64","0, 64, 192","128, 64, 192","0, 192, 192","128, 192, 192","64, 64, 64","192, 64, 64","64, 192, 64","192, 192, 64","64, 64, 192","192, 64, 192","64, 192, 192","192, 192, 192","32, 0, 0","160, 0, 0","32, 128, 0","160, 128, 0","32, 0, 128","160, 0, 128","32, 128, 128","160, 128, 128","96, 0, 0","224, 0, 0","96, 128, 0","224, 128, 0","96, 0, 128","224, 0, 128","96, 128, 128","224, 128, 128","32, 64, 0","160, 64, 0","32, 192, 0","160, 192, 0","32, 64, 128","160, 64, 128","32, 192, 128","160, 192, 128","96, 64, 0","224, 64, 0","96, 192, 0","224, 192, 0","96, 64, 128","224, 64, 128","96, 192, 128","224, 192, 128","32, 0, 64","160, 0, 64","32, 128, 64","160, 128, 64","32, 0, 192","160, 0, 192","32, 128, 192","160, 128, 192","96, 0, 64","224, 0, 64","96, 128, 64","224, 128, 64","96, 0, 192","224, 0, 192","96, 128, 192","224, 128, 192","32, 64, 64","160, 64, 64","32, 192, 64","160, 192, 64","32, 64, 192","160, 64, 192","32, 192, 192","160, 192, 192","96, 64, 64","224, 64, 64","96, 192, 64","224, 192, 64","96, 64, 192","224, 64, 192","96, 192, 192","224, 192, 192","0, 32, 0","128, 32, 0","0, 160, 0","128, 160, 0","0, 32, 128","128, 32, 128","0, 160, 128","128, 160, 128","64, 32, 0","192, 32, 0","64, 160, 0","192, 160, 0","64, 32, 128","192, 32, 128","64, 160, 128","192, 160, 128","0, 96, 0","128, 96, 0","0, 224, 0","128, 224, 0","0, 96, 128","128, 96, 128","0, 224, 128","128, 224, 128","64, 96, 0","192, 96, 0","64, 224, 0","192, 224, 0","64, 96, 128","192, 96, 128","64, 224, 128","192, 224, 128","0, 32, 64","128, 32, 64","0, 160, 64","128, 160, 64","0, 32, 192","128, 32, 192","0, 160, 192","128, 160, 192","64, 32, 64","192, 32, 64","64, 160, 64","192, 160, 64","64, 32, 192","192, 32, 192","64, 160, 192","192, 160, 192","0, 96, 64","128, 96, 64","0, 224, 64","128, 224, 64","0, 96, 192","128, 96, 192","0, 224, 192","128, 224, 192","64, 96, 64","192, 96, 64","64, 224, 64","192, 224, 64","64, 96, 192","192, 96, 192","64, 224, 192","192, 224, 192","32, 32, 0","160, 32, 0","32, 160, 0","160, 160, 0","32, 32, 128","160, 32, 128","32, 160, 128","160, 160, 128","96, 32, 0","224, 32, 0","96, 160, 0","224, 160, 0","96, 32, 128","224, 32, 128","96, 160, 128","224, 160, 128","32, 96, 0","160, 96, 0","32, 224, 0","160, 224, 0","32, 96, 128","160, 96, 128","32, 224, 128","160, 224, 128","96, 96, 0","224, 96, 0","96, 224, 0","224, 224, 0","96, 96, 128","224, 96, 128","96, 224, 128","224, 224, 128","32, 32, 64","160, 32, 64","32, 160, 64","160, 160, 64","32, 32, 192","160, 32, 192","32, 160, 192","160, 160, 192","96, 32, 64","224, 32, 64","96, 160, 64","224, 160, 64","96, 32, 192","224, 32, 192","96, 160, 192","224, 160, 192","32, 96, 64","160, 96, 64","32, 224, 64","160, 224, 64","32, 96, 192","160, 96, 192","32, 224, 192","160, 224, 192","96, 96, 64","224, 96, 64","96, 224, 64","224, 224, 64","96, 96, 192","224, 96, 192","96, 224, 192","224, 224, 192","0,0,0"],ft=function(K){var f=Object.keys(K).length;return"rgb("+Tt[f]+")"},ht=["n","ne","e","se","s","sw","w","nw"],Kt=function(K){return!!(K.touches&&K.touches.length)},Gt=function(K,f){for(var N=arguments.length,g=new Array(N>2?N-2:0),j=2;j<N;j++)g[j-2]=arguments[j];var u={},O=g[0],A=g[1],Y=g[2],L=g[3];if(K==="rect"){if(u=Xt.apply(void 0,g),f){var B=L.width,m=L.height,k=u.width-u.height,Z=O.indexOf("n")>=0&&Y<=m||O.indexOf("s")>=0&&Y<=-m,Q=O.indexOf("e")>=0&&A<=-B||O.indexOf("w")>=0&&A<=B;k>0?(Z&&(u.y=u.y-k),u.height=u.width):(Q&&(u.x=u.x+k),u.width=u.height)}}else if(K==="ellipse"){if(u=Zt.apply(void 0,g),f){var U=L.rx,H=L.ry,ir=u.rx-u.ry,hr=O.indexOf("n")>=0&&Y<=H*2||O.indexOf("s")>=0&&Y<=-H*2,E=O.indexOf("e")>=0&&A<=-U*2||O.indexOf("w")>=0&&A<=U*2;ir>0?(hr&&(ir=-ir),u.ry=u.rx,u.cy=u.cy+ir):(E&&(ir=-ir),u.cx=u.cx-ir,u.rx=u.ry)}}else u=Ht.apply(void 0,[f].concat(g));return u},Xt=function(){for(var K=arguments.length,f=new Array(K),N=0;N<K;N++)f[N]=arguments[N];var g=f[0],j=f[1],u=f[2],O=f[3],A=O.x,Y=O.y,L=O.width,B=O.height,m=L,k=B;return g.indexOf("n")>=0?(k=B-u,k>0?Y=Y+u:Y=Y+B,k=Math.abs(k)):g.indexOf("s")>=0&&(k=B+u,k<0&&(Y=Y+B+u),k=Math.abs(k)),g.indexOf("w")>=0?(m=L-j,m<0?A=A+L:A=A+j,m=Math.abs(m)):g.indexOf("e")>=0&&(m=L+j,m<0&&(A=A+L+j),m=Math.abs(m)),{x:A,y:Y,width:m,height:k}},Zt=function(){for(var K=arguments.length,f=new Array(K),N=0;N<K;N++)f[N]=arguments[N];var g=f[0],j=f[1],u=f[2],O=f[3],A=O.cx,Y=O.cy,L=O.rx,B=O.ry;return j=j/2,u=u/2,g.indexOf("n")>=0?(B=B-u,Y=Y+u,B=Math.abs(B)):g.indexOf("s")>=0&&(B=B+u,Y=Y+u,B=Math.abs(B)),g.indexOf("w")>=0?(L=L-j,A=A+j,L=Math.abs(L)):g.indexOf("e")>=0&&(L=L+j,A=A+j,L=Math.abs(L)),{cx:A,cy:Y,rx:L,ry:B}},Ht=function(K){for(var f=arguments.length,N=new Array(f>1?f-1:0),g=1;g<f;g++)N[g-1]=arguments[g];var j=N[0],u=N[1],O=N[2],A=N[3],Y=A.points,L=A.boundRect,B=(Y==null?void 0:Y.length)||0,m=[],k=L.x,Z=L.y,Q=L.width,U=L.height,H=Q/U,ir=j.indexOf("n")>=0,hr=j.indexOf("s")>=0,E=j.indexOf("w")>=0,wr=j.indexOf("e")>=0,Lr="";K&&(j.length===1?(ir||hr?(u=O*H,Lr="v"):(O=u/H,Lr="h"),ir?u=-u:E&&(O=-O)):(O=u/H,(E&&hr||wr&&ir)&&(O=-O)));for(var sr=0;sr<B;sr++){var W=tr()(Y[sr]),F=Math.abs(W[0]-k)/Q,w=Math.abs(W[1]-Z)/U;ir&&(W[1]+=O*(1-w)),(hr||Lr==="h")&&(W[1]+=O*w),E&&(W[0]+=u*(1-F)),(wr||Lr==="v")&&(W[0]+=u*F),m.push(W)}return{points:m}},Ut=function(K,f,N){var g=J()(K,2),j=g[0],u=g[1],O=J()(f,2),A=O[0],Y=O[1],L=J()(N,2),B=L[0],m=L[1],k=B-A,Z=m-Y,Q=((j-A)*k+(u-Y)*Z)/(k*k+Z*Z);return Q<0?(k=j-A,Z=u-Y):Q>1?(k=j-B,Z=u-m):(k=j-(A+Q*k),Z=u-(Y+Q*Z)),Math.sqrt(k*k+Z*Z)},Kr=function(K,f,N,g,j,u){var O=j*Math.PI/180;u&&(O=-O);var A=Math.cos(O),Y=Math.sin(O),L=K-N,B=f-g,m=L*A-B*Y+N,k=L*Y+B*A+g;return[m,k]},Qt=function(K,f,N,g,j,u,O,A){var Y=K+N/2,L=f+g/2,B=Kr(Y,L,j,u,O,A),m=J()(B,2),k=m[0],Z=m[1],Q=k-Y,U=Z-L;return{changeX:Q,changeY:U}},Vt=["attrs","shape_type"],qt=["points","shape_type"],pt=(0,I.forwardRef)(function(M,K){var f=(0,I.useRef)(M),N=(0,I.useRef)(null),g=(0,I.useRef)(null),j=(0,I.useRef)(null),u=(0,I.useRef)(null),O=(0,I.useRef)(null),A=(0,I.useRef)(null),Y=(0,I.useRef)(""),L=(0,I.useRef)(null),B=(0,I.useRef)(null),m=(0,I.useRef)(null),k=(0,I.useRef)({x:0,y:0,w:0,h:0,mx:0,my:0}),Z=(0,I.useRef)(!1),Q=(0,I.useRef)(!1),U=(0,I.useRef)(!1),H=(0,I.useRef)([]),ir=(0,I.useRef)("1"),hr=(0,I.useRef)({x:0,y:0,scale:1,w:0,h:0}),E=(0,I.useRef)(null),wr=(0,I.useRef)(null),Lr=(0,I.useRef)(""),sr=(0,I.useRef)(!1),W=(0,I.useRef)(!1),F=(0,I.useRef)(!1),w=(0,I.useRef)({}),q=(0,I.useRef)(null),D=(0,I.useRef)({}),cr=(0,I.useRef)([]),or=(0,I.useRef)([]),rr=function(){var r;(r=x.td_("#shape-grip-group,#path-point-group *,#shape-path-group *,#path-add-point"))===null||r===void 0||r.attr("display","none"),A.current="",O.current&&(x.Ys("#"+O.current).attr("fill",z.shapeCommon.fill),O.current=""),Y.current&&(x.Ys("#"+Y.current).attr("fill",z.grip.fill),Y.current=""),L.current&&(x.Ys("#path-point-"+L.current).attr("fill",z.point.fill),L.current="")},jr=function(){if(document.getElementById("svgcanvas")!==document.activeElement){var r;(r=document.getElementById("svgcanvas"))===null||r===void 0||r.focus()}},dr=function(r){var t=(r==null?void 0:r.sourceEvent)||r,e=[];if(Kt(t)?e=x.cx$(t.touches[0]||t.changedTouches[0],g.current.node()):e=x.cx$(t,g.current.node()),m.current){var n=m.current,a=n.x,c=n.y,o=n.k;e[0]=(e[0]-a)/o,e[1]=(e[1]-c)/o}return e},Er=function(){for(var r=H.current.length||0,t=0,e=0;e<r;e++)if(+H.current[e]!==e+1){t=e+1;break}return t===0&&(t=r+1),t=""+t,H.current.splice(t-1,0,t),t},Nr=function(r){return r==="ellipse"?{x:"cx",y:"cy",w:"rx",h:"ry"}:{x:"x",y:"y",w:"width",h:"height"}},re=function(){var r=f.current.drawTool,t=M.minSize,e=0,n=0;return r==="rect"?(e=u.current.attr("width"),n=u.current.attr("height")):r==="ellipse"&&(e=u.current.attr("rx")*2||0,n=u.current.attr("ry")*2||0),+e<=t[0]||+n<=t[1]?(u.current.remove(),u.current=null,x.Ys("#shape-grip-group").attr("display","none"),!0):!1},$r=function(r){var t,e,n=x.Ys("#shape-".concat(r));if(!n)return{};var a=n==null||(t=n.node())===null||t===void 0?void 0:t.getBBox(),c=(m==null||(e=m.current)===null||e===void 0?void 0:e.k)||1,o=a.x,i=a.y,l=a.width,s=a.height,v=o+l/2,h=i+s/2,p=v*c,d=h*c;return{centerX:v,centerY:h,gripCenterX:p,gripCenterY:d}},_r=function(){var r,t,e,n;if(u.current){var a=(r=u.current.attr("id"))===null||r===void 0?void 0:r.substring(6),c=(t=w.current[a])===null||t===void 0?void 0:t.rotate;if(c){var o=J()(c,3),i=o[0],l=o[1],s=o[2],v=(e=u.current)===null||e===void 0||(n=e.node())===null||n===void 0?void 0:n.getBBox(),h=v.x,p=v.y,d=v.width,b=v.height,S=Qt(h,p,d,b,l,s,i),R=S.changeX,C=S.changeY;return ct([R,C]),[R,C]}}},Br=function(){var r,t,e,n,a;if(!u.current||Q.current||A.current)return!1;var c=(r=u.current.attr("id"))===null||r===void 0?void 0:r.substring(6),o=(t=w.current)===null||t===void 0?void 0:t[c],i=o.hide,l=o.rotate,s=x.Ys("#shape-grip-group");if(s.attr("display",i?"none":"inline"),!i){var v=(m==null||(e=m.current)===null||e===void 0?void 0:e.k)||1,h=(n=u.current)===null||n===void 0||(a=n.node())===null||a===void 0?void 0:a.getBBox(),p=h.x,d=h.y,b=h.width,S=h.height,R=z.grip.width/2,C=z.grip.height/2;if(p=p*v||0,d=d*v||0,b=b*v||0,S=S*v||0,f.current.rotateEnable){var P=p+b/2;s.select("#rotate-line").attr("x1",P).attr("y1",d-4).attr("x2",P).attr("y2",d-16),s.select("#rotate-circle").attr("cx",P).attr("cy",d-20)}if(l){var G=J()(l,3),X=G[0],T=G[1],V=G[2],_=T*v,$=V*v;s.attr("transform","rotate(".concat(X," ").concat(_,",").concat($,")")),u.current.attr("transform","rotate(".concat(X," ").concat(T,",").concat(V,")"))}else s.attr("transform",null);var er=[[p,d],[p+b,d],[p+b,d+S],[p,d+S]],nr=B.current(er);x.Ys("#resize-path").attr("d",nr+"Z"),s.select("#resize-grip-nw").attr("x",p-R).attr("y",d-C),s.select("#resize-grip-n").attr("x",p+b/2-R).attr("y",d-C),s.select("#resize-grip-ne").attr("x",p+b-R).attr("y",d-C),s.select("#resize-grip-w").attr("x",p-R).attr("y",d+S/2-C),s.select("#resize-grip-e").attr("x",p+b-R).attr("y",d+S/2-C),s.select("#resize-grip-sw").attr("x",p-R).attr("y",d+S-C),s.select("#resize-grip-s").attr("x",p+b/2-R).attr("y",d+S-C),s.select("#resize-grip-se").attr("x",p+b-R).attr("y",d+S-C)}},yt=function(r){var t,e;if(!q.current){for(var n=(t=w.current)===null||t===void 0?void 0:t[r],a=n.attrs.points,c=n.shape_type,o=a.length,i=(m==null||(e=m.current)===null||e===void 0?void 0:e.k)||1,l=[],s=0;s<o;s++){var v=J()(a[s],2),h=v[0],p=v[1];h=h*i,p=p*i,l[s]=[h,p]}var d=B.current(l);c==="polygon"&&(d+="Z"),g.current.select("#path-add-point").attr("d",d)}},rt=function(r){var t,e=q.current||[],n=e.length;if(!(!Q.current||!n)){var a=(m==null||(t=m.current)===null||t===void 0?void 0:t.k)||1,c=J()(e[n-1],2),o=c[0],i=c[1],l=dr(r),s=J()(l,2),v=s[0],h=s[1];o=o*a,i=i*a,v=v*a,h=h*a;var p=[[o,i],[v,h]],d=B.current(p);x.Ys("#path-stretch-line").attr("d",d)}},Dr=function(r){var t,e,n,a,c,o;if(!u.current||!u.current.attr("id"))return!1;var i=(t=u.current.attr("id"))===null||t===void 0?void 0:t.substring(6),l=((e=w.current)===null||e===void 0||(n=e[i])===null||n===void 0||(a=n.attrs)===null||a===void 0?void 0:a.points)||q.current||[],s=l.length,v=(m==null||(c=m.current)===null||c===void 0?void 0:c.k)||1;if(s){yt(i);for(var h=0;h<s;h++){var p=x.Ys("#path-point-group #path-point-".concat(h+1)),d=J()(l[h],2),b=d[0],S=d[1];b=b*v,S=S*v,p.attr("cx",b).attr("cy",S),(Q.current||A.current)&&p.attr("display","inline")}if(r&&rt(r),!Q.current){var R=(o=w.current)===null||o===void 0?void 0:o[i],C=R.rotate;if(C){var P=J()(C,3),G=P[0],X=P[1],T=P[2],V=X*v,_=T*v,$="rotate(".concat(G," ").concat(V,",").concat(_,")");x.Ys("#path-point-group").attr("transform",$),x.Ys("#path-add-point").attr("transform",$),u.current.attr("transform","rotate(".concat(G," ").concat(X,",").concat(T,")"))}else x.Ys("#path-point-group").attr("transform",null),x.Ys("#path-add-point").attr("transform",null)}}},Gr=function(r){var t=r?M.showGrid:f.current.showGrid;if(t)if(m.current=m.current||x.CRH,m.current.k<1)g.current.select("#grid").attr("display","none");else{var e=hr.current,n=e.x,a=e.y,c=e.w,o=e.h,i=m.current.k,l=10*i,s=n*i,v=a*i;g.current.select("#gridPattern").attr("width",l).attr("height",l).attr("x",s).attr("y",v),g.current.select("#grid").attr("display","inline").attr("x",s).attr("y",v).attr("width",c*i).attr("height",o*i)}},Xr=function(r){var t=f.current,e=t.curLabel,n=t.colorBindLabel,a=r||e;if(n){var c=D.current[a]||ft(D.current);z.shapeCommon.stroke=c,z.font.fill=c,r&&(D.current[a]=c)}},Zr=function(r){var t=r||z.shapeCommon.stroke;return x.$_Y(t).copy({opacity:.2})},Hr=function(r,t){var e=x.Ys("#shape-".concat(r));e.attr("stroke",t),f.current.showLabel&&g.current.select("#shape-label-".concat(r)).attr("fill",t),O.current==="shape-"+r&&e.attr("fill",Zr(t))},te=function(r){var t,e=f.current,n=e.colorBindLabel,a=e.curLabel;if(n){var c,o,i;if(E.current||!u.current)return;var l=(c=u.current.attr("id"))===null||c===void 0?void 0:c.substring(6),s=(o=w.current)===null||o===void 0?void 0:o[l],v=s.label,h=D.current[a];(i=Object.keys(w.current))===null||i===void 0||i.forEach(function(b){var S=w.current[b].label;S===v&&Hr(b,r)}),h&&(z.shapeCommon.stroke=h,z.font.fill=h),D.current[v]=r,f.current.changeBindColor(D.current);return}if(z.shapeCommon.stroke=r,z.font.fill=r,E.current){var p;(p=E.current)===null||p===void 0||p.forEach(function(b){Hr(b,r)});return}if(u.current){var d=(t=u.current.attr("id"))===null||t===void 0?void 0:t.substring(6);Hr(d,r)}},Ar=function(r,t,e){var n;if(t){var a=(m==null||(n=m.current)===null||n===void 0?void 0:n.k)||1,c=w.current[r],o=c.shape_type,i=c.attrs,l=c.rotate,s=g.current.select("#shape-label-".concat(r)),v=0,h=0;if(o==="ellipse"){var p=i.cx,d=i.cy,b=i.ry;v=p,h=d-b}else if(o==="rect")v=i.x,h=i.y;else{var S=i.points,R=J()(S[0],2);v=R[0],h=R[1];for(var C=1;C<S.length;C++){var P=J()(S[C],2),G=P[0],X=P[1];h>X?(h=X,v=G):h===X&&v>G&&(v=G)}}if(v=v*a||0,h=h*a||0,s.attr("x",v).attr("y",h),e&&s.attr("fill",z.font.fill),l){var T=J()(l,3),V=T[0],_=T[1],$=T[2],er=_*a,nr=$*a;s.attr("transform","rotate(".concat(V," ").concat(er,",").concat(nr,")"))}}},tt=function(r){var t=r?M.showLabel:f.current.showLabel;if(t){var e=Object.keys(w.current);e==null||e.forEach(function(n){Ar(n,t)})}},pr=function(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++)t[e]=arguments[e];cr.current.push(t),or.current=[]},Ur=function(){var r=[],t={};if(E.current){var e,n={};(e=E.current)===null||e===void 0||e.forEach(function(i){var l=x.Ys("#shape-".concat(i));t[i]=JSON.parse(JSON.stringify(w.current[i])),n[i]=l}),r=[E.current,t,n]}else if(u.current){var a,c,o=(a=u.current)===null||a===void 0||(c=a.attr("id"))===null||c===void 0?void 0:c.substring(6);t[o]=JSON.parse(JSON.stringify(w.current[o])),r=[u.current,t]}return r},et=function(r){var t,e,n,a=(t=u.current)===null||t===void 0||(e=t.attr("id"))===null||e===void 0?void 0:e.substring(6),c=(n=w.current)===null||n===void 0?void 0:n[a],o=c.attrs,i=c.shape_type,l=c.rotate;if(k.current=o,i==="polygon"||i==="line"){var s,v;k.current.boundRect=(s=u.current)===null||s===void 0||(v=s.node())===null||v===void 0?void 0:v.getBBox(),k.current.close=i==="polygon"}var h=dr(r);if(l){var p=J()(l,3),d=p[0],b=p[1],S=p[2];h=Kr.apply(void 0,tr()(h).concat([b,S,d,!0]))}var R=h,C=J()(R,2);k.current.mx=C[0],k.current.my=C[1]},fr=function(){var r=Object.keys(w.current),t=[],e=hr.current,n=e.x,a=e.y,c=e.scale;return r==null||r.forEach(function(o){var i=w.current[o],l=i.attrs,s=i.label,v=i.shape_type,h=i.hide,p=i.rotate,d={};if(d.label=s||o,d.shape_type=v,d.attrs={},d.hide=h||!1,d.id=o,p&&(d.rotate=p[0]),v==="rect")d.attrs.x=(l.x-n)*c,d.attrs.y=(l.y-a)*c,d.attrs.width=l.width*c,d.attrs.height=l.height*c;else if(v==="ellipse")d.attrs.cx=(l.cx-n)*c,d.attrs.cy=(l.cy-a)*c,d.attrs.rx=l.rx*c,d.attrs.ry=l.ry*c;else{var b;d.attrs.points=[],(b=l.points)===null||b===void 0||b.forEach(function(S,R){d.attrs.points[R]=[(S[0]-n)*c,(S[1]-a)*c]})}t.push(d)}),t},ee=function(r){var t=(r==null?void 0:r.target)||(r==null?void 0:r.srcElement),e=x.Ys(t).attr("id"),n=null,a=f.current.drawTool;Y.current||L.current?n="crosshair":sr.current&&!W.current&&!F.current||a==="drag"?n="grab":e==="path-add-point"?n="pointer":u.current&&!Q.current&&O.current===e||E.current&&E.current.includes(e==null?void 0:e.substring(6))?n="move":(!a||a==="move")&&(n="default"),x.Ys(N.current).style("cursor",n)},ne=function(r){f.current.showCrosshair&&(g.current.select("#crosshair-v-line").attr("x",r.layerX),g.current.select("#crosshair-h-line").attr("y",r.layerY))},nt=function(r){var t=x.Ys("#shape-path-group #shape-path-".concat(r));if(t.node())t.attr("display","inline").attr("transform",null);else{t=x.Ys("#shape-path-group").append("path").attr("id","shape-path-".concat(r)).style("pointer-events","none");var e=z.line;Object.keys(e).forEach(function(n){t.attr(n,e[n])})}return t},Fr=function(){var r,t,e=(m==null||(r=m.current)===null||r===void 0?void 0:r.k)||1;(t=E.current)===null||t===void 0||t.forEach(function(n,a){var c,o=x.Ys("#shape-".concat(n)),i=o.node().getBBox(),l=i.x,s=i.y,v=i.width,h=i.height,p=nt(a);l=l*e||0,s=s*e||0,v=v*e||0,h=h*e||0;var d=[[l-2,s-2],[l+v+2,s-2],[l+v+2,s+h+2],[l-2,s+h+2]],b=B.current(d);p.attr("d",b+"Z");var S=(c=w.current)===null||c===void 0?void 0:c[n],R=S.rotate;if(R){var C=J()(R,3),P=C[0],G=C[1],X=C[2],T=G*e,V=X*e;o.attr("transform","rotate(".concat(P," ").concat(G,",").concat(X,")")),p.attr("transform","rotate(".concat(P," ").concat(T,",").concat(V,")"))}})},gr=function(){var r,t,e;return(r=E.current)!==null&&r!==void 0&&r.length?E.current:u.current?[(t=u.current)===null||t===void 0||(e=t.attr("id"))===null||e===void 0?void 0:e.substring(6)]:[]},at=function(r,t){var e,n,a,c=t,o=r,i="",l="";if(o instanceof Array)E.current=o,c=!0;else if(typeof o=="string")i="shape-"+o,o=g.current.select("#".concat(i));else{var s,v;i=(s=o)===null||s===void 0?void 0:s.attr("id"),l=(v=u.current)===null||v===void 0?void 0:v.attr("id")}if(c&&(l&&i!==l||E.current)){var h,p;if(u.current=null,i=(h=i)===null||h===void 0?void 0:h.substring(6),E.current)if(i){var b=E.current.indexOf(i);if(b>=0){var S;E.current.splice(b,1),(S=E.current)!==null&&S!==void 0&&S.length||(E.current=null)}else E.current.push(i);f.current.changeSelect(gr())}else f.current.changeSelect(gr());else{var d;l=(d=l)===null||d===void 0?void 0:d.substring(6),E.current=[i,l],f.current.changeSelect(gr())}(p=E.current)===null||p===void 0||p.forEach(function(V,_){nt(_)}),rr(),Fr();return}u.current=o,(e=x.td_("#shape-path-group *"))===null||e===void 0||e.attr("display","none"),E.current=null;var R=(n=w.current)===null||n===void 0?void 0:n[(a=i)===null||a===void 0?void 0:a.substring(6)],C=R.shape_type,P=R.hide;if(O.current&&x.Ys("#"+O.current).attr("fill",z.shapeCommon.fill),O.current===i)O.current="",(C==="line"||C==="polygon")&&(A.current="",g.current.selectAll("#path-point-group circle,#path-add-point").attr("display","none"),Br());else if(O.current!==i)if(O.current=i,o.attr("fill",Zr(o.attr("stroke"))),C==="line"||C==="polygon"){var G;if(A.current=i,(G=g.current.selectAll("#path-point-group circle,#shape-grip-group"))===null||G===void 0||G.attr("display","none"),P){var X;(X=g.current.select("#path-add-point"))===null||X===void 0||X.attr("display","none")}else{var T;(T=g.current.select("#path-add-point"))===null||T===void 0||T.attr("display","inline"),Dr()}}else A.current="",g.current.selectAll("#path-point-group circle,#path-add-point").attr("display","none"),Br();f.current.changeSelect(gr())},Mr=function(r){var t,e,n,a=r||u.current;if(a){rr();var c=(t=a.attr("id"))===null||t===void 0?void 0:t.substring(6),o=H.current.indexOf(c);H.current.splice(o,1),a==null||a.remove(),(e=g.current.select("#shape-label-".concat(c)))===null||e===void 0||e.attr("display","none"),u.current=null,q.current=null,(n=w.current)===null||n===void 0||delete n[c]}},it=function(){var r,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,e={};if(E.current){var n,a={};return(n=E.current)===null||n===void 0||n.forEach(function(o){var i=x.Ys("#shape-".concat(o));e[o]=JSON.parse(JSON.stringify(w.current[o])),a[o]=i,Mr(i)}),t&&pr("del",E.current,e,a),E.current=null,f.current.changeSize(fr()),f.current.changeSelect(gr()),[e,a]}if(u.current){var c=(r=u.current.attr("id"))===null||r===void 0?void 0:r.substring(6);return e[c]=JSON.parse(JSON.stringify(w.current[c])),t&&pr("del",u.current,e),Mr(),f.current.changeSize(fr()),f.current.changeSelect(gr()),[e]}},ae=function(){var r,t;if(!(!L.current||!u.current)){var e=(r=u.current.attr("id"))===null||r===void 0?void 0:r.substring(6),n=((t=w.current)===null||t===void 0?void 0:t[e])||{},a=n.attrs.points,c=n.shape_type,o=a.length,i={};if(i[e]=JSON.parse(JSON.stringify(w.current[e])),o<=2){pr("del",u.current,i),Mr(),rr();return}pr("edit",u.current,i),x.Ys("#path-point-group #path-point-".concat(o)).attr("display","none"),x.Ys("#path-point-group #path-point-".concat(L.current)).attr("fill",z.point.fill),a.splice(L.current-1,1),L.current=null;var l=B.current(a);c==="polygon"&&(l+="Z"),u.current.attr("d",l),Ar(e,f.current.showLabel),Dr()}},St=function(r,t){var e=t.shape_type,n=t.attrs,a=t.rotate;if(e==="rect"||e==="ellipse"){var c=Object.keys(n);c==null||c.forEach(function(l){r.attr(l,n[l])})}else{var o=n.points,i=B.current(o);e==="polygon"&&(i+="Z"),r.attr("d",i)}a?r.attr("transform","rotate(".concat(a[0]," ").concat(a[1],",").concat(a[2],")")):r.attr("transform",null)},mt=function(r){var t=r||[],e=It()(t),n=e[0],a=e.slice(1),c=J()(a,3),o=c[0],i=c[1],l=c[2],s=[];if(n==="add")o instanceof Array?E.current=o:(E.current=null,u.current=o),s=it(!1);else if(n==="del"){if(o instanceof Array)o==null||o.forEach(function(C){var P;H.current.splice(C-1,0,+C),(P=g.current.select("#shape-label-".concat(C)))===null||P===void 0||P.attr("display","inline"),g.current.select("#shape").insert(function(){return l[C].node()})});else{var v,h,p=(v=Object.keys(i))===null||v===void 0?void 0:v[0];H.current.splice(p-1,0,p),(h=g.current.select("#shape-label-".concat(p)))===null||h===void 0||h.attr("display","inline"),g.current.select("#shape").insert(function(){return o.node()})}w.current=Object.assign({},w.current,i)}else if(n==="edit"){var d={};if(o instanceof Array)o==null||o.forEach(function(C){d[C]=JSON.parse(JSON.stringify(w.current[C])),St(l[C],i[C])}),s=[d,l];else{var b,S,R=(b=o.attr("id"))===null||b===void 0?void 0:b.substring(6);d[R]=JSON.parse(JSON.stringify(w.current[R])),St(o,(S=Object.values(i))===null||S===void 0?void 0:S[0]),s=[d]}w.current=Object.assign({},w.current,i)}return E.current=null,u.current=null,f.current.changeSize(fr()),f.current.changeSelect([]),rr(),tt(),n==="del"?[o]:[o].concat(tr()(s))},ie=function(){if(cr.current.length){var r=cr.current.pop(),t=r||[],e=J()(t,1),n=e[0],a=mt(r);if(n==="add"){or.current.push(["del"].concat(tr()(a)));return}else n==="del"?or.current.push(["add"].concat(tr()(a))):n==="edit"&&or.current.push([n].concat(tr()(a)))}},ce=function(){if(or.current.length){var r=or.current.pop(),t=r||[],e=J()(t,1),n=e[0],a=mt(r);if(n==="add")cr.current.push(["del"].concat(tr()(a)));else if(n==="del"){cr.current.push(["add"].concat(tr()(a)));return}else n==="edit"&&cr.current.push([n].concat(tr()(a)))}},bt=function(r,t){var e,n=t||u.current;if(n){var a=f.current.showLabel,c=J()(r,2),o=c[0],i=c[1],l=n==null||(e=n.attr("id"))===null||e===void 0?void 0:e.substring(6),s=w.current[l],v=s.attrs,h=s.shape_type,p=s.rotate,d={};if(h==="rect"){var b=v.x,S=v.y,R=v.width,C=v.height;b+=o,S+=i,n.attr("x",b).attr("y",S),d={x:b,y:S,width:R,height:C}}else if(h==="ellipse"){var P=v.cx,G=v.cy,X=v.rx,T=v.ry;P+=o,G+=i,n.attr("cx",P).attr("cy",G),d={cx:P,cy:G,rx:X,ry:T}}else{for(var V=v.points,_=h==="polygon",$=(V==null?void 0:V.length)||0,er=[],nr=0;nr<$;nr++){var vr=J()(V[nr],2),xr=vr[0],yr=vr[1];xr+=o,yr+=i,er[nr]=[xr,yr]}var kr=B.current(er);n.attr("d",kr+(_?"Z":"")),d={points:er},er=null}if(p){var lr,ur=n==null||(lr=n.node())===null||lr===void 0?void 0:lr.getBBox(),Or=ur.x,Yr=ur.y,Sr=ur.width,zr=ur.height,Pr=Or+Sr/2,Jr=Yr+zr/2;w.current[l].rotate[1]=Pr,w.current[l].rotate[2]=Jr}w.current[l].attrs=d,E.current?Fr():h==="rect"||h==="ellipse"?Br():Dr(),Ar(l,a)}},ct=function(r){if(E.current){var t;(t=E.current)===null||t===void 0||t.forEach(function(e){var n=x.Ys("#shape-".concat(e));bt(r,n)});return}bt(r)},Qr=function(r,t,e){var n=g.current.select("#shape-label-".concat(r)),a=f.current.showLabel;if(n.node()){n.text(t).attr("display","inline"),Ar(r,a,!0);return}var c=g.current.select("#shape-label-group").append("text").attr("id","shape-label-".concat(r)).style("user-select","none").text(t),o=Object.assign({},z.font);e&&(o["text-anchor"]="middle"),Object.keys(o).forEach(function(i){c.attr(i,o[i])}),Ar(r,a)},oe=function(r){var t,e;if(u.current){var n=(t=u.current)===null||t===void 0||(e=t.attr("id"))===null||e===void 0?void 0:e.substring(6),a=$r(n),c=a.centerX,o=a.centerY,i=a.gripCenterX,l=a.gripCenterY,s=r[0]-c,v=o-r[1],h=Math.atan2(v,s)*180/Math.PI;h<-90?h=-270-h:h=90-h,u.current.attr("transform","rotate(".concat(h," ").concat(c,",").concat(o,")")),g.current.select("#shape-grip-group").attr("transform","rotate(".concat(h," ").concat(i,",").concat(l,")")),f.current.showLabel&&g.current.select("#shape-label-".concat(n)).attr("transform","rotate(".concat(h," ").concat(i,",").concat(l,")")),w.current[n].rotate=[h,c,o]}},mr=function(r){for(var t=arguments.length,e=new Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];var a=e[0],c=e[1],o=dr(a),i=o[0]-k.current.mx,l=o[1]-k.current.my;if(r==="moveGrip"){var s,v,h,p="",d=(s=u.current)===null||s===void 0||(v=s.attr("id"))===null||v===void 0?void 0:v.substring(6),b=(h=w.current)===null||h===void 0?void 0:h[d],S=b.shape_type,R=b.rotate;if(R){var C=J()(R,3),P=C[0],G=C[1],X=C[2];o=Kr.apply(void 0,tr()(o).concat([G,X,P,!0])),i=o[0]-k.current.mx,l=o[1]-k.current.my}Y.current?p=Y.current.substring(12):p=c.attr("id").substring(12);var T=Gt(S,W.current,p,i,l,k.current);if(S==="polygon"||S==="line"){var V=B.current(T.points);u.current.attr("d",V+(k.current.close?"Z":""))}else Object.keys(T).forEach(function(Pr){u.current.attr(Pr,T[Pr])});w.current[d].attrs=T,Br(),Ar(d,f.current.showLabel),Y.current&&R&&(_r(),x.Ys("#"+Y.current).attr("fill",z.grip.fill),Y.current=null);return}if(r==="moveShape"){ct([a.dx,a.dy]);return}if(r==="moveWhole"){var _,$;m.current=m.current.translate(i,l),x.sPX().transform(g.current,m.current),g.current.selectAll("g.layer").attr("transform",m.current),g.current.selectAll("g#shape-related-group").attr("transform","translate(".concat((_=m.current)===null||_===void 0?void 0:_.x,",").concat(($=m.current)===null||$===void 0?void 0:$.y,")")),Gr();return}if(r==="movePoint"){var er,nr,vr,xr="",yr=(er=u.current)===null||er===void 0||(nr=er.attr("id"))===null||nr===void 0?void 0:nr.substring(6),kr=w.current[yr],lr=kr.attrs.points,ur=kr.shape_type,Or=(m==null||(vr=m.current)===null||vr===void 0?void 0:vr.k)||1,Yr=ur==="polygon";L.current?xr=L.current:xr=c.attr("id").substring(11);var Sr=lr[xr-1];Sr[0]=Sr[0]+a.dx/Or,Sr[1]=Sr[1]+a.dy/Or,lr[xr-1]=Sr,w.current[yr].attrs={points:lr};var zr=B.current(lr);u.current.attr("d",zr+(Yr?"Z":"")),Dr(),Ar(yr,f.current.showLabel);return}if(r==="moveRotate"){oe(o);return}},le=function(r){var t=(r==null?void 0:r.target)||(r==null?void 0:r.srcElement),e=x.Ys(t).attr("id"),n=q.current||[],a=n.length;if(x.td_("#path-point-group circle").attr("r",z.point.r),r.type==="touchstart"||r.type==="mouseenter"){if(Q.current&&(e!=="path-point-1"||a<3))return;x.Ys("#".concat(e)).attr("r",6),x.Ys(t).style("cursor","pointer")}else x.Ys(t).style("cursor",null)},ot=function(r,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=x.Ys("#path-point-group"),a=n.selectAll("circle"),c=a.size(),o=z.point;if(!c||c<=t){var i=n.append("circle").attr("id",r).call(Rr("point",mr));return i.on("touchstart touchend mouseenter mouseleave",le),Object.keys(o).forEach(function(l){i.attr(l,o[l])}),i.attr("display",e?"inline":"none"),i}return x.Ys("#"+r).attr("display",e?"inline":"none")},ue=function(r){var t,e=dr(r),n=O.current.substring(6),a=(t=w.current)===null||t===void 0?void 0:t[n],c=a.attrs.points,o=a.shape_type,i=a.rotate,l=c.length,s=-1,v=1/0,h={};if(h[n]=JSON.parse(JSON.stringify(w.current[n])),pr("edit",u.current,h),i){var p=J()(i,3),d=p[0],b=p[1],S=p[2];e=Kr.apply(void 0,tr()(e).concat([b,S,d,!0]))}for(var R=0;R<l;R++){var C=(R+1)%l,P=c[R],G=c[C],X=Ut(e,P,G);X<v&&(s=C,v=X)}c.splice(s,0,e);var T=B.current(c);o==="polygon"&&(T+="Z"),u.current.attr("d",T),_r();var V="path-point-".concat(l+1);ot(V,l),Dr()},wt=function(r){var t,e;(t=x.Ys("#path-stretch-line"))===null||t===void 0||t.attr("display","none");var n=u.current.attr("d");r&&u.current.attr("d",n+"Z");var a=(e=u.current.attr("id"))===null||e===void 0?void 0:e.substring("6"),c=f.current,o=c.curLabel,i=c.colorBindLabel;i&&o&&!D.current[o]&&(D.current[o]=z.shapeCommon.stroke,f.current.changeBindColor(D.current)),o=o||a,w.current[a]={shape_type:r?"polygon":"line",label:o,attrs:{points:q.current}},q.current=null,A.current="shape-".concat(a),O.current=A.current,x.Ys("#"+O.current).attr("fill",Zr(u.current.attr("stroke"))),f.current.changeSize(fr()),f.current.changeSelect(gr()),Qr(a,o,!0),g.current.select("#path-add-point").attr("display","inline"),yt(a),pr("add",u.current),f.current.endDraw({id:a,label:o})},se=function(r,t,e,n){var a,c=(r==null?void 0:r.sourceEvent)||r,o=q.current||[],i=o==null?void 0:o.length;if(c.button===2){if(!i)return;i<2?Mr():wt();return}if(e==="point"&&n.attr("id")==="path-point-1"&&i>=3){wt(!0);return}var l=x.Ys("#path-point-group").attr("transform",null),s=l.selectAll("circle"),v=s.size(),h=dr(r),p=J()(h,2),d=p[0],b=p[1],S=z.line;if(i){q.current.push([d,b]);var G=B.current(q.current);u.current.attr("d",G)}else{var R;Q.current=!0,rr(),(R=x.Ys("#path-stretch-line"))===null||R===void 0||R.attr("display","inline"),Xr();var C=Object.assign({},z.shapeCommon,z[t]);u.current=j.current.select("#shape").append(t).call(Rr("shape",mr));var P=Er();u.current.attr("id","shape-".concat(P)),Object.keys(C).forEach(function($){u.current.attr($,C[$])}),q.current=[[d,b]]}(!v||!l.select("#path-stretch-line").size())&&(l.append("path").attr("id","path-stretch-line").style("pointer-events","none"),Object.keys(S).forEach(function($){x.Ys("#path-stretch-line").attr($,S[$])}));var X="path-point-".concat(i+1);ot(X,i);var T=(m==null||(a=m.current)===null||a===void 0?void 0:a.k)||1,V=d*T,_=b*T;x.Ys("#"+X).attr("cx",V).attr("cy",_),rt(r)},xt=function(r){ee(r),ne(r),rt(r)},de=function(r,t,e){var n=f.current.drawTool;if(!(!n||t.defaultPrevented)){if(r==="grip"){var a=e.attr("id");Y.current&&x.Ys("#"+Y.current).attr("fill",z.grip.fill),Y.current===a?Y.current=null:(Y.current=a,e.attr("fill","#ff0"),et(t));return}if(Y.current){var c=Ur();pr.apply(void 0,["edit"].concat(tr()(c))),c=null,mr("moveGrip",t,e),f.current.changeSize(fr());return}if(r==="point"){var o=e.attr("id").substring(11);L.current&&x.Ys("#path-point-"+L.current).attr("fill",z.point.fill),L.current===o?L.current=null:(L.current=o,e.attr("fill","#ff0"),et(t));return}if(L.current){var i=Ur();pr.apply(void 0,["edit"].concat(tr()(i))),i=null,mr("movePoint",t,e),f.current.changeSize(fr());return}if(r==="insertPoint"){ue(t);return}if(r==="shape"){var l;at(e,W.current||(t==null||(l=t.sourceEvent)===null||l===void 0?void 0:l.shiftKey));return}if(r==="whole"){rr(),u.current=null,E.current=null,f.current.changeSelect([]);return}}},Ct=function(){if(!u.current||!Z.current)return!1;Z.current=!1,rr();var r=re();if(r)return!1;var t=f.current,e=t.drawTool,n=t.curLabel,a=t.colorBindLabel,c=Er();a&&n&&!D.current[n]&&(D.current[n]=z.shapeCommon.stroke,f.current.changeBindColor(D.current)),n=n||c,u.current.attr("id","shape-".concat(c)),w.current[c]={shape_type:e,label:n,attrs:q.current},q.current=null,Br(),f.current.changeSize(fr()),Qr(c,n,e==="ellipse"),pr("add",u.current),f.current.endDraw({id:c,label:n})},ve=function(r){var t=dr(r);Z.current=!0,u.current=null,rr();var e=J()(t,2);return k.current.x=e[0],k.current.y=e[1],x.Ys("#shape-selector").attr("display","inline").attr("x",t[0]).attr("y",t[1]).attr("width",0).attr("height",0),!1},fe=function(){var r,t=x.Ys("#shape-selector").node().getBoundingClientRect(),e=Object.keys(w.current),n=[],a=(m==null||(r=m.current)===null||r===void 0?void 0:r.k)||1;e==null||e.forEach(function(c){var o=x.Ys("#shape-".concat(c)),i=n.length,l=x.Ys("#shape-path-group #shape-path-".concat(i)),s=o.node().getBoundingClientRect(),v=s.bottom>t.top&&s.top<t.bottom&&s.left<t.right&&s.right>t.left;if(v){var h;n.push(c);var p=o.node().getBBox(),d=p.x,b=p.y,S=p.width,R=p.height;l.node()?l.attr("display","inline").attr("transform",null):l=nt(i),d=d*a||0,b=b*a||0,S=S*a||0,R=R*a||0;var C=[[d-2,b-2],[d+S+2,b-2],[d+S+2,b+R+2],[d-2,b+R+2]],P=B.current(C);l.attr("d",P+"Z");var G=(h=w.current)===null||h===void 0?void 0:h[c],X=G.rotate;if(X){var T=J()(X,3),V=T[0],_=T[1],$=T[2],er=_*a,nr=$*a;l.attr("transform","rotate(".concat(V," ").concat(er,",").concat(nr,")"))}}else{var vr;(vr=l)===null||vr===void 0||vr.attr("display","none")}}),E.current=(n==null?void 0:n.length)&&n},he=function(r){var t;if(!Z.current)return!1;var e=dr(r),n=k.current,a=n.x,c=n.y,o=e[0]-a,i=e[1]-c,l=(m==null||(t=m.current)===null||t===void 0?void 0:t.k)||1,s=Math.abs(o),v=Math.abs(i);return o<0&&(a=e[0]),i<0&&(c=e[1]),a=a*l||0,c=c*l||0,s=s*l||0,v=v*l||0,x.Ys("#shape-related-group #shape-selector").attr("x",a).attr("y",c).attr("width",s).attr("height",v),fe(),!1},pe=function(){if(!Z.current)return!1;Z.current=!1,x.td_("#shape-related-group #shape-selector").attr("display","none")},ge=function(r,t,e){var n;return r==="grip"?"moveGrip":r==="rotate"?"moveRotate":r==="point"&&!Q.current?"movePoint":r==="insertPoint"?r:t==="drag"||sr.current&&!W.current&&!F.current?"moveWhole":r==="shape"&&!sr.current&&(t==="move"||O.current===e.attr("id")||E.current&&E.current.includes((n=e.attr("id"))===null||n===void 0?void 0:n.substring(6)))?"moveShape":r==="whole"&&t==="move"&&!sr.current&&!F.current?"selectShape":t==="rect"||t==="ellipse"?"shape":t},Rr=function(r,t){var e="",n="",a=null,c=!1,o=null;return x.ohM().filter(function(i){return jr(),e=f.current.drawTool,a=x.Ys(this),n=ge(r,e,a),e?!i.button||i.button===2&&Q.current&&n==="path":!1}).on("start",function(i){var l,s;if(i==null||(l=i.sourceEvent)===null||l===void 0||l.stopPropagation(),i==null||(s=i.sourceEvent)===null||s===void 0||s.preventDefault(),U.current=!1,c=!1,!(Y.current||L.current)){if(n==="path"){E.current=null,se(i,e,r,a);return}if(n==="moveShape"){var v,h,p=(v=a.attr("id"))===null||v===void 0?void 0:v.substring(6);if(!E.current&&O.current!==a.attr("id")||E.current&&!E.current.includes(p)){var d;c=!0,at(a,W.current||(i==null||(d=i.sourceEvent)===null||d===void 0?void 0:d.shiftKey))}(F.current||i!=null&&(h=i.sourceEvent)!==null&&h!==void 0&&h.altKey)&&Ot()}else if(n.indexOf("move")>=0&&n.length>4)if(n==="moveWhole"){m.current=m.current||x.CRH;var b=dr(i),S=J()(b,2);k.current.mx=S[0],k.current.my=S[1]}else if(n==="moveGrip")et(i);else{var R=dr(i),C=J()(R,2);k.current.mx=C[0],k.current.my=C[1]}n.indexOf("move")>=0&&n.length>4&&n!=="moveWhole"&&(o=Ur())}}).on("drag",function(i){var l,s;if(i==null||(l=i.sourceEvent)===null||l===void 0||l.stopPropagation(),i==null||(s=i.sourceEvent)===null||s===void 0||s.preventDefault(),i!=null&&i.sourceEvent&&xt(i.sourceEvent),!(Y.current||L.current||n==="path"||n==="insertPoint")&&!(i.dx===0&&i.dy===0)){if(U.current=!0,n.indexOf("move")>=0){t(n,i,a);return}if(n==="shape"){Z.current?Se(i,e):(E.current=null,ye(i,e));return}n==="selectShape"&&(Z.current?he(i):ve(i))}}).on("end",function(i){var l,s;if(i==null||(l=i.sourceEvent)===null||l===void 0||l.stopPropagation(),i==null||(s=i.sourceEvent)===null||s===void 0||s.preventDefault(),U.current)if(n==="shape"){Ct(),f.current.changeSelect(gr());return}else if(n==="selectShape"){pe(),f.current.changeSelect(gr());return}else n!=="moveWhole"&&n.indexOf("move")>=0&&n.length>4&&((n==="moveGrip"||n==="movePoint")&&_r(),f.current.changeSize(fr()),o&&pr.apply(void 0,["edit"].concat(tr()(o))),o=null);else if(Q.current&&n==="path")q.current||(Q.current=!1);else if(!c){de(r,i,a);return}})},lt=function(r){var t,e="",n=e.drawTool;return x.sPX().scaleExtent((t=f.current)===null||t===void 0?void 0:t.scaleExtent).filter(function(a){return(!a.ctrlKey||a.type==="wheel")&&!a.button}).on("start",function(a){var c,o;n=f.current.drawTool,jr(),a==null||(c=a.sourceEvent)===null||c===void 0||c.stopPropagation(),a==null||(o=a.sourceEvent)===null||o===void 0||o.preventDefault()}).on("zoom",function(a){var c,o;a==null||(c=a.sourceEvent)===null||c===void 0||c.stopPropagation(),a==null||(o=a.sourceEvent)===null||o===void 0||o.preventDefault(),n&&r&&r(a)}).on("end",function(a){var c,o;a==null||(c=a.sourceEvent)===null||c===void 0||c.stopPropagation(),a==null||(o=a.sourceEvent)===null||o===void 0||o.preventDefault()})},Et=function(r){var t,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;e&&(m.current=r.transform),g.current.selectAll("g.layer").attr("transform",m.current),g.current.selectAll("g#shape-related-group").attr("transform","translate(".concat(m.current.x,", ").concat(m.current.y,")")),(t=E.current)!==null&&t!==void 0&&t.length?Fr():(Br(),e?Dr(r):Dr()),tt(),Gr(),ir.current=m.current.k,f.current.changeScale(ir.current)},Rt=function(r){var t,e,n=!0,a=r;if(!a){var c;a=u.current,a.attr("fill",z.shapeCommon.fill),n=!1,(c=g.current.select("#path-add-point"))===null||c===void 0||c.attr("display","inline")}var o=(t=a.attr("id"))===null||t===void 0?void 0:t.substring(6),i=w.current[o],l=i.label,s=i.shape_type,v=a.clone(),h=Er();return v=j.current.select("#shape").append(function(){return v.node()}).attr("id","shape-".concat(h)).call(Rr("shape",mr)),w.current[h]=JSON.parse(JSON.stringify((e=w.current)===null||e===void 0?void 0:e[o])),Qr(h,l,s!=="rect"),n?""+h:(v.attr("fill",Zr(v.attr("stroke"))),O.current="shape-".concat(h),v)},Ot=function(){if(E.current){var r,t=[];(r=E.current)===null||r===void 0||r.forEach(function(e){var n=x.Ys("#shape-".concat(e));t.push(Rt(n))}),E.current=t,f.current.changeSelect(gr()),pr("add",E.current);return}u.current&&(u.current=Rt(),f.current.changeSelect(gr()),pr("add",u.current))},ye=function(r,t){var e=dr(r);Z.current=!0,u.current=j.current.select("#shape").append(t).call(Rr("shape",mr)),Xr();var n=Object.assign({},z.shapeCommon,z[t]),a="x",c="y";t==="ellipse"&&(a="cx",c="cy");var o=J()(e,2);k.current.x=o[0],k.current.y=o[1];var i=J()(e,2);return n[a]=i[0],n[c]=i[1],Object.keys(n).forEach(function(l){u.current.attr(l,n[l])}),!1},Se=function(r,t){if(!u.current||!Z.current)return!1;var e=dr(r),n=k.current,a=n.x,c=n.y,o=e[0]-a,i=e[1]-c;if(t==="rect"){var l=Math.abs(o),s=Math.abs(i);return o<0&&(W.current&&l<s?a=a-s:a=e[0]),i<0&&(W.current&&l>s?c=c-l:c=e[1]),W.current&&(l>s?s=l:l=s),q.current={x:a,y:c,width:l,height:s},u.current.attr("x",a).attr("y",c).attr("width",l).attr("height",s),!1}if(t==="ellipse"){var v=o/2||0,h=i/2||0,p=Math.abs(v),d=Math.abs(h);W.current&&(p>d?(h=h>0?p:-p,d=p):(v=v>0?d:-d,p=d)),a=a+v,c=c+h,q.current={cx:a,cy:c,rx:p,ry:d},u.current.attr("cx",a).attr("cy",c).attr("rx",p).attr("ry",d)}return!1},me=function(r){if(r!=="path"&&Q.current){Mr(),Q.current=!1;return}},be=function(){if(Z.current){Ct();return}},we=function(r){sr.current=r.ctrlKey,F.current=r.altKey,W.current=r.shiftKey;var t=r.keyCode||r.which||r.charCode;if(Q.current){t===27&&Mr();return}if(t===8||t===46){L.current?(ae(),f.current.changeSize(fr())):it();return}if(sr.current&&t===67){var e;wr.current=E.current&&tr()(E.current)||((e=u.current)===null||e===void 0?void 0:e.attr("id"))||null}if(sr.current&&t===86){if(!wr.current)return;rr();var n=Nt()(wr.current)==="object";n?E.current=tr()(wr.current):u.current=x.Ys("#".concat(wr.current)),Ot(),n?Fr():["rect","ellipse"].includes(w.current[wr.current.substring(6)].shape_type)?Br():Dr(),f.current.changeSize(fr())}if([37,38,39,40].includes(t)){var a=0,c=0;t===37?a=-1:t===38?c=-1:t===39?a=1:t===40&&(c=1);var o=Ur();pr.apply(void 0,["edit"].concat(tr()(o))),o=null,ct([a,c])}},xe=function(r){sr.current=r.ctrlKey,F.current=r.altKey,W.current=r.shiftKey},Yt=function(r){r?x.Ys("body").on("keyup",xe):(x.Ys("body").on("keyup",null),sr.current=!1,F.current=!1,W.current=!1,be())},Lt=function(r){var t,e,n,a=(t=g.current)===null||t===void 0?void 0:t.select("#shape-grip-group #rotate-line"),c=(e=g.current)===null||e===void 0?void 0:e.select("#shape-grip-group #rotate-circle");if(r){var o;if((o=a)!==null&&o!==void 0&&o.size())a.attr("display","inline"),c.attr("display","inline");else{a=g.current.select("#shape-grip-group").append("line").attr("id","rotate-line").style("pointer-events","none");var i=z.rotateLine;Object.keys(i).forEach(function(P){a.attr(P,i[P])}),c=g.current.select("#shape-grip-group").append("circle").attr("id","rotate-circle").attr("class","w-svg-rotate").call(Rr("rotate",mr));var l=z.rotateCircle;Object.keys(l).forEach(function(P){c.attr(P,l[P])})}if(u.current){var s,v,h,p=(m==null||(s=m.current)===null||s===void 0?void 0:s.k)||1,d=(v=u.current)===null||v===void 0||(h=v.node())===null||h===void 0?void 0:h.getBBox(),b=d.x,S=d.y,R=d.width;b=b*p||0,S=S*p||0,R=R*p||0;var C=b+R/2;a.attr("x1",C).attr("y1",S-4).attr("x2",C).attr("y2",S-16),c.attr("cx",C).attr("cy",S-20)}}else(n=a)!==null&&n!==void 0&&n.size()&&(a.attr("display","none"),c.attr("display","none"))},Ce=function(){var r;(r=x.Ys(N.current).select("div>svg"))===null||r===void 0||r.remove(),g.current=x.Ys(N.current).selectChild("div").append("svg").attr("id","svgroot");var t=g.current.append("defs"),e=t.append("pattern").attr("id","gridPattern").attr("patternUnits","userSpaceOnUse").attr("x",0).attr("y",0).attr("width","10").attr("height","10"),n=e.append("rect");n.attr("fill","none").attr("stroke","#787878").attr("stroke-width","0.5").attr("x",0).attr("y",0).attr("width","100%").attr("height","100%"),j.current=g.current.append("svg").attr("id","svgcont"),j.current.append("g").attr("class","layer").attr("id","img").style("pointer-events","none"),j.current.append("g").attr("class","layer").attr("id","shape");var a=g.current.append("g").attr("id","shape-related-group"),c=a.append("rect").attr("id","shape-selector").attr("display","none").style("pointer-events","none"),o=Object.assign({},z.rect,z.selectBox);Object.keys(o).forEach(function(S){c.attr(S,o[S])});var i=a.append("path").attr("id","path-add-point").attr("display","none"),l=z.pathAddPoint;Object.keys(l).forEach(function(S){i.attr(S,l[S])});var s=a.append("g").attr("class","grip-layer").attr("id","shape-grip-group").attr("display","none"),v=s.append("path").attr("id","resize-path").style("pointer-events","none"),h=z.line;Object.keys(h).forEach(function(S){v.attr(S,h[S])});for(var p=0;p<8;p++)s.append("rect").attr("id","resize-grip-"+ht[p]).style("cursor",ht[p]+"-resize");var d=z.grip;Object.keys(d).forEach(function(S){x.td_("#shape-grip-group rect").attr(S,d[S])}),Lt(M.rotateEnable),a.append("g").attr("class","point_layer").attr("id","path-point-group"),a.append("g").attr("class","path_layer").attr("id","shape-path-group").style("pointer-events","none"),a.append("g").attr("class","label_layer").attr("id","shape-label-group").attr("display","none").style("pointer-events","none"),a.append("rect").attr("id","grid").attr("display","none").style("pointer-events","none").attr("x",0).attr("y",0).attr("width","0").attr("height","0").attr("fill","url(#gridPattern)").attr("stroke","none");var b=g.current.append("g").attr("class","crosshair_layer").style("pointer-events","none").attr("display","none");b.append("rect").attr("id","crosshair-v-line").attr("width",.5).attr("height","100%"),b.append("rect").attr("id","crosshair-h-line").attr("width","100%").attr("height",.5),b.selectAll("rect").attr("x",0).attr("y",0).attr("fill","#00f").attr("stroke","none")},Ir=function(){var r=N.current.getBoundingClientRect(),t=r.right-r.left||z.svg.width,e=r.bottom-r.top||z.svg.height,n=[t,e];z.svg.width=n[0],z.svg.height=n[1],x.Ys("#svgcanvas").style("width",t+"px").style("height",e+"px"),x.td_("#svgroot,#svgcont").attr("width",t).attr("height",e)},Ee=function(){g.current.on("mousemove touchmove",xt).call(Rr("whole",mr)).call(lt(function(r){Et(r)})).on("dblclick.zoom",null),x.td_("#shape-grip-group rect").call(Rr("grip",mr)),g.current.select("#path-add-point").call(Rr("insertPoint",mr))},Re=function(){B.current=x.jvg(),Ce(),Ir(),Ee(),ut(f.current.showCrosshair)},kt=function(){g.current.selectAll("g.layer,g#shape-related-group").attr("transform",null),m.current=null,g.current.call(lt().transform,x.CRH),f.current.changeScale("1")},Pt=function(){var r,t,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;cr.current=[],or.current=[],rr(),u.current&&(u.current=null),E.current&&(E.current=null),w.current={},e&&f.current.changeSize(fr()),H.current=[],f.current.changeSelect([]),(r=g.current.selectAll("#shape *"))===null||r===void 0||r.remove(),(t=g.current.selectAll("#shape-label-group *"))===null||t===void 0||t.attr("display","none")},Oe=function(){var r,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(r=j.current.select("g#img").select("image"))===null||r===void 0||r.remove(),Pt(t),kt()},Ye=function(r){var t,e,n=w.current[r].hide,a=(t=u.current)===null||t===void 0||(e=t.attr("id"))===null||e===void 0?void 0:e.substring(6);if(n=!n,w.current[r].hide=n,g.current.selectAll("g#shape #shape-".concat(r,",#shape-label-").concat(r)).attr("display",n?"none":"inline"),E.current&&E.current.includes(r)){var c,o=E.current.indexOf(r);if(E.current.splice(o,1),!((c=E.current)!==null&&c!==void 0&&c.length))E.current=null,x.td_("#shape-path-group *").attr("display","none"),f.current.changeSelect([]);else{var i;(i=x.Ys("#shape-path-".concat(E.current.length)))===null||i===void 0||i.attr("display","none"),Fr(),f.current.changeSelect(gr())}}else a&&a===r&&(rr(),u.current=null,f.current.changeSelect([]));f.current.changeSize(fr())},Dt=function(r){return r?(Ir(),new Promise(function(t){var e=new Image;e.onload=function(n){var a,c,o=n.target.width,i=n.target.height,l=o,s=i,v=0,h=0,p=1,d=z.svg,b=d.width,S=d.height,R=b/S,C=o/i;R>C?(s=S,l=s*C,p=i/s):(l=b,s=l/C,p=o/l),v=(b-l)/2,h=(S-s)/2,hr.current={x:v,y:h,scale:p,w:l,h:s},(a=j.current.select("g#img").select("image"))===null||a===void 0||a.remove(),(c=j.current.select("g#img").append("image").attr("width",l).attr("height",s).attr("x",v).attr("y",h).attr("xlink:href",r).attr("draggable","false"))===null||c===void 0||c.style("filter",Lr.current),Gr(),f.current.imgLoaded({width:o,height:i}),t(!0)},e.onerror=function(){f.current.imgLoaded(!1),t(!1)},e.src=r})):!1},Le=function(r){if(r){var t=Object.keys(w.current);t==null||t.forEach(function(e){var n=g.current.select("#shape-".concat(e));g.current.select("#shape-label-".concat(e)).attr("fill",n.attr("stroke"))})}},ke=function(r){g.current.select("#grid").attr("display",r&&(!m.current||m.current.k>=1)?"inline":"none"),Gr(!0)},ut=function(r){g.current.select(".crosshair_layer").attr("display",r&&M.drawTool!=="move"&&M.drawTool!=="drag"?"inline":"none")},Pe=function(r){var t;Lr.current=r,(t=j.current.select("#img image"))===null||t===void 0||t.style("filter",r)},De=function(r){g.current.select("#shape-label-group").attr("display",r?"inline":"none"),tt(!0),Le(r)},je=function(r,t){if(w.current[r]){w.current[r].label=t,g.current.select("#shape-label-".concat(r)).text(t),f.current.changeSize(fr());var e=f.current,n=e.colorBindLabel,a=e.curLabel;if(n){var c="",o=D.current[t];a?c=D.current[t]||ft(D.current):c=z.shapeCommon.stroke,Hr(r,c),o||(D.current[t]=c,f.current.changeBindColor(D.current))}}},Be=function(r){var t=+ir.current,e=0,n=f.current.scaleExtent;isNaN(r)?r==="enlarge"?(e=(n[1]-t)/20,e=e>.1?e:.2,t=t+e):r==="narrow"&&(e=(t-n[0])/5,t=t-e):t=+r,t=t<n[0]?n[0]:t,t=t>n[1]?n[1]:t,lt().scaleTo(g.current,t),m.current=x.P2S(g.current.node()),Et(m.current,!1)},Ae=function(r){if(!r||!(r!=null&&r.length))return[];var t=[];try{t=r.map(function(e){var n;if(!(e!=null&&e.attrs))return e;var a=e.attrs,c=e.shape_type,o=vt()(e,Vt);if(c.indexOf("rect")>=0){var i=a,l=i.x,s=i.y,v=i.width,h=i.height;return a=[[l,s],[l+v,s+h]],br()({points:a,shape_type:"rectangle"},o)}else if(c==="ellipse"){var p=a,d=p.cx,b=p.cy,S=p.rx,R=p.ry;return S===R?(a=[[d,b],[d,b+R]],br()({points:a,shape_type:"circle"},o)):(a=[[d,b],[d,b+R],[d+S,b]],br()({points:a,shape_type:"ellipse"},o))}return br()({points:(n=a)===null||n===void 0?void 0:n.points,shape_type:c},o)})}catch(e){console.error(e.toString())}return t},ze=function(r){if(!r||!(r!=null&&r.length))return[];var t=[];try{t=r.map(function(e,n){var a;if(e=br()(br()({},e),{},{id:"".concat(n+1)}),(a=e)!==null&&a!==void 0&&a.attrs)return e;var c=e,o=c.points,i=c.shape_type,l=vt()(c,qt);if(i.indexOf("rect")>=0){var s=o,v=J()(s,2),h=J()(v[0],2),p=h[0],d=h[1],b=J()(v[1],2),S=b[0],R=b[1],C=Math.abs(S-p),P=Math.abs(R-d),G=p,X=d;return G>S&&(G=S),X>R&&(X=R),o={x:G,y:X,width:C,height:P},br()({attrs:o,shape_type:"rect"},l)}else if(i==="circle"){var T=o,V=J()(T,2),_=J()(V[0],2),$=_[0],er=_[1],nr=J()(V[1],2),vr=nr[0],xr=nr[1],yr=Math.sqrt(Math.pow(vr-$,2)+Math.pow(xr-er,2));return o={cx:$,cy:er,rx:yr,ry:yr},br()({attrs:o,shape_type:"ellipse"},l)}else if(i==="ellipse"){var kr=o,lr=J()(kr,3),ur=J()(lr[0],2),Or=ur[0],Yr=ur[1],Sr=J()(lr[1],2),zr=Sr[1],Pr=J()(lr[2],1),Jr=Pr[0],Vr=zr-Yr,qr=Jr-Or;return o={cx:Or,cy:Yr,rx:qr,ry:Vr},br()({attrs:o,shape_type:"ellipse"},l)}else if(i==="polygon")return br()({attrs:{points:o},shape_type:i},l);return br()({attrs:{points:o},shape_type:"line"},l)})}catch(e){console.error(e.toString())}return t},Me=function(r,t,e,n,a,c){H.current.push(r),w.current[r]={label:e,shape_type:t,hide:n,attrs:a,rotate:c},e&&Qr(r,e,t!=="rect"),g.current.selectAll("g#shape #shape-".concat(r,",#shape-label-").concat(r)).attr("display",n?"none":"inline")},Je=function(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!(!r||!(r!=null&&r.length)))try{var e=hr.current,n=e.x,a=e.y,c=e.scale,o=j.current.select("#shape");r.forEach(function(i){var l=i.attrs,s=i.id,v=i.hide,h=i.label,p=i.shape_type,d=i.rotate,b=null,S=null,R=null;if(p==="rect"||p==="ellipse"){var C,P=Nr(p),G=l[P.x],X=l[P.y],T=l[P.w],V=l[P.h];if(!+T||!+V)return;s||(s=Er()),b=o.append(p).attr("id","shape-".concat(s)).call(Rr("shape",mr)),Xr(h);var _=Object.assign({},z.shapeCommon,z[p]);if(Object.keys(_).forEach(function(Wr){b.attr(Wr,_[Wr])}),G=+G/c+n,X=+X/c+a,T=T/c,V=V/c,b.attr(P.x,G).attr(P.y,X).attr(P.w,T).attr(P.h,V),S=(C={},Tr()(C,P.x,G),Tr()(C,P.y,X),Tr()(C,P.w,T),Tr()(C,P.h,V),C),d){var $=$r(s),er=$.centerX,nr=$.centerY;R=[d,er,nr],b.attr("transform","rotate(".concat(d," ").concat(er,",").concat(nr,")"))}}else{s||(s=Er()),Xr(h);var vr=l.points,xr=vr.length,yr=o.append("path").attr("id","shape-".concat(s)).call(Rr("shape",mr)),kr=Object.assign({},z.shapeCommon,z.path),lr=[];Object.keys(kr).forEach(function(Wr){yr.attr(Wr,kr[Wr])});for(var ur=0;ur<xr;ur++){var Or=J()(vr[ur],2),Yr=Or[0],Sr=Or[1];Yr=+Yr/c+n,Sr=+Sr/c+a,lr[ur]=[Yr,Sr];var zr="path-point-".concat(ur+1);ot(zr,ur,!1)}var Pr=B.current(lr);if(p==="polygon"&&(Pr+="Z"),yr.attr("d",Pr),S={points:lr},d){var Jr=$r(s),Vr=Jr.centerX,qr=Jr.centerY;R=[d,Vr,qr],yr.attr("transform","rotate(".concat(d," ").concat(Vr,",").concat(qr,")"))}}i.id=s,Me(s,p,h,v,S,R)}),f.current.changeBindColor(D.current),t&&f.current.changeSize(r)}catch(i){console.error(i.toString())}},Ne=function(){return cr.current.length>0},Fe=function(){return or.current.length>0},Ie=function(r){r&&!N.current&&(N.current=r)};return(0,I.useEffect)(function(){return N.current&&(Re(),window.addEventListener("resize",Ir)),function(){x.Ys("body").on("keyup",null),window.removeEventListener("resize",Ir)}},[]),(0,I.useEffect)(function(){M.src!==f.current.src&&Dt(M.src),M.drawTool!==f.current.drawTool&&(me(M.drawTool),ut(M.showCrosshair)),M.showLabel!==f.current.showLabel&&De(M.showLabel),M.showGrid!==f.current.showGrid&&ke(M.showGrid),M.showCrosshair!==f.current.showCrosshair&&ut(M.showCrosshair),M.rotateEnable!==f.current.rotateEnable&&Lt(M.rotateEnable),f.current=M},[M]),(0,I.useImperativeHandle)(K,function(){return{reload:Oe,zoomReload:kt,loadImg:Dt,clearShape:Pt,toggleShape:Ye,getMarkData:fr,selectShape:at,delSelectShape:it,getSelectIds:gr,editLabel:je,adjustImg:Pe,undoSvg:ie,canUndo:Ne,redoSvg:ce,canRedo:Fe,changeScale:Be,changeColor:te,drawShapeFromSize:Je,setCanvasSize:Ir,convertToPoints:Ae,convertToAttrs:ze}}),(0,Cr.jsxs)("div",{ref:Ie,className:"w-draw-container ".concat(f.current.className||""),onKeyDown:we,children:[(0,Cr.jsx)("div",{id:"svgcanvas",className:"w-svg-box",tabIndex:-1,onFocus:function(){return Yt(!0)},onBlur:function(){return Yt(!1)}}),M==null?void 0:M.children]})});pt.defaultProps={src:"",curLabel:"",showLabel:!1,showGrid:!1,showCrosshair:!1,minSize:[4,4],drawTool:"",scaleExtent:[.02,30],colorBindLabel:!0,rotateEnable:!1,changeSize:function(){},changeBindColor:function(){},changeSelect:function(){},changeScale:function(){},imgLoaded:function(){},endDraw:function(){}};var $t=pt,gt=function(K){var f=K.shapeList,N=K.selectShapeIds,g=K.delFunc,j=K.selectFunc,u=K.leftRender,O=K.rightRender,A=K.topRender,Y=K.title,L=K.className,B=(0,I.useRef)(null),m=(0,I.useState)([]),k=J()(m,2),Z=k[0],Q=k[1],U=(0,I.useRef)(-1),H=(0,I.useRef)(-1);(0,I.useEffect)(function(){Q(N)},[N]);var ir=function(){H.current=-1,U.current=-1;var F=f.length,w=N==null?void 0:N.length;if(!(!F||!w)){var q=tr()(N);q.sort(function(or,rr){return or-rr});for(var D=0;D<F;D++){var cr=f[D].id;cr===q[0]&&(U.current=D),cr===q[w-1]&&(H.current=D)}}},hr=function(F){F?(B.current.classList.add("box-active"),ir()):B.current.classList.remove("box-active")},E=function(F){j&&(F.length===1?j(F[0]):j(F))},wr=function(F){var w=F.keyCode||F.which||F.charCode;if(w===8||w===46){F==null||F.stopPropagation(),g&&g();return}if(F.ctrlKey&&w===65){F==null||F.stopPropagation();var q=f==null?void 0:f.map(function(rr){return rr==null?void 0:rr.id});Q(tr()(q)),E(q),H.current=f.length-1,U.current=0;return}var D=-1,cr=f.length-1;if(w===38&&(U.current>0||Z.length>1)?(D=U.current-1,D=D<0?0:D):w===40&&(H.current<cr||Z.length>1)&&(D=H.current+1,D=D>cr?cr:D),D!==-1){var or;F==null||F.stopPropagation(),Z=[(or=f[D])===null||or===void 0?void 0:or.id],Q(Z),E(Z),H.current=D,U.current=D}},Lr=function(F,w,q){q.stopPropagation();var D=tr()(Z),cr=D.indexOf(F);if(q.shiftKey){w<=U.current?U.current=w:H.current=w,U.current=U.current<0?0:U.current,D=[];for(var or=U.current;or<=H.current;or++){var rr;D.push((rr=f[or])===null||rr===void 0?void 0:rr.id)}}else if(q.ctrlKey)if(cr>=0){if(D.length===1)U.current=-1,H.current=-1;else if(w===U.current)for(var jr=U.current+1;jr<=H.current;jr++){var dr;if(D.includes((dr=f[jr])===null||dr===void 0?void 0:dr.id)){U.current=jr;break}}else if(w===H.current)for(var Er=H.current-1;Er>=U.current;Er--){var Nr;if(D.includes((Nr=f[Er])===null||Nr===void 0?void 0:Nr.id)){H.current=Er;break}}D.splice(cr,1)}else D.push(F),w<U.current&&(U.current=w),w>H.current&&(H.current=w);else D=[F],H.current=w,U.current=w;Q(D),E(D)},sr=function(){Z.length&&(Q([]),E([]),H.current=-1,U.current=-1)};return(0,Cr.jsxs)("div",{className:"win-box ".concat(L),children:[(0,Cr.jsxs)("div",{className:"w-head",children:[Y||"\u56FE\u5F62\u5217\u8868",(0,Cr.jsx)("div",{className:"flex-center",children:A&&A()})]}),(0,Cr.jsx)("div",{className:"w-box w-box-overflow",ref:B,tabIndex:-1,onFocus:function(){return hr(!0)},onBlur:function(){return hr(!1)},onClick:sr,onKeyDown:wr,children:f&&f.map(function(W,F){var w=W==null?void 0:W.id;return(0,Cr.jsxs)("div",{className:"list-item ".concat(Z.includes(w)?"on":""),onClick:function(D){return Lr(w,F,D)},children:[u&&u(W,F),(0,Cr.jsx)("p",{className:"list-txt",title:W==null?void 0:W.label,children:W==null?void 0:W.label}),O&&O(W,F)]},F)})})]})};gt.defaultProps={className:"",title:"",shapeList:[],selectShapeIds:[],leftRender:null,rightRender:null,topRender:null,delFunc:function(){},selectFunc:function(){}};var _t=gt}}]);
