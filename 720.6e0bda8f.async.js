"use strict";(self.webpackChunkw_react_label=self.webpackChunkw_react_label||[]).push([[720],{52720:function(Ke,dt,ir){ir.r(dt),ir.d(dt,{WColorBlock:function(){return zt},WDraw:function(){return re},WShapeList:function(){return te}});var jt=ir(5574),B=ir.n(jt),F=ir(67294),Er=ir(85893),vt=function(J){var d=J.colorBlocks,I=(0,F.useState)(d[0]),g=B()(I,2),A=g[0],u=g[1];(0,F.useEffect)(function(){J.color&&u(J.color)},[]);var O=function(D,L){u(D),J.onChange&&J.onChange(D,L)};return(0,Er.jsx)("div",{className:"w-color-block-box",children:d.map(function(Y,D){return(0,Er.jsx)("div",{onClick:function(k){return O(Y,k)},className:"w-color-block ".concat(Y===A?"on":""),style:{background:Y}},D)})})};vt.defaultProps={color:"",colorBlocks:["#f00","#FFA500","#ff0","#0f0","#0ff","#00f","#800080","#fff"],onChange:function(){}};var zt=vt,Mt=ir(9783),Gr=ir.n(Mt),Jt=ir(97857),xr=ir.n(Jt),Bt=ir(13769),ft=ir.n(Bt),Nt=ir(52677),It=ir.n(Nt),Ft=ir(61227),Wt=ir.n(Ft),Gt=ir(19632),er=ir.n(Gt),w=ir(46886),N={color:["#CB3D45","#DA833C","#2378DE"],svg:{width:800,height:600},shapeCommon:{fill:"rgba(0, 0, 0, 0)",stroke:"#CB3D45","stroke-width":2,"vector-effect":"non-scaling-stroke"},rect:{x:0,y:0,width:0,height:0},selectBox:{"stroke-width":1,fill:"rgb(34 34 204 / 12%)",stroke:"rgb(34 34 204 / 45%)","vector-effect":"non-scaling-stroke"},ellipse:{cx:0,cy:0,rx:0,ry:0},path:{d:""},line:{d:"",fill:"none",stroke:"#00f","stroke-width":1},point:{cx:0,cy:0,r:4,fill:"rgba(0,0,255,.45)",stroke:"rgba(0, 0, 0, 0)","stroke-width":10},grip:{width:8,height:8,fill:"rgba(0,0,255,.45)",stroke:"rgba(0, 0, 0, 0)","stroke-width":10},font:{x:0,y:0,fill:"#CB3D45",stroke:"none","font-size":16,"text-anchor":"start","dominant-baseline":"text-after-edge"},pathAddPoint:{fill:"none",stroke:"rgba(0,0,0,0)","stroke-width":25},rotateLine:{x1:0,y1:0,x2:0,y2:0,stroke:"rgba(0,0,255,.45)","stroke-width":1},rotateCircle:{cx:0,cy:0,r:5,fill:"rgba(0,0,255,.45)",stroke:"rgba(0, 0, 0, 0)","stroke-width":6}},Kt=["128, 0, 0","0, 128, 0","128, 128, 0","0, 0, 128","128, 0, 128","0, 128, 128","128, 128, 128","64, 0, 0","192, 0, 0","64, 128, 0","192, 128, 0","64, 0, 128","192, 0, 128","64, 128, 128","192, 128, 128","0, 64, 0","128, 64, 0","0, 192, 0","128, 192, 0","0, 64, 128","128, 64, 128","0, 192, 128","128, 192, 128","64, 64, 0","192, 64, 0","64, 192, 0","192, 192, 0","64, 64, 128","192, 64, 128","64, 192, 128","192, 192, 128","0, 0, 64","128, 0, 64","0, 128, 64","128, 128, 64","0, 0, 192","128, 0, 192","0, 128, 192","128, 128, 192","64, 0, 64","192, 0, 64","64, 128, 64","192, 128, 64","64, 0, 192","192, 0, 192","64, 128, 192","192, 128, 192","0, 64, 64","128, 64, 64","0, 192, 64","128, 192, 64","0, 64, 192","128, 64, 192","0, 192, 192","128, 192, 192","64, 64, 64","192, 64, 64","64, 192, 64","192, 192, 64","64, 64, 192","192, 64, 192","64, 192, 192","192, 192, 192","32, 0, 0","160, 0, 0","32, 128, 0","160, 128, 0","32, 0, 128","160, 0, 128","32, 128, 128","160, 128, 128","96, 0, 0","224, 0, 0","96, 128, 0","224, 128, 0","96, 0, 128","224, 0, 128","96, 128, 128","224, 128, 128","32, 64, 0","160, 64, 0","32, 192, 0","160, 192, 0","32, 64, 128","160, 64, 128","32, 192, 128","160, 192, 128","96, 64, 0","224, 64, 0","96, 192, 0","224, 192, 0","96, 64, 128","224, 64, 128","96, 192, 128","224, 192, 128","32, 0, 64","160, 0, 64","32, 128, 64","160, 128, 64","32, 0, 192","160, 0, 192","32, 128, 192","160, 128, 192","96, 0, 64","224, 0, 64","96, 128, 64","224, 128, 64","96, 0, 192","224, 0, 192","96, 128, 192","224, 128, 192","32, 64, 64","160, 64, 64","32, 192, 64","160, 192, 64","32, 64, 192","160, 64, 192","32, 192, 192","160, 192, 192","96, 64, 64","224, 64, 64","96, 192, 64","224, 192, 64","96, 64, 192","224, 64, 192","96, 192, 192","224, 192, 192","0, 32, 0","128, 32, 0","0, 160, 0","128, 160, 0","0, 32, 128","128, 32, 128","0, 160, 128","128, 160, 128","64, 32, 0","192, 32, 0","64, 160, 0","192, 160, 0","64, 32, 128","192, 32, 128","64, 160, 128","192, 160, 128","0, 96, 0","128, 96, 0","0, 224, 0","128, 224, 0","0, 96, 128","128, 96, 128","0, 224, 128","128, 224, 128","64, 96, 0","192, 96, 0","64, 224, 0","192, 224, 0","64, 96, 128","192, 96, 128","64, 224, 128","192, 224, 128","0, 32, 64","128, 32, 64","0, 160, 64","128, 160, 64","0, 32, 192","128, 32, 192","0, 160, 192","128, 160, 192","64, 32, 64","192, 32, 64","64, 160, 64","192, 160, 64","64, 32, 192","192, 32, 192","64, 160, 192","192, 160, 192","0, 96, 64","128, 96, 64","0, 224, 64","128, 224, 64","0, 96, 192","128, 96, 192","0, 224, 192","128, 224, 192","64, 96, 64","192, 96, 64","64, 224, 64","192, 224, 64","64, 96, 192","192, 96, 192","64, 224, 192","192, 224, 192","32, 32, 0","160, 32, 0","32, 160, 0","160, 160, 0","32, 32, 128","160, 32, 128","32, 160, 128","160, 160, 128","96, 32, 0","224, 32, 0","96, 160, 0","224, 160, 0","96, 32, 128","224, 32, 128","96, 160, 128","224, 160, 128","32, 96, 0","160, 96, 0","32, 224, 0","160, 224, 0","32, 96, 128","160, 96, 128","32, 224, 128","160, 224, 128","96, 96, 0","224, 96, 0","96, 224, 0","224, 224, 0","96, 96, 128","224, 96, 128","96, 224, 128","224, 224, 128","32, 32, 64","160, 32, 64","32, 160, 64","160, 160, 64","32, 32, 192","160, 32, 192","32, 160, 192","160, 160, 192","96, 32, 64","224, 32, 64","96, 160, 64","224, 160, 64","96, 32, 192","224, 32, 192","96, 160, 192","224, 160, 192","32, 96, 64","160, 96, 64","32, 224, 64","160, 224, 64","32, 96, 192","160, 96, 192","32, 224, 192","160, 224, 192","96, 96, 64","224, 96, 64","96, 224, 64","224, 224, 64","96, 96, 192","224, 96, 192","96, 224, 192","224, 224, 192","0,0,0"],$r=function(J){var d=isNaN(J)?Object.keys(J).length:J;return"rgb("+Kt[d]+")"},ht=["n","ne","e","se","s","sw","w","nw"],Tt=function(J){return!!(J.touches&&J.touches.length)},Xt=function(J,d){for(var I=arguments.length,g=new Array(I>2?I-2:0),A=2;A<I;A++)g[A-2]=arguments[A];var u={},O=g[0],Y=g[1],D=g[2],L=g[3];if(J==="rect"){if(u=Zt.apply(void 0,g),d){var k=L.width,m=L.height,W=u.width-u.height,H=O.indexOf("n")>=0&&D<=m||O.indexOf("s")>=0&&D<=-m,q=O.indexOf("e")>=0&&Y<=-k||O.indexOf("w")>=0&&Y<=k;W>0?(H&&(u.y=u.y-W),u.height=u.width):(q&&(u.x=u.x+W),u.width=u.height)}}else if(J==="ellipse"){if(u=Ht.apply(void 0,g),d){var Q=L.rx,G=L.ry,C=u.rx-u.ry,br=O.indexOf("n")>=0&&D<=G*2||O.indexOf("s")>=0&&D<=-G*2,fr=O.indexOf("e")>=0&&Y<=-Q*2||O.indexOf("w")>=0&&Y<=Q*2;C>0?(br&&(C=-C),u.ry=u.rx,u.cy=u.cy+C):(fr&&(C=-C),u.cx=u.cx-C,u.rx=u.ry)}}else u=Ut.apply(void 0,[d].concat(g));return u},Zt=function(){for(var J=arguments.length,d=new Array(J),I=0;I<J;I++)d[I]=arguments[I];var g=d[0],A=d[1],u=d[2],O=d[3],Y=O.x,D=O.y,L=O.width,k=O.height,m=L,W=k;return g.indexOf("n")>=0?(W=k-u,W>0?D=D+u:D=D+k,W=Math.abs(W)):g.indexOf("s")>=0&&(W=k+u,W<0&&(D=D+k+u),W=Math.abs(W)),g.indexOf("w")>=0?(m=L-A,m<0?Y=Y+L:Y=Y+A,m=Math.abs(m)):g.indexOf("e")>=0&&(m=L+A,m<0&&(Y=Y+L+A),m=Math.abs(m)),{x:Y,y:D,width:m,height:W}},Ht=function(){for(var J=arguments.length,d=new Array(J),I=0;I<J;I++)d[I]=arguments[I];var g=d[0],A=d[1],u=d[2],O=d[3],Y=O.cx,D=O.cy,L=O.rx,k=O.ry;return A=A/2,u=u/2,g.indexOf("n")>=0?(k=k-u,D=D+u,k=Math.abs(k)):g.indexOf("s")>=0&&(k=k+u,D=D+u,k=Math.abs(k)),g.indexOf("w")>=0?(L=L-A,Y=Y+A,L=Math.abs(L)):g.indexOf("e")>=0&&(L=L+A,Y=Y+A,L=Math.abs(L)),{cx:Y,cy:D,rx:L,ry:k}},Ut=function(J){for(var d=arguments.length,I=new Array(d>1?d-1:0),g=1;g<d;g++)I[g-1]=arguments[g];var A=I[0],u=I[1],O=I[2],Y=I[3],D=Y.points,L=Y.boundRect,k=(D==null?void 0:D.length)||0,m=[],W=L.x,H=L.y,q=L.width,Q=L.height,G=q/Q,C=A.indexOf("n")>=0,br=A.indexOf("s")>=0,fr=A.indexOf("w")>=0,_=A.indexOf("e")>=0,lr="";J&&(A.length===1?(C||br?(u=O*G,lr="v"):(O=u/G,lr="h"),C?u=-u:fr&&(O=-O)):(O=u/G,(fr&&br||_&&C)&&(O=-O)));for(var Dr=0;Dr<k;Dr++){var X=er()(D[Dr]),M=Math.abs(X[0]-W)/q,U=Math.abs(X[1]-H)/Q;C&&(X[1]+=O*(1-U)),(br||lr==="h")&&(X[1]+=O*U),fr&&(X[0]+=u*(1-M)),(_||lr==="v")&&(X[0]+=u*M),m.push(X)}return{points:m}},Qt=function(J,d,I){var g=B()(J,2),A=g[0],u=g[1],O=B()(d,2),Y=O[0],D=O[1],L=B()(I,2),k=L[0],m=L[1],W=k-Y,H=m-D,q=((A-Y)*W+(u-D)*H)/(W*W+H*H);return q<0?(W=A-Y,H=u-D):q>1?(W=A-k,H=u-m):(W=A-(Y+q*W),H=u-(D+q*H)),Math.sqrt(W*W+H*H)},Vt=function(J,d){return J.bottom>d.top&&J.top<d.bottom&&J.left<d.right&&J.right>d.left},Kr=function(J,d,I,g,A,u){var O=A*Math.PI/180;u&&(O=-O);var Y=Math.cos(O),D=Math.sin(O),L=J-I,k=d-g,m=L*Y-k*D+I,W=L*D+k*Y+g;return[m,W]},qt=function(J,d,I,g,A,u,O,Y){var D=J+I/2,L=d+g/2,k=Kr(D,L,A,u,O,Y),m=B()(k,2),W=m[0],H=m[1],q=W-D,Q=H-L;return{changeX:q,changeY:Q}},$t=["attrs","shape_type"],_t=["points","shape_type"],pt=(0,F.forwardRef)(function(z,J){var d=(0,F.useRef)(z),I=(0,F.useRef)(null),g=(0,F.useRef)(null),A=(0,F.useRef)(null),u=(0,F.useRef)(null),O=(0,F.useRef)(null),Y=(0,F.useRef)(null),D=(0,F.useRef)(null),L=(0,F.useRef)(""),k=(0,F.useRef)(null),m=(0,F.useRef)(null),W=(0,F.useRef)(null),H=(0,F.useRef)(!1),q=(0,F.useRef)(!1),Q=(0,F.useRef)(!1),G=(0,F.useRef)(null),C=(0,F.useRef)(null),br=(0,F.useRef)("1"),fr=(0,F.useRef)({x:0,y:0,scale:1,w:0,h:0}),_=(0,F.useRef)({x:0,y:0,w:0,h:0,mx:0,my:0}),lr=(0,F.useRef)([]),Dr=(0,F.useRef)(""),X=(0,F.useRef)(!1),M=(0,F.useRef)(!1),U=(0,F.useRef)(!1),R=(0,F.useRef)({}),j=(0,F.useRef)(null),$=(0,F.useRef)({}),cr=(0,F.useRef)([]),or=(0,F.useRef)([]),ur=function(){var r;(r=w.td_("#shape-grip-group,#path-point-group *,#shape-path-group *,#path-add-point"))===null||r===void 0||r.attr("display","none"),D.current="",Y.current&&(w.Ys("#"+Y.current).attr("fill",N.shapeCommon.fill),Y.current=""),L.current&&(w.Ys("#"+L.current).attr("fill",N.grip.fill),L.current=""),k.current&&(w.Ys("#path-point-"+k.current).attr("fill",N.point.fill),k.current="")},Jr=function(){if(document.getElementById("svgcanvas")!==document.activeElement){var r;(r=document.getElementById("svgcanvas"))===null||r===void 0||r.focus()}},sr=function(r){var e=(r==null?void 0:r.sourceEvent)||r,t=[];if(Tt(e)?t=w.cx$(e.touches[0]||e.changedTouches[0],g.current.node()):t=w.cx$(e,g.current.node()),C.current){var n=C.current,a=n.x,c=n.y,o=n.k;t[0]=(t[0]-a)/o,t[1]=(t[1]-c)/o}return t},Rr=function(){for(var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,e=lr.current.length||0,t=0,n=0;n<e;n++)if(+lr.current[n]!==n+1){t=n+1;break}return t===0&&(t=e+1),t=""+t,r&&lr.current.splice(t-1,0,t),t},ee=function(r){return r==="ellipse"?{x:"cx",y:"cy",w:"rx",h:"ry"}:{x:"x",y:"y",w:"width",h:"height"}},ne=function(){var r=d.current.drawTool,e=z.minSize,t=0,n=0;return r==="rect"?(t=O.current.attr("width"),n=O.current.attr("height")):r==="ellipse"&&(t=O.current.attr("rx")*2||0,n=O.current.attr("ry")*2||0),+t<=e[0]||+n<=e[1]?(O.current.remove(),O.current=null,w.Ys("#shape-grip-group").attr("display","none"),!0):!1},_r=function(r){var e,t,n=w.Ys("#shape-".concat(r));if(!n)return{};var a=n==null||(e=n.node())===null||e===void 0?void 0:e.getBBox(),c=(C==null||(t=C.current)===null||t===void 0?void 0:t.k)||1,o=a.x,i=a.y,l=a.width,s=a.height,v=o+l/2,h=i+s/2,p=v*c,f=h*c;return{centerX:v,centerY:h,gripCenterX:p,gripCenterY:f}},rt=function(){var r,e,t,n;if(u.current){var a=(r=u.current.attr("id"))===null||r===void 0?void 0:r.substring(6),c=(e=R.current[a])===null||e===void 0?void 0:e.rotate;if(c){var o=B()(c,3),i=o[0],l=o[1],s=o[2],v=(t=u.current)===null||t===void 0||(n=t.node())===null||n===void 0?void 0:n.getBBox(),h=v.x,p=v.y,f=v.width,b=v.height,S=qt(h,p,f,b,l,s,i),E=S.changeX,x=S.changeY;return ot([E,x]),[E,x]}}},Ar=function(){var r,e,t,n,a;if(!u.current||q.current||D.current)return!1;var c=(r=u.current.attr("id"))===null||r===void 0?void 0:r.substring(6),o=(e=R.current)===null||e===void 0?void 0:e[c],i=o.hide,l=o.rotate,s=w.Ys("#shape-grip-group");if(s.attr("display",i?"none":"inline"),!i){var v=(C==null||(t=C.current)===null||t===void 0?void 0:t.k)||1,h=(n=u.current)===null||n===void 0||(a=n.node())===null||a===void 0?void 0:a.getBBox(),p=h.x,f=h.y,b=h.width,S=h.height,E=N.grip.width/2,x=N.grip.height/2;if(p=p*v||0,f=f*v||0,b=b*v||0,S=S*v||0,d.current.rotateEnable){var P=p+b/2;s.select("#rotate-line").attr("x1",P).attr("y1",f-4).attr("x2",P).attr("y2",f-16),s.select("#rotate-circle").attr("cx",P).attr("cy",f-20)}if(l){var K=B()(l,3),Z=K[0],T=K[1],V=K[2],tr=T*v,rr=V*v;s.attr("transform","rotate(".concat(Z," ").concat(tr,",").concat(rr,")")),u.current.attr("transform","rotate(".concat(Z," ").concat(T,",").concat(V,")"))}else s.attr("transform",null);var nr=[[p,f],[p+b,f],[p+b,f+S],[p,f+S]],ar=G.current(nr);w.Ys("#resize-path").attr("d",ar+"Z"),s.select("#resize-grip-nw").attr("x",p-E).attr("y",f-x),s.select("#resize-grip-n").attr("x",p+b/2-E).attr("y",f-x),s.select("#resize-grip-ne").attr("x",p+b-E).attr("y",f-x),s.select("#resize-grip-w").attr("x",p-E).attr("y",f+S/2-x),s.select("#resize-grip-e").attr("x",p+b-E).attr("y",f+S/2-x),s.select("#resize-grip-sw").attr("x",p-E).attr("y",f+S-x),s.select("#resize-grip-s").attr("x",p+b/2-E).attr("y",f+S-x),s.select("#resize-grip-se").attr("x",p+b-E).attr("y",f+S-x)}},yt=function(r){var e,t;if(!j.current){for(var n=(e=R.current)===null||e===void 0?void 0:e[r],a=n.attrs.points,c=n.shape_type,o=a.length,i=(C==null||(t=C.current)===null||t===void 0?void 0:t.k)||1,l=[],s=0;s<o;s++){var v=B()(a[s],2),h=v[0],p=v[1];h=h*i,p=p*i,l[s]=[h,p]}var f=G.current(l);c==="polygon"&&(f+="Z"),g.current.select("#path-add-point").attr("d",f)}},tt=function(r){var e,t=j.current||[],n=t.length;if(!(!q.current||!n)){var a=(C==null||(e=C.current)===null||e===void 0?void 0:e.k)||1,c=B()(t[n-1],2),o=c[0],i=c[1],l=sr(r),s=B()(l,2),v=s[0],h=s[1];o=o*a,i=i*a,v=v*a,h=h*a;var p=[[o,i],[v,h]],f=G.current(p);w.Ys("#path-stretch-line").attr("d",f)}},jr=function(r){var e,t,n,a,c,o;if(!u.current||!u.current.attr("id"))return!1;var i=(e=u.current.attr("id"))===null||e===void 0?void 0:e.substring(6),l=((t=R.current)===null||t===void 0||(n=t[i])===null||n===void 0||(a=n.attrs)===null||a===void 0?void 0:a.points)||j.current||[],s=l.length,v=(C==null||(c=C.current)===null||c===void 0?void 0:c.k)||1;if(s){yt(i);for(var h=0;h<s;h++){var p=w.Ys("#path-point-group #path-point-".concat(h+1)),f=B()(l[h],2),b=f[0],S=f[1];b=b*v,S=S*v,p.attr("cx",b).attr("cy",S),(q.current||D.current)&&p.attr("display","inline")}if(r&&tt(r),!q.current){var E=(o=R.current)===null||o===void 0?void 0:o[i],x=E.rotate;if(x){var P=B()(x,3),K=P[0],Z=P[1],T=P[2],V=Z*v,tr=T*v,rr="rotate(".concat(K," ").concat(V,",").concat(tr,")");w.Ys("#path-point-group").attr("transform",rr),w.Ys("#path-add-point").attr("transform",rr),u.current.attr("transform","rotate(".concat(K," ").concat(Z,",").concat(T,")"))}else w.Ys("#path-point-group").attr("transform",null),w.Ys("#path-add-point").attr("transform",null)}}},Tr=function(r){var e=r?z.showGrid:d.current.showGrid;if(e)if(C.current=C.current||w.CRH,C.current.k<1)g.current.select("#grid").attr("display","none");else{var t=fr.current,n=t.x,a=t.y,c=t.w,o=t.h,i=C.current.k,l=10*i,s=n*i,v=a*i;g.current.select("#gridPattern").attr("width",l).attr("height",l).attr("x",s).attr("y",v),g.current.select("#grid").attr("display","inline").attr("x",s).attr("y",v).attr("width",c*i).attr("height",o*i)}},Xr=function(r){var e=d.current,t=e.curLabel,n=e.colorBindLabel,a=0,c="";n?(a=r||t,a||(a=Rr(!1)),c=$.current[a]||$r($.current)):c=$.current[a]||$r(a),N.shapeCommon.stroke=c,N.font.fill=c,r&&($.current[a]=c)},Zr=function(r){var e=r||N.shapeCommon.stroke;return w.$_Y(e).copy({opacity:.2})},Hr=function(r,e){var t=w.Ys("#shape-".concat(r));t.attr("stroke",e),d.current.showLabel&&g.current.select("#shape-label-".concat(r)).attr("fill",e),Y.current==="shape-"+r&&t.attr("fill",Zr(e))},ae=function(r){var e;if(d.current.colorBindLabel){var t,n,a;if(m.current||!u.current)return;var c=(t=u.current.attr("id"))===null||t===void 0?void 0:t.substring(6),o=(n=R.current)===null||n===void 0?void 0:n[c],i=o.label;(a=Object.keys(R.current))===null||a===void 0||a.forEach(function(v){var h=R.current[v].label;h===i&&Hr(v,r)}),$.current[i]=r,d.current.changeBindColor($.current);return}if($.current[0]=r,d.current.changeBindColor($.current),m.current){var l;(l=m.current)===null||l===void 0||l.forEach(function(v){Hr(v,r)});return}if(u.current){var s=(e=u.current.attr("id"))===null||e===void 0?void 0:e.substring(6);Hr(s,r)}},zr=function(r,e,t){var n;if(e){var a=(C==null||(n=C.current)===null||n===void 0?void 0:n.k)||1,c=R.current[r],o=c.shape_type,i=c.attrs,l=c.rotate,s=g.current.select("#shape-label-".concat(r)),v=0,h=0;if(o==="ellipse"){var p=i.cx,f=i.cy,b=i.ry;v=p,h=f-b}else if(o==="rect")v=i.x,h=i.y;else{var S=i.points,E=B()(S[0],2);v=E[0],h=E[1];for(var x=1;x<S.length;x++){var P=B()(S[x],2),K=P[0],Z=P[1];h>Z?(h=Z,v=K):h===Z&&v>K&&(v=K)}}if(v=v*a||0,h=h*a||0,s.attr("x",v).attr("y",h),t&&s.attr("fill",N.font.fill),l){var T=B()(l,3),V=T[0],tr=T[1],rr=T[2],nr=tr*a,ar=rr*a;s.attr("transform","rotate(".concat(V," ").concat(nr,",").concat(ar,")"))}}},et=function(r){var e=r?z.showLabel:d.current.showLabel;if(e){var t=Object.keys(R.current);t==null||t.forEach(function(n){zr(n,e)})}},pr=function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];cr.current.push(e),or.current=[]},Ur=function(){var r=[],e={};if(m.current){var t,n={};(t=m.current)===null||t===void 0||t.forEach(function(i){var l=w.Ys("#shape-".concat(i));e[i]=JSON.parse(JSON.stringify(R.current[i])),n[i]=l}),r=[m.current,e,n]}else if(u.current){var a,c,o=(a=u.current)===null||a===void 0||(c=a.attr("id"))===null||c===void 0?void 0:c.substring(6);e[o]=JSON.parse(JSON.stringify(R.current[o])),r=[u.current,e]}return r},nt=function(r){var e,t,n,a=(e=u.current)===null||e===void 0||(t=e.attr("id"))===null||t===void 0?void 0:t.substring(6),c=(n=R.current)===null||n===void 0?void 0:n[a],o=c.attrs,i=c.shape_type,l=c.rotate;if(_.current=o,i==="polygon"||i==="line"){var s,v;_.current.boundRect=(s=u.current)===null||s===void 0||(v=s.node())===null||v===void 0?void 0:v.getBBox(),_.current.close=i==="polygon"}var h=sr(r);if(l){var p=B()(l,3),f=p[0],b=p[1],S=p[2];h=Kr.apply(void 0,er()(h).concat([b,S,f,!0]))}var E=h,x=B()(E,2);_.current.mx=x[0],_.current.my=x[1]},hr=function(){var r=Object.keys(R.current),e=[],t=fr.current,n=t.x,a=t.y,c=t.scale;return r==null||r.forEach(function(o){var i=R.current[o],l=i.attrs,s=i.label,v=i.shape_type,h=i.hide,p=i.rotate,f={};if(f.label=s||o,f.shape_type=v,f.attrs={},f.hide=h||!1,f.id=o,p&&(f.rotate=p[0]),v==="rect")f.attrs.x=(l.x-n)*c,f.attrs.y=(l.y-a)*c,f.attrs.width=l.width*c,f.attrs.height=l.height*c;else if(v==="ellipse")f.attrs.cx=(l.cx-n)*c,f.attrs.cy=(l.cy-a)*c,f.attrs.rx=l.rx*c,f.attrs.ry=l.ry*c;else{var b;f.attrs.points=[],(b=l.points)===null||b===void 0||b.forEach(function(S,E){f.attrs.points[E]=[(S[0]-n)*c,(S[1]-a)*c]})}e.push(f)}),e},ie=function(r){var e=(r==null?void 0:r.target)||(r==null?void 0:r.srcElement),t=w.Ys(e).attr("id"),n=null,a=d.current.drawTool;L.current||k.current?n="crosshair":X.current&&!M.current&&!U.current||a==="drag"?n="grab":t==="path-add-point"?n="pointer":u.current&&!q.current&&Y.current===t||m.current&&m.current.includes(t==null?void 0:t.substring(6))?n="move":(!a||a==="move")&&(n="default"),w.Ys(I.current).style("cursor",n)},ce=function(r){d.current.showCrosshair&&(g.current.select("#crosshair-v-line").attr("x",r.layerX),g.current.select("#crosshair-h-line").attr("y",r.layerY))},at=function(r){var e=w.Ys("#shape-path-group #shape-path-".concat(r));if(e.node())e.attr("display","inline").attr("transform",null);else{e=w.Ys("#shape-path-group").append("path").attr("id","shape-path-".concat(r)).style("pointer-events","none");var t=N.line;Object.keys(t).forEach(function(n){e.attr(n,t[n])})}return e},Ir=function(){var r,e,t=(C==null||(r=C.current)===null||r===void 0?void 0:r.k)||1;(e=m.current)===null||e===void 0||e.forEach(function(n,a){var c,o=w.Ys("#shape-".concat(n)),i=o.node().getBBox(),l=i.x,s=i.y,v=i.width,h=i.height,p=at(a);l=l*t||0,s=s*t||0,v=v*t||0,h=h*t||0;var f=[[l-2,s-2],[l+v+2,s-2],[l+v+2,s+h+2],[l-2,s+h+2]],b=G.current(f);p.attr("d",b+"Z");var S=(c=R.current)===null||c===void 0?void 0:c[n],E=S.rotate;if(E){var x=B()(E,3),P=x[0],K=x[1],Z=x[2],T=K*t,V=Z*t;o.attr("transform","rotate(".concat(P," ").concat(K,",").concat(Z,")")),p.attr("transform","rotate(".concat(P," ").concat(T,",").concat(V,")"))}})},gr=function(){var r,e,t;return(r=m.current)!==null&&r!==void 0&&r.length?m.current:u.current?[(e=u.current)===null||e===void 0||(t=e.attr("id"))===null||t===void 0?void 0:t.substring(6)]:[]},it=function(r,e){var t,n,a,c=e,o=r,i="",l="";if(o instanceof Array)m.current=o,c=!0;else if(typeof o=="string")i="shape-"+o,o=g.current.select("#".concat(i));else{var s,v;i=(s=o)===null||s===void 0?void 0:s.attr("id"),l=(v=u.current)===null||v===void 0?void 0:v.attr("id")}if(c&&(l&&i!==l||m.current)){var h,p;if(u.current=null,i=(h=i)===null||h===void 0?void 0:h.substring(6),m.current)if(i){var b=m.current.indexOf(i);if(b>=0){var S;m.current.splice(b,1),(S=m.current)!==null&&S!==void 0&&S.length||(m.current=null)}else m.current.push(i);d.current.changeSelect(gr())}else d.current.changeSelect(gr());else{var f;l=(f=l)===null||f===void 0?void 0:f.substring(6),m.current=[i,l],d.current.changeSelect(gr())}(p=m.current)===null||p===void 0||p.forEach(function(V,tr){at(tr)}),ur(),Ir();return}u.current=o,(t=w.td_("#shape-path-group *"))===null||t===void 0||t.attr("display","none"),m.current=null;var E=(n=R.current)===null||n===void 0?void 0:n[(a=i)===null||a===void 0?void 0:a.substring(6)],x=E.shape_type,P=E.hide;if(Y.current&&w.Ys("#"+Y.current).attr("fill",N.shapeCommon.fill),Y.current===i)Y.current="",(x==="line"||x==="polygon")&&(D.current="",g.current.selectAll("#path-point-group circle,#path-add-point").attr("display","none"),Ar());else if(Y.current!==i)if(Y.current=i,o.attr("fill",Zr(o.attr("stroke"))),x==="line"||x==="polygon"){var K;if(D.current=i,(K=g.current.selectAll("#path-point-group circle,#shape-grip-group"))===null||K===void 0||K.attr("display","none"),P){var Z;(Z=g.current.select("#path-add-point"))===null||Z===void 0||Z.attr("display","none")}else{var T;(T=g.current.select("#path-add-point"))===null||T===void 0||T.attr("display","inline"),jr()}}else D.current="",g.current.selectAll("#path-point-group circle,#path-add-point").attr("display","none"),Ar();d.current.changeSelect(gr())},Br=function(r){var e,t,n,a=r||u.current;if(a){ur();var c=(e=a.attr("id"))===null||e===void 0?void 0:e.substring(6),o=lr.current.indexOf(c);lr.current.splice(o,1),a==null||a.remove(),(t=g.current.select("#shape-label-".concat(c)))===null||t===void 0||t.attr("display","none"),u.current=null,j.current=null,(n=R.current)===null||n===void 0||delete n[c]}},ct=function(){var r,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t={};if(m.current){var n,a={};return(n=m.current)===null||n===void 0||n.forEach(function(o){var i=w.Ys("#shape-".concat(o));t[o]=JSON.parse(JSON.stringify(R.current[o])),a[o]=i,Br(i)}),e&&pr("del",m.current,t,a),m.current=null,d.current.changeSize(hr()),d.current.changeSelect(gr()),[t,a]}if(u.current){var c=(r=u.current.attr("id"))===null||r===void 0?void 0:r.substring(6);return t[c]=JSON.parse(JSON.stringify(R.current[c])),e&&pr("del",u.current,t),Br(),d.current.changeSize(hr()),d.current.changeSelect(gr()),[t]}},oe=function(){var r,e;if(!(!k.current||!u.current)){var t=(r=u.current.attr("id"))===null||r===void 0?void 0:r.substring(6),n=((e=R.current)===null||e===void 0?void 0:e[t])||{},a=n.attrs.points,c=n.shape_type,o=a.length,i={};if(i[t]=JSON.parse(JSON.stringify(R.current[t])),o<=2){pr("del",u.current,i),Br(),ur();return}pr("edit",u.current,i),w.Ys("#path-point-group #path-point-".concat(o)).attr("display","none"),w.Ys("#path-point-group #path-point-".concat(k.current)).attr("fill",N.point.fill),a.splice(k.current-1,1),k.current=null;var l=G.current(a);c==="polygon"&&(l+="Z"),u.current.attr("d",l),zr(t,d.current.showLabel),jr()}},St=function(r,e){var t=e.shape_type,n=e.attrs,a=e.rotate;if(t==="rect"||t==="ellipse"){var c=Object.keys(n);c==null||c.forEach(function(l){r.attr(l,n[l])})}else{var o=n.points,i=G.current(o);t==="polygon"&&(i+="Z"),r.attr("d",i)}a?r.attr("transform","rotate(".concat(a[0]," ").concat(a[1],",").concat(a[2],")")):r.attr("transform",null)},mt=function(r){var e=r||[],t=Wt()(e),n=t[0],a=t.slice(1),c=B()(a,3),o=c[0],i=c[1],l=c[2],s=[];if(n==="add")o instanceof Array?m.current=o:(m.current=null,u.current=o),s=ct(!1);else if(n==="del"){if(o instanceof Array)o==null||o.forEach(function(x){var P;lr.current.splice(x-1,0,+x),(P=g.current.select("#shape-label-".concat(x)))===null||P===void 0||P.attr("display","inline"),g.current.select("#shape").insert(function(){return l[x].node()})});else{var v,h,p=(v=Object.keys(i))===null||v===void 0?void 0:v[0];lr.current.splice(p-1,0,p),(h=g.current.select("#shape-label-".concat(p)))===null||h===void 0||h.attr("display","inline"),g.current.select("#shape").insert(function(){return o.node()})}R.current=Object.assign({},R.current,i)}else if(n==="edit"){var f={};if(o instanceof Array)o==null||o.forEach(function(x){f[x]=JSON.parse(JSON.stringify(R.current[x])),St(l[x],i[x])}),s=[f,l];else{var b,S,E=(b=o.attr("id"))===null||b===void 0?void 0:b.substring(6);f[E]=JSON.parse(JSON.stringify(R.current[E])),St(o,(S=Object.values(i))===null||S===void 0?void 0:S[0]),s=[f]}R.current=Object.assign({},R.current,i)}return m.current=null,u.current=null,d.current.changeSize(hr()),d.current.changeSelect([]),ur(),et(),n==="del"?[o]:[o].concat(er()(s))},le=function(){if(cr.current.length){var r=cr.current.pop(),e=r||[],t=B()(e,1),n=t[0],a=mt(r);if(n==="add"){or.current.push(["del"].concat(er()(a)));return}else n==="del"?or.current.push(["add"].concat(er()(a))):n==="edit"&&or.current.push([n].concat(er()(a)))}},ue=function(){if(or.current.length){var r=or.current.pop(),e=r||[],t=B()(e,1),n=t[0],a=mt(r);if(n==="add")cr.current.push(["del"].concat(er()(a)));else if(n==="del"){cr.current.push(["add"].concat(er()(a)));return}else n==="edit"&&cr.current.push([n].concat(er()(a)))}},bt=function(r,e){var t,n=e||u.current;if(n){var a=d.current.showLabel,c=B()(r,2),o=c[0],i=c[1],l=n==null||(t=n.attr("id"))===null||t===void 0?void 0:t.substring(6),s=R.current[l],v=s.attrs,h=s.shape_type,p=s.rotate,f={};if(h==="rect"){var b=v.x,S=v.y,E=v.width,x=v.height;b+=o,S+=i,n.attr("x",b).attr("y",S),f={x:b,y:S,width:E,height:x}}else if(h==="ellipse"){var P=v.cx,K=v.cy,Z=v.rx,T=v.ry;P+=o,K+=i,n.attr("cx",P).attr("cy",K),f={cx:P,cy:K,rx:Z,ry:T}}else{for(var V=v.points,tr=h==="polygon",rr=(V==null?void 0:V.length)||0,nr=[],ar=0;ar<rr;ar++){var yr=B()(V[ar],2),Cr=yr[0],Sr=yr[1];Cr+=o,Sr+=i,nr[ar]=[Cr,Sr]}var kr=G.current(nr);n.attr("d",kr+(tr?"Z":"")),f={points:nr},nr=null}if(p){var dr,vr=n==null||(dr=n.node())===null||dr===void 0?void 0:dr.getBBox(),Yr=vr.x,Lr=vr.y,mr=vr.width,Mr=vr.height,Pr=Yr+mr/2,Nr=Lr+Mr/2;R.current[l].rotate[1]=Pr,R.current[l].rotate[2]=Nr}R.current[l].attrs=f,m.current?Ir():h==="rect"||h==="ellipse"?Ar():jr(),zr(l,a)}},ot=function(r){if(m.current){var e;(e=m.current)===null||e===void 0||e.forEach(function(t){var n=w.Ys("#shape-".concat(t));bt(r,n)});return}bt(r)},Qr=function(r,e,t){var n=g.current.select("#shape-label-".concat(r)),a=d.current.showLabel;if(n.node()){n.text(e).attr("display","inline"),zr(r,a,!0);return}var c=g.current.select("#shape-label-group").append("text").attr("id","shape-label-".concat(r)).style("user-select","none").text(e),o=Object.assign({},N.font);t&&(o["text-anchor"]="middle"),Object.keys(o).forEach(function(i){c.attr(i,o[i])}),zr(r,a)},se=function(r){var e,t;if(u.current){var n=(e=u.current)===null||e===void 0||(t=e.attr("id"))===null||t===void 0?void 0:t.substring(6),a=_r(n),c=a.centerX,o=a.centerY,i=a.gripCenterX,l=a.gripCenterY,s=r[0]-c,v=o-r[1],h=Math.atan2(v,s)*180/Math.PI;h<-90?h=-270-h:h=90-h,u.current.attr("transform","rotate(".concat(h," ").concat(c,",").concat(o,")")),g.current.select("#shape-grip-group").attr("transform","rotate(".concat(h," ").concat(i,",").concat(l,")")),d.current.showLabel&&g.current.select("#shape-label-".concat(n)).attr("transform","rotate(".concat(h," ").concat(i,",").concat(l,")")),R.current[n].rotate=[h,c,o]}},wr=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];var a=t[0],c=t[1],o=sr(a),i=o[0]-_.current.mx,l=o[1]-_.current.my;if(r==="moveGrip"){var s,v,h,p="",f=(s=u.current)===null||s===void 0||(v=s.attr("id"))===null||v===void 0?void 0:v.substring(6),b=(h=R.current)===null||h===void 0?void 0:h[f],S=b.shape_type,E=b.rotate;if(E){var x=B()(E,3),P=x[0],K=x[1],Z=x[2];o=Kr.apply(void 0,er()(o).concat([K,Z,P,!0])),i=o[0]-_.current.mx,l=o[1]-_.current.my}L.current?p=L.current.substring(12):p=c.attr("id").substring(12);var T=Xt(S,M.current,p,i,l,_.current);if(S==="polygon"||S==="line"){var V=G.current(T.points);u.current.attr("d",V+(_.current.close?"Z":""))}else Object.keys(T).forEach(function(Pr){u.current.attr(Pr,T[Pr])});R.current[f].attrs=T,Ar(),zr(f,d.current.showLabel),L.current&&E&&(rt(),w.Ys("#"+L.current).attr("fill",N.grip.fill),L.current=null);return}if(r==="moveShape"){ot([a.dx,a.dy]);return}if(r==="moveWhole"){var tr,rr;C.current=C.current.translate(i,l),w.sPX().transform(g.current,C.current),g.current.selectAll("g.layer").attr("transform",C.current),g.current.selectAll("g#shape-related-group").attr("transform","translate(".concat((tr=C.current)===null||tr===void 0?void 0:tr.x,",").concat((rr=C.current)===null||rr===void 0?void 0:rr.y,")")),Tr();return}if(r==="movePoint"){var nr,ar,yr,Cr="",Sr=(nr=u.current)===null||nr===void 0||(ar=nr.attr("id"))===null||ar===void 0?void 0:ar.substring(6),kr=R.current[Sr],dr=kr.attrs.points,vr=kr.shape_type,Yr=(C==null||(yr=C.current)===null||yr===void 0?void 0:yr.k)||1,Lr=vr==="polygon";k.current?Cr=k.current:Cr=c.attr("id").substring(11);var mr=dr[Cr-1];mr[0]=mr[0]+a.dx/Yr,mr[1]=mr[1]+a.dy/Yr,dr[Cr-1]=mr,R.current[Sr].attrs={points:dr};var Mr=G.current(dr);u.current.attr("d",Mr+(Lr?"Z":"")),jr(),zr(Sr,d.current.showLabel);return}if(r==="moveRotate"){se(o);return}},de=function(r){var e=(r==null?void 0:r.target)||(r==null?void 0:r.srcElement),t=w.Ys(e).attr("id"),n=j.current||[],a=n.length;if(w.td_("#path-point-group circle").attr("r",N.point.r),r.type==="touchstart"||r.type==="mouseenter"){if(q.current&&(t!=="path-point-1"||a<3))return;w.Ys("#".concat(t)).attr("r",6),w.Ys(e).style("cursor","pointer")}else w.Ys(e).style("cursor",null)},lt=function(r,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=w.Ys("#path-point-group"),a=n.selectAll("circle"),c=a.size(),o=N.point;if(!c||c<=e){var i=n.append("circle").attr("id",r).call(Or("point",wr));return i.on("touchstart touchend mouseenter mouseleave",de),Object.keys(o).forEach(function(l){i.attr(l,o[l])}),i.attr("display",t?"inline":"none"),i}return w.Ys("#"+r).attr("display",t?"inline":"none")},ve=function(r){var e,t=sr(r),n=Y.current.substring(6),a=(e=R.current)===null||e===void 0?void 0:e[n],c=a.attrs.points,o=a.shape_type,i=a.rotate,l=c.length,s=-1,v=1/0,h={};if(h[n]=JSON.parse(JSON.stringify(R.current[n])),pr("edit",u.current,h),i){var p=B()(i,3),f=p[0],b=p[1],S=p[2];t=Kr.apply(void 0,er()(t).concat([b,S,f,!0]))}for(var E=0;E<l;E++){var x=(E+1)%l,P=c[E],K=c[x],Z=Qt(t,P,K);Z<v&&(s=x,v=Z)}c.splice(s,0,t);var T=G.current(c);o==="polygon"&&(T+="Z"),u.current.attr("d",T),rt();var V="path-point-".concat(l+1);lt(V,l),jr()},wt=function(r){var e,t;(e=w.Ys("#path-stretch-line"))===null||e===void 0||e.attr("display","none");var n=u.current.attr("d");r&&u.current.attr("d",n+"Z");var a=(t=u.current.attr("id"))===null||t===void 0?void 0:t.substring("6"),c=d.current,o=c.curLabel,i=c.colorBindLabel;o=o||a,$.current[o]||(i?$.current[o]=N.shapeCommon.stroke:$.current[0]=N.shapeCommon.stroke,d.current.changeBindColor($.current)),R.current[a]={shape_type:r?"polygon":"line",label:o,attrs:{points:j.current}},j.current=null,D.current="shape-".concat(a),Y.current=D.current,w.Ys("#"+Y.current).attr("fill",Zr(u.current.attr("stroke"))),d.current.changeSize(hr()),d.current.changeSelect(gr()),Qr(a,o,!0),g.current.select("#path-add-point").attr("display","inline"),yt(a),pr("add",u.current),d.current.endDraw({id:a,label:o})},fe=function(r,e,t,n){var a,c=(r==null?void 0:r.sourceEvent)||r,o=j.current||[],i=o==null?void 0:o.length;if(c.button===2){if(!i)return;i<2?Br():wt();return}if(t==="point"&&n.attr("id")==="path-point-1"&&i>=3){wt(!0);return}var l=w.Ys("#path-point-group").attr("transform",null),s=l.selectAll("circle"),v=s.size(),h=sr(r),p=B()(h,2),f=p[0],b=p[1],S=N.line;if(i){j.current.push([f,b]);var K=G.current(j.current);u.current.attr("d",K)}else{var E;q.current=!0,ur(),(E=w.Ys("#path-stretch-line"))===null||E===void 0||E.attr("display","inline"),Xr();var x=Object.assign({},N.shapeCommon,N[e]);u.current=A.current.select("#shape").append(e).call(Or("shape",wr));var P=Rr();u.current.attr("id","shape-".concat(P)),Object.keys(x).forEach(function(rr){u.current.attr(rr,x[rr])}),j.current=[[f,b]]}(!v||!l.select("#path-stretch-line").size())&&(l.append("path").attr("id","path-stretch-line").style("pointer-events","none"),Object.keys(S).forEach(function(rr){w.Ys("#path-stretch-line").attr(rr,S[rr])}));var Z="path-point-".concat(i+1);lt(Z,i);var T=(C==null||(a=C.current)===null||a===void 0?void 0:a.k)||1,V=f*T,tr=b*T;w.Ys("#"+Z).attr("cx",V).attr("cy",tr),tt(r)},xt=function(r){ie(r),ce(r),tt(r)},he=function(r,e,t){var n=d.current.drawTool;if(!(!n||e.defaultPrevented)){if(r==="grip"){var a=t.attr("id");L.current&&w.Ys("#"+L.current).attr("fill",N.grip.fill),L.current===a?L.current=null:(L.current=a,t.attr("fill","#ff0"),nt(e));return}if(L.current){var c=Ur();pr.apply(void 0,["edit"].concat(er()(c))),c=null,wr("moveGrip",e,t),d.current.changeSize(hr());return}if(r==="point"){var o=t.attr("id").substring(11);k.current&&w.Ys("#path-point-"+k.current).attr("fill",N.point.fill),k.current===o?k.current=null:(k.current=o,t.attr("fill","#ff0"),nt(e));return}if(k.current){var i=Ur();pr.apply(void 0,["edit"].concat(er()(i))),i=null,wr("movePoint",e,t),d.current.changeSize(hr());return}if(r==="insertPoint"){ve(e),d.current.changeSize(hr());return}if(r==="shape"){var l;it(t,M.current||(e==null||(l=e.sourceEvent)===null||l===void 0?void 0:l.shiftKey));return}if(r==="whole"){ur(),u.current=null,m.current=null,d.current.changeSelect([]);return}}},pe=function(r,e){var t=sr(r);H.current=!0,O.current=A.current.select("#shape").append(e).call(Or("shape",wr)),Xr();var n=Object.assign({},N.shapeCommon,N[e]),a="x",c="y";e==="ellipse"&&(a="cx",c="cy");var o=B()(t,2);_.current.x=o[0],_.current.y=o[1];var i=B()(t,2);return n[a]=i[0],n[c]=i[1],Object.keys(n).forEach(function(l){O.current.attr(l,n[l])}),!1},ge=function(r,e){if(!O.current||!H.current)return!1;var t=sr(r),n=_.current,a=n.x,c=n.y,o=t[0]-a,i=t[1]-c;if(e==="rect"){var l=Math.abs(o),s=Math.abs(i);return o<0&&(M.current&&l<s?a=a-s:a=t[0]),i<0&&(M.current&&l>s?c=c-l:c=t[1]),M.current&&(l>s?s=l:l=s),j.current={x:a,y:c,width:l,height:s},O.current.attr("x",a).attr("y",c).attr("width",l).attr("height",s),!1}if(e==="ellipse"){var v=o/2||0,h=i/2||0,p=Math.abs(v),f=Math.abs(h);M.current&&(p>f?(h=h>0?p:-p,f=p):(v=v>0?f:-f,p=f)),a=a+v,c=c+h,j.current={cx:a,cy:c,rx:p,ry:f},O.current.attr("cx",a).attr("cy",c).attr("rx",p).attr("ry",f)}return!1},Ct=function(){if(!O.current||!H.current)return!1;H.current=!1,m.current=null,ur();var r=ne();if(r)return!1;var e=d.current,t=e.drawTool,n=e.curLabel,a=e.colorBindLabel,c=Rr();n=n||c,$.current[n]||(a?$.current[n]=N.shapeCommon.stroke:$.current[0]=N.shapeCommon.stroke,d.current.changeBindColor($.current)),O.current.attr("id","shape-".concat(c)),u.current=O.current,O.current=null,R.current[c]={shape_type:t,label:n,attrs:j.current},j.current=null,Ar(),d.current.changeSize(hr()),Qr(c,n,t==="ellipse"),pr("add",u.current),d.current.endDraw({id:c,label:n})},ye=function(r){var e=sr(r);H.current=!0,u.current=null,ur();var t=B()(e,2);return _.current.x=t[0],_.current.y=t[1],w.Ys("#shape-selector").attr("display","inline").attr("x",e[0]).attr("y",e[1]).attr("width",0).attr("height",0),!1},Se=function(){var r,e;(r=w.td_("#shape-path-group *"))===null||r===void 0||r.attr("display","none");var t=w.Ys("#shape-selector").node().getBoundingClientRect(),n=Object.keys(R.current),a=[],c=(C==null||(e=C.current)===null||e===void 0?void 0:e.k)||1,o=0;n==null||n.forEach(function(i){var l=w.Ys("#shape-".concat(i)),s=l.node().getBoundingClientRect(),v=Vt(s,t);if(v){var h;a.push(i);var p=l.node().getBBox(),f=p.x,b=p.y,S=p.width,E=p.height;f=f*c||0,b=b*c||0,S=S*c||0,E=E*c||0;var x=[[f-2,b-2],[f+S+2,b-2],[f+S+2,b+E+2],[f-2,b+E+2]],P=G.current(x),K=at(o);K.attr("d",P+"Z");var Z=(h=R.current)===null||h===void 0?void 0:h[i],T=Z.rotate;if(T){var V=B()(T,3),tr=V[0],rr=V[1],nr=V[2],ar=rr*c,yr=nr*c;K.attr("transform","rotate(".concat(tr," ").concat(ar,",").concat(yr,")"))}o=o+1}}),m.current=(a==null?void 0:a.length)&&a},me=function(r){if(!H.current)return!1;var e=sr(r),t=_.current,n=t.x,a=t.y,c=e[0]-n,o=e[1]-a,i=Math.abs(c),l=Math.abs(o);return c<0&&(n=e[0]),o<0&&(a=e[1]),w.Ys("#shape-related-group #shape-selector").attr("x",n).attr("y",a).attr("width",i).attr("height",l),Se(),!1},be=function(){if(!H.current)return!1;H.current=!1,w.td_("#shape-related-group #shape-selector").attr("display","none")},we=function(r,e,t){var n;return r==="grip"?"moveGrip":r==="rotate"?"moveRotate":r==="point"&&!q.current?"movePoint":r==="insertPoint"?r:e==="drag"||X.current&&!M.current&&!U.current?"moveWhole":r==="shape"&&!X.current&&(e==="move"||Y.current===t.attr("id")||m.current&&m.current.includes((n=t.attr("id"))===null||n===void 0?void 0:n.substring(6)))?"moveShape":r==="whole"&&e==="move"&&!X.current&&!U.current?"selectShape":e==="rect"||e==="ellipse"?"shape":e},Or=function(r,e){var t="",n="",a=null,c=!1,o=null;return w.ohM().filter(function(i){var l;return(i==null||(l=i.touches)===null||l===void 0?void 0:l.length)>1||(t=d.current.drawTool,a=w.Ys(this),n=we(r,t,a),!t)?!1:(Jr(),r==="shape"?n==="moveShape":!0)}).on("start",function(i){var l,s;if(i==null||(l=i.sourceEvent)===null||l===void 0||l.stopPropagation(),i==null||(s=i.sourceEvent)===null||s===void 0||s.preventDefault(),Q.current=!1,c=!1,!(L.current||k.current)){if(n==="path"){m.current=null,fe(i,t,r,a);return}if(n==="moveShape"){var v,h,p=(v=a.attr("id"))===null||v===void 0?void 0:v.substring(6);if(!m.current&&Y.current!==a.attr("id")||m.current&&!m.current.includes(p)){var f;c=!0,it(a,M.current||(i==null||(f=i.sourceEvent)===null||f===void 0?void 0:f.shiftKey))}(U.current||i!=null&&(h=i.sourceEvent)!==null&&h!==void 0&&h.altKey)&&Ot()}else if(n.indexOf("move")>=0&&n.length>4)if(n==="moveWhole"){C.current=C.current||w.CRH;var b=sr(i),S=B()(b,2);_.current.mx=S[0],_.current.my=S[1]}else if(n==="moveGrip")nt(i);else{var E=sr(i),x=B()(E,2);_.current.mx=x[0],_.current.my=x[1]}n.indexOf("move")>=0&&n.length>4&&n!=="moveWhole"&&(o=Ur())}}).on("drag",function(i){var l,s;if(i==null||(l=i.sourceEvent)===null||l===void 0||l.stopPropagation(),i==null||(s=i.sourceEvent)===null||s===void 0||s.preventDefault(),i!=null&&i.sourceEvent&&xt(i.sourceEvent),!(L.current||k.current||n==="path"||n==="insertPoint")&&!(i.dx===0&&i.dy===0)){if(Q.current=!0,n.indexOf("move")>=0){e(n,i,a);return}if(n==="shape"){H.current?ge(i,t):pe(i,t);return}n==="selectShape"&&(H.current?me(i):ye(i))}}).on("end",function(i){var l,s;if(i==null||(l=i.sourceEvent)===null||l===void 0||l.stopPropagation(),i==null||(s=i.sourceEvent)===null||s===void 0||s.preventDefault(),Q.current)if(n==="shape"){Ct(),d.current.changeSelect(gr());return}else if(n==="selectShape"){be(),d.current.changeSelect(gr());return}else n!=="moveWhole"&&n.indexOf("move")>=0&&n.length>4&&((n==="moveGrip"||n==="movePoint")&&rt(),d.current.changeSize(hr()),o&&pr.apply(void 0,["edit"].concat(er()(o))),o=null);else if(q.current&&n==="path")j.current||(q.current=!1);else if(!c){var v,h;a=w.Ys(i==null||(v=i.sourceEvent)===null||v===void 0?void 0:v.target);var p=r;r==="whole"&&((h=a.attr("id"))===null||h===void 0?void 0:h.indexOf("shape"))>=0&&(p="shape"),he(p,i,a);return}})},ut=function(r){var e,t="",n=t.drawTool;return w.sPX().scaleExtent((e=d.current)===null||e===void 0?void 0:e.scaleExtent).filter(function(a){var c;return a==null||a.stopPropagation(),a==null||a.preventDefault(),Jr(),(a==null||(c=a.touches)===null||c===void 0?void 0:c.length)>1?!0:a.type==="wheel"}).on("start",function(a){var c,o;n=d.current.drawTool,a==null||(c=a.sourceEvent)===null||c===void 0||c.stopPropagation(),a==null||(o=a.sourceEvent)===null||o===void 0||o.preventDefault()}).on("zoom",function(a){var c,o;a==null||(c=a.sourceEvent)===null||c===void 0||c.stopPropagation(),a==null||(o=a.sourceEvent)===null||o===void 0||o.preventDefault(),n&&r&&r(a)}).on("end",function(a){var c,o;a==null||(c=a.sourceEvent)===null||c===void 0||c.stopPropagation(),a==null||(o=a.sourceEvent)===null||o===void 0||o.preventDefault()})},Et=function(r){var e;r&&(C.current=r.transform),g.current.selectAll("g.layer").attr("transform",C.current),g.current.selectAll("g#shape-related-group").attr("transform","translate(".concat(C.current.x,", ").concat(C.current.y,")")).select("#shape-selector").attr("transform","scale(".concat(C.current.k,")")),(e=m.current)!==null&&e!==void 0&&e.length?Ir():(Ar(),jr(r)),et(),Tr(),br.current=C.current.k,d.current.changeScale(br.current)},Rt=function(r){var e,t,n=!0,a=r;if(!a){var c;a=u.current,a.attr("fill",N.shapeCommon.fill),n=!1,(c=g.current.select("#path-add-point"))===null||c===void 0||c.attr("display","inline")}var o=(e=a.attr("id"))===null||e===void 0?void 0:e.substring(6),i=R.current[o],l=i.label,s=i.shape_type,v=a.clone(),h=Rr();return v=A.current.select("#shape").append(function(){return v.node()}).attr("id","shape-".concat(h)).call(Or("shape",wr)),R.current[h]=JSON.parse(JSON.stringify((t=R.current)===null||t===void 0?void 0:t[o])),Qr(h,l,s!=="rect"),n?""+h:(v.attr("fill",Zr(v.attr("stroke"))),Y.current="shape-".concat(h),v)},Ot=function(){if(m.current){var r,e=[];(r=m.current)===null||r===void 0||r.forEach(function(t){var n=w.Ys("#shape-".concat(t));e.push(Rt(n))}),m.current=e,d.current.changeSelect(gr()),pr("add",m.current);return}u.current&&(u.current=Rt(),d.current.changeSelect(gr()),pr("add",u.current))},xe=function(r){if(r!=="path"&&q.current){Br(),q.current=!1;return}},Ce=function(){if(H.current){Ct();return}},Ee=function(r){X.current=r.ctrlKey,U.current=r.altKey,M.current=r.shiftKey;var e=r.keyCode||r.which||r.charCode;if(q.current){e===27&&Br();return}if(e===8||e===46){k.current?(oe(),d.current.changeSize(hr())):ct();return}if(X.current&&e===67){var t;W.current=m.current&&er()(m.current)||((t=u.current)===null||t===void 0?void 0:t.attr("id"))||null}if(X.current&&e===86){if(!W.current)return;ur();var n=It()(W.current)==="object";n?m.current=er()(W.current):u.current=w.Ys("#".concat(W.current)),Ot(),n?Ir():["rect","ellipse"].includes(R.current[W.current.substring(6)].shape_type)?Ar():jr(),d.current.changeSize(hr())}if([37,38,39,40].includes(e)){var a=0,c=0;e===37?a=-1:e===38?c=-1:e===39?a=1:e===40&&(c=1);var o=Ur();pr.apply(void 0,["edit"].concat(er()(o))),o=null,ot([a,c])}},Re=function(r){X.current=r.ctrlKey,U.current=r.altKey,M.current=r.shiftKey},Yt=function(r){r?w.Ys("body").on("keyup",Re):(w.Ys("body").on("keyup",null),X.current=!1,U.current=!1,M.current=!1,Ce())},Lt=function(r){var e,t,n,a=(e=g.current)===null||e===void 0?void 0:e.select("#shape-grip-group #rotate-line"),c=(t=g.current)===null||t===void 0?void 0:t.select("#shape-grip-group #rotate-circle");if(r){var o;if((o=a)!==null&&o!==void 0&&o.size())a.attr("display","inline"),c.attr("display","inline");else{a=g.current.select("#shape-grip-group").append("line").attr("id","rotate-line").style("pointer-events","none");var i=N.rotateLine;Object.keys(i).forEach(function(P){a.attr(P,i[P])}),c=g.current.select("#shape-grip-group").append("circle").attr("id","rotate-circle").attr("class","w-svg-rotate").call(Or("rotate",wr));var l=N.rotateCircle;Object.keys(l).forEach(function(P){c.attr(P,l[P])})}if(u.current){var s,v,h,p=(C==null||(s=C.current)===null||s===void 0?void 0:s.k)||1,f=(v=u.current)===null||v===void 0||(h=v.node())===null||h===void 0?void 0:h.getBBox(),b=f.x,S=f.y,E=f.width;b=b*p||0,S=S*p||0,E=E*p||0;var x=b+E/2;a.attr("x1",x).attr("y1",S-4).attr("x2",x).attr("y2",S-16),c.attr("cx",x).attr("cy",S-20)}}else(n=a)!==null&&n!==void 0&&n.size()&&(a.attr("display","none"),c.attr("display","none"))},Oe=function(){var r;(r=w.Ys(I.current).select("div>svg"))===null||r===void 0||r.remove(),g.current=w.Ys(I.current).selectChild("div").append("svg").attr("id","svgroot");var e=g.current.append("defs"),t=e.append("pattern").attr("id","gridPattern").attr("patternUnits","userSpaceOnUse").attr("x",0).attr("y",0).attr("width","10").attr("height","10"),n=t.append("rect");n.attr("fill","none").attr("stroke","#787878").attr("stroke-width","0.5").attr("x",0).attr("y",0).attr("width","100%").attr("height","100%"),A.current=g.current.append("svg").attr("id","svgcont"),A.current.append("g").attr("class","layer").attr("id","img").style("pointer-events","none"),A.current.append("g").attr("class","layer").attr("id","shape");var a=g.current.append("g").attr("id","shape-related-group"),c=a.append("rect").attr("id","shape-selector").attr("display","none").style("pointer-events","none"),o=Object.assign({},N.rect,N.selectBox);Object.keys(o).forEach(function(S){c.attr(S,o[S])});var i=a.append("path").attr("id","path-add-point").attr("display","none"),l=N.pathAddPoint;Object.keys(l).forEach(function(S){i.attr(S,l[S])});var s=a.append("g").attr("class","grip-layer").attr("id","shape-grip-group").attr("display","none"),v=s.append("path").attr("id","resize-path").style("pointer-events","none"),h=N.line;Object.keys(h).forEach(function(S){v.attr(S,h[S])});for(var p=0;p<8;p++)s.append("rect").attr("id","resize-grip-"+ht[p]).style("cursor",ht[p]+"-resize");var f=N.grip;Object.keys(f).forEach(function(S){w.td_("#shape-grip-group rect").attr(S,f[S])}),Lt(z.rotateEnable),a.append("g").attr("class","point_layer").attr("id","path-point-group"),a.append("g").attr("class","path_layer").attr("id","shape-path-group").style("pointer-events","none"),a.append("g").attr("class","label_layer").attr("id","shape-label-group").attr("display","none").style("pointer-events","none"),a.append("rect").attr("id","grid").attr("display","none").style("pointer-events","none").attr("x",0).attr("y",0).attr("width","0").attr("height","0").attr("fill","url(#gridPattern)").attr("stroke","none");var b=g.current.append("g").attr("class","crosshair_layer").style("pointer-events","none").attr("display","none");b.append("rect").attr("id","crosshair-v-line").attr("width",.5).attr("height","100%"),b.append("rect").attr("id","crosshair-h-line").attr("width","100%").attr("height",.5),b.selectAll("rect").attr("x",0).attr("y",0).attr("fill","#00f").attr("stroke","none")},Fr=function(){var r=I.current.getBoundingClientRect(),e=r.right-r.left||N.svg.width,t=r.bottom-r.top||N.svg.height,n=[e,t];N.svg.width=n[0],N.svg.height=n[1],w.Ys("#svgcanvas").style("width",e+"px").style("height",t+"px"),w.td_("#svgroot,#svgcont").attr("width",e).attr("height",t)},Ye=function(){g.current.on("mousemove touchmove",xt).call(ut(function(r){Et(r)})).on("dblclick.zoom",null).call(Or("whole",wr)),w.td_("#shape-grip-group rect").call(Or("grip",wr)),g.current.select("#path-add-point").call(Or("insertPoint",wr))},kt=function(){G.current=w.jvg(),Oe(),Fr(),Ye(),st(d.current.showCrosshair)},Pt=function(){g.current.selectAll("g.layer,g#shape-related-group").attr("transform",null),C.current=null,g.current.call(ut().transform,w.CRH),d.current.changeScale("1")},Dt=function(){var r,e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;cr.current=[],or.current=[],ur(),u.current&&(u.current=null),m.current&&(m.current=null),R.current={},t&&d.current.changeSize(hr()),lr.current=[],d.current.changeSelect([]),(r=g.current.selectAll("#shape *"))===null||r===void 0||r.remove(),(e=g.current.selectAll("#shape-label-group *"))===null||e===void 0||e.attr("display","none")},Le=function(){var r,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(r=A.current.select("g#img").select("image"))===null||r===void 0||r.remove(),Dt(e),Pt()},ke=function(r){var e,t,n=R.current[r].hide,a=(e=u.current)===null||e===void 0||(t=e.attr("id"))===null||t===void 0?void 0:t.substring(6);if(n=!n,R.current[r].hide=n,g.current.selectAll("g#shape #shape-".concat(r,",#shape-label-").concat(r)).attr("display",n?"none":"inline"),m.current&&m.current.includes(r)){var c,o=m.current.indexOf(r);if(m.current.splice(o,1),!((c=m.current)!==null&&c!==void 0&&c.length))m.current=null,w.td_("#shape-path-group *").attr("display","none"),d.current.changeSelect([]);else{var i;(i=w.Ys("#shape-path-".concat(m.current.length)))===null||i===void 0||i.attr("display","none"),Ir(),d.current.changeSelect(gr())}}else a&&a===r&&(ur(),u.current=null,d.current.changeSelect([]));d.current.changeSize(hr())},At=function(r){return r?(Fr(),new Promise(function(e){var t=new Image;t.onload=function(n){var a,c,o=n.target.width,i=n.target.height,l=o,s=i,v=0,h=0,p=1,f=N.svg,b=f.width,S=f.height,E=b/S,x=o/i;E>x?(s=S,l=s*x,p=i/s):(l=b,s=l/x,p=o/l),v=(b-l)/2,h=(S-s)/2,fr.current={x:v,y:h,scale:p,w:l,h:s},(a=A.current.select("g#img").select("image"))===null||a===void 0||a.remove(),(c=A.current.select("g#img").append("image").attr("width",l).attr("height",s).attr("x",v).attr("y",h).attr("xlink:href",r).attr("draggable","false"))===null||c===void 0||c.style("filter",Dr.current),Tr(),d.current.imgLoaded({width:o,height:i}),e(!0)},t.onerror=function(){d.current.imgLoaded(!1),e(!1)},t.src=r})):!1},Pe=function(r){if(r){var e=Object.keys(R.current);e==null||e.forEach(function(t){var n=g.current.select("#shape-".concat(t));g.current.select("#shape-label-".concat(t)).attr("fill",n.attr("stroke"))})}},De=function(r){g.current.select("#grid").attr("display",r&&(!C.current||C.current.k>=1)?"inline":"none"),Tr(!0)},st=function(r){g.current.select(".crosshair_layer").attr("display",r&&z.drawTool!=="move"&&z.drawTool!=="drag"?"inline":"none")},Ae=function(r){var e;Dr.current=r,(e=A.current.select("#img image"))===null||e===void 0||e.style("filter",r)},je=function(r){g.current.select("#shape-label-group").attr("display",r?"inline":"none"),et(!0),Pe(r)},ze=function(r,e){if(R.current[r]&&(R.current[r].label=e,g.current.select("#shape-label-".concat(r)).text(e),d.current.changeSize(hr()),d.current.colorBindLabel)){var t=$.current[e];t||(t=$r($.current),$.current[e]=t,d.current.changeBindColor($.current)),Hr(r,t)}},Me=function(r){var e=+br.current,t=0,n=d.current.scaleExtent;isNaN(r)?r==="enlarge"?(t=(n[1]-e)/20,t=t>.1?t:.2,e=e+t):r==="narrow"&&(t=(e-n[0])/5,e=e-t):e=+r,e=e<n[0]?n[0]:e,e=e>n[1]?n[1]:e,ut().scaleTo(g.current,e),C.current=w.P2S(g.current.node()),Et()},Je=function(r){if(!r||!(r!=null&&r.length))return[];var e=[];try{e=r.map(function(t){var n;if(!(t!=null&&t.attrs))return t;var a=t.attrs,c=t.shape_type,o=ft()(t,$t);if(c.indexOf("rect")>=0){var i=a,l=i.x,s=i.y,v=i.width,h=i.height;return a=[[l,s],[l+v,s+h]],xr()({points:a,shape_type:"rectangle"},o)}else if(c==="ellipse"){var p=a,f=p.cx,b=p.cy,S=p.rx,E=p.ry;return S===E?(a=[[f,b],[f,b+E]],xr()({points:a,shape_type:"circle"},o)):(a=[[f,b],[f,b+E],[f+S,b]],xr()({points:a,shape_type:"ellipse"},o))}return xr()({points:(n=a)===null||n===void 0?void 0:n.points,shape_type:c},o)})}catch(t){console.error(t.toString())}return e},Be=function(r){if(!r||!(r!=null&&r.length))return[];var e=[];try{e=r.map(function(t,n){var a;if(t=xr()(xr()({},t),{},{id:"".concat(n+1)}),(a=t)!==null&&a!==void 0&&a.attrs)return t;var c=t,o=c.points,i=c.shape_type,l=ft()(c,_t);if(i.indexOf("rect")>=0){var s=o,v=B()(s,2),h=B()(v[0],2),p=h[0],f=h[1],b=B()(v[1],2),S=b[0],E=b[1],x=Math.abs(S-p),P=Math.abs(E-f),K=p,Z=f;return K>S&&(K=S),Z>E&&(Z=E),o={x:K,y:Z,width:x,height:P},xr()({attrs:o,shape_type:"rect"},l)}else if(i==="circle"){var T=o,V=B()(T,2),tr=B()(V[0],2),rr=tr[0],nr=tr[1],ar=B()(V[1],2),yr=ar[0],Cr=ar[1],Sr=Math.sqrt(Math.pow(yr-rr,2)+Math.pow(Cr-nr,2));return o={cx:rr,cy:nr,rx:Sr,ry:Sr},xr()({attrs:o,shape_type:"ellipse"},l)}else if(i==="ellipse"){var kr=o,dr=B()(kr,3),vr=B()(dr[0],2),Yr=vr[0],Lr=vr[1],mr=B()(dr[1],2),Mr=mr[1],Pr=B()(dr[2],1),Nr=Pr[0],Vr=Mr-Lr,qr=Nr-Yr;return o={cx:Yr,cy:Lr,rx:qr,ry:Vr},xr()({attrs:o,shape_type:"ellipse"},l)}else if(i==="polygon")return xr()({attrs:{points:o},shape_type:i},l);return xr()({attrs:{points:o},shape_type:"line"},l)})}catch(t){console.error(t.toString())}return e},Ne=function(r,e,t,n,a,c){lr.current.push(r),R.current[r]={label:t,shape_type:e,hide:n,attrs:a,rotate:c},t&&Qr(r,t,e!=="rect"),g.current.selectAll("g#shape #shape-".concat(r,",#shape-label-").concat(r)).attr("display",n?"none":"inline")},Ie=function(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!(!r||!(r!=null&&r.length)))try{var t=fr.current,n=t.x,a=t.y,c=t.scale,o=A.current.select("#shape");r.forEach(function(i){var l=i.attrs,s=i.id,v=i.hide,h=i.label,p=i.shape_type,f=i.rotate,b=null,S=null,E=null;if(p==="rect"||p==="ellipse"){var x,P=ee(p),K=l[P.x],Z=l[P.y],T=l[P.w],V=l[P.h];if(!+T||!+V)return;s||(s=Rr()),b=o.append(p).attr("id","shape-".concat(s)).call(Or("shape",wr)),Xr(h);var tr=Object.assign({},N.shapeCommon,N[p]);if(Object.keys(tr).forEach(function(Wr){b.attr(Wr,tr[Wr])}),K=+K/c+n,Z=+Z/c+a,T=T/c,V=V/c,b.attr(P.x,K).attr(P.y,Z).attr(P.w,T).attr(P.h,V),S=(x={},Gr()(x,P.x,K),Gr()(x,P.y,Z),Gr()(x,P.w,T),Gr()(x,P.h,V),x),f){var rr=_r(s),nr=rr.centerX,ar=rr.centerY;E=[f,nr,ar],b.attr("transform","rotate(".concat(f," ").concat(nr,",").concat(ar,")"))}}else{s||(s=Rr()),Xr(h);var yr=l.points,Cr=yr.length,Sr=o.append("path").attr("id","shape-".concat(s)).call(Or("shape",wr)),kr=Object.assign({},N.shapeCommon,N.path),dr=[];Object.keys(kr).forEach(function(Wr){Sr.attr(Wr,kr[Wr])});for(var vr=0;vr<Cr;vr++){var Yr=B()(yr[vr],2),Lr=Yr[0],mr=Yr[1];Lr=+Lr/c+n,mr=+mr/c+a,dr[vr]=[Lr,mr];var Mr="path-point-".concat(vr+1);lt(Mr,vr,!1)}var Pr=G.current(dr);if(p==="polygon"&&(Pr+="Z"),Sr.attr("d",Pr),S={points:dr},f){var Nr=_r(s),Vr=Nr.centerX,qr=Nr.centerY;E=[f,Vr,qr],Sr.attr("transform","rotate(".concat(f," ").concat(Vr,",").concat(qr,")"))}}i.id=s,Ne(s,p,h,v,S,E)}),d.current.changeBindColor($.current),e&&d.current.changeSize(r)}catch(i){console.error(i.toString())}},Fe=function(){return cr.current.length>0},We=function(){return or.current.length>0},Ge=function(r){r&&!I.current&&(I.current=r)};return(0,F.useEffect)(function(){return I.current&&(kt(),window.addEventListener("resize",Fr)),function(){w.Ys("body").on("keyup",null),window.removeEventListener("resize",Fr)}},[]),(0,F.useEffect)(function(){z.src!==d.current.src&&At(z.src),z.shapeGroup!==d.current.shapeGroup&&kt(),z.drawTool!==d.current.drawTool&&(xe(z.drawTool),st(z.showCrosshair)),z.showLabel!==d.current.showLabel&&je(z.showLabel),z.showGrid!==d.current.showGrid&&De(z.showGrid),z.showCrosshair!==d.current.showCrosshair&&st(z.showCrosshair),z.rotateEnable!==d.current.rotateEnable&&Lt(z.rotateEnable),d.current=z},[z]),(0,F.useImperativeHandle)(J,function(){return{reload:Le,zoomReload:Pt,loadImg:At,clearShape:Dt,toggleShape:ke,getMarkData:hr,selectShape:it,delSelectShape:ct,getSelectIds:gr,editLabel:ze,adjustImg:Ae,undoSvg:le,canUndo:Fe,redoSvg:ue,canRedo:We,changeScale:Me,changeColor:ae,drawShapeFromSize:Ie,setCanvasSize:Fr,convertToPoints:Je,convertToAttrs:Be}}),(0,Er.jsxs)("div",{ref:Ge,className:"w-draw-container ".concat(d.current.className||""),onKeyDown:Ee,children:[(0,Er.jsx)("div",{id:"svgcanvas",className:"w-svg-box",tabIndex:-1,onFocus:function(){return Yt(!0)},onBlur:function(){return Yt(!1)}}),z==null?void 0:z.children]})});pt.defaultProps={src:"",curLabel:"",showLabel:!1,showGrid:!1,showCrosshair:!1,minSize:[4,4],drawTool:"",scaleExtent:[.02,30],colorBindLabel:!0,rotateEnable:!1,shapeGroup:1,curGroup:0,changeSize:function(){},changeBindColor:function(){},changeSelect:function(){},changeScale:function(){},imgLoaded:function(){},endDraw:function(){}};var re=pt,gt=function(J){var d=J.shapeList,I=J.selectShapeIds,g=J.delFunc,A=J.selectFunc,u=J.leftRender,O=J.rightRender,Y=J.topRender,D=J.title,L=J.className,k=(0,F.useRef)(null),m=(0,F.useState)([]),W=B()(m,2),H=W[0],q=W[1],Q=(0,F.useRef)(-1),G=(0,F.useRef)(-1);(0,F.useEffect)(function(){q(I)},[I]);var C=function(){G.current=-1,Q.current=-1;var M=d.length,U=I==null?void 0:I.length;if(!(!M||!U)){var R=er()(I);R.sort(function(cr,or){return cr-or});for(var j=0;j<M;j++){var $=d[j].id;$===R[0]&&(Q.current=j),$===R[U-1]&&(G.current=j)}}},br=function(M){M?(k.current.classList.add("box-active"),C()):k.current.classList.remove("box-active")},fr=function(M){A&&(M.length===1?A(M[0]):A(M))},_=function(M){var U=M.keyCode||M.which||M.charCode;if(U===8||U===46){M==null||M.stopPropagation(),g&&g();return}if(M.ctrlKey&&U===65){M==null||M.stopPropagation();var R=d==null?void 0:d.map(function(or){return or==null?void 0:or.id});q(er()(R)),fr(R),G.current=d.length-1,Q.current=0;return}var j=-1,$=d.length-1;if(U===38&&(Q.current>0||H.length>1)?(j=Q.current-1,j=j<0?0:j):U===40&&(G.current<$||H.length>1)&&(j=G.current+1,j=j>$?$:j),j!==-1){var cr;M==null||M.stopPropagation(),H=[(cr=d[j])===null||cr===void 0?void 0:cr.id],q(H),fr(H),G.current=j,Q.current=j}},lr=function(M,U,R){R.stopPropagation();var j=er()(H),$=j.indexOf(M);if(R.shiftKey){U<=Q.current?Q.current=U:G.current=U,Q.current=Q.current<0?0:Q.current,j=[];for(var cr=Q.current;cr<=G.current;cr++){var or;j.push((or=d[cr])===null||or===void 0?void 0:or.id)}}else if(R.ctrlKey)if($>=0){if(j.length===1)Q.current=-1,G.current=-1;else if(U===Q.current)for(var ur=Q.current+1;ur<=G.current;ur++){var Jr;if(j.includes((Jr=d[ur])===null||Jr===void 0?void 0:Jr.id)){Q.current=ur;break}}else if(U===G.current)for(var sr=G.current-1;sr>=Q.current;sr--){var Rr;if(j.includes((Rr=d[sr])===null||Rr===void 0?void 0:Rr.id)){G.current=sr;break}}j.splice($,1)}else j.push(M),U<Q.current&&(Q.current=U),U>G.current&&(G.current=U);else j=[M],G.current=U,Q.current=U;q(j),fr(j)},Dr=function(){H.length&&(q([]),fr([]),G.current=-1,Q.current=-1)};return(0,Er.jsxs)("div",{className:"win-box ".concat(L),children:[(0,Er.jsxs)("div",{className:"w-head",children:[D||"\u56FE\u5F62\u5217\u8868",(0,Er.jsx)("div",{className:"flex-center",children:Y&&Y()})]}),(0,Er.jsx)("div",{className:"w-box w-box-overflow",ref:k,tabIndex:-1,onFocus:function(){return br(!0)},onBlur:function(){return br(!1)},onClick:Dr,onKeyDown:_,children:d&&d.map(function(X,M){var U=X==null?void 0:X.id;return(0,Er.jsxs)("div",{className:"list-item ".concat(H.includes(U)?"on":""),onClick:function(j){return lr(U,M,j)},children:[u&&u(X,M),(0,Er.jsx)("p",{className:"list-txt",title:X==null?void 0:X.label,children:X==null?void 0:X.label}),O&&O(X,M)]},M)})})]})};gt.defaultProps={className:"",title:"",shapeList:[],selectShapeIds:[],leftRender:null,rightRender:null,topRender:null,delFunc:function(){},selectFunc:function(){}};var te=gt}}]);
